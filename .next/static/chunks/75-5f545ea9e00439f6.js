"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[75],{5996:function(e,t,o){o.d(t,{D:function(){return a}});var n=o(7437),s=o(2265),r=o(7307),i=o(826);function a(e){let{className:t=""}=e,{shops:o,currentShop:a,isDemoMode:c,loading:l,error:d,switchToShop:h,refresh:u}=(0,r.L)(),[p,m]=(0,s.useState)(""),f=async(e,t)=>{if((e||t)&&e)try{console.log("[ShopSwitcher] Switching to shop ".concat(e.id,", demo: ").concat(t)),await h(e.id,t),console.log("[ShopSwitcher] Shop switched successfully")}catch(e){console.error("[ShopSwitcher] Failed to switch shop:",e)}},g=()=>{let e=p.trim();if(!e){alert("Bitte gib deine Shopify-Domain ein, z.B. dein-shop.myshopify.com");return}if(!e.includes(".")){alert("Bitte gib eine vollst\xe4ndige Domain ein, z.B. dein-shop.myshopify.com");return}let t="".concat(i.T5,"/auth/shopify/install?shop=").concat(encodeURIComponent(e));window.open(t,"_blank","noopener,noreferrer")},x=async()=>{console.log("[ShopSwitcher] \uD83D\uDD18 Live Button clicked");let e=o.filter(e=>999!==e.id&&"shopify"===e.type);if(console.log("[ShopSwitcher] realLiveShops (filtered):",e.map(e=>({id:e.id,name:e.name,type:e.type}))),e.length>0)console.log("[ShopSwitcher] → Switching to real shop:",e[0].name),await f(e[0],!1);else if(console.log("[ShopSwitcher] → No real shops, showing connect card"),S)try{console.log("[ShopSwitcher] Switching to Live Mode (no shop installed)"),await h(S.id,!1)}catch(e){console.error("[ShopSwitcher] Error switching to Live Mode:",e),await u()}},y=async()=>{let e=o.find(e=>"demo"===e.type);e&&await f(e,!0)};if(l&&0===o.length)return(0,n.jsxs)("div",{className:"shop-switcher ".concat(t),children:[(0,n.jsx)("div",{className:"p-4 text-center text-gray-500",children:"Lade Shops..."}),d&&(0,n.jsx)("div",{className:"mt-2 p-2 bg-red-50 border border-red-200 rounded text-xs text-red-600",children:d})]});if(d&&0===o.length)return(0,n.jsx)("div",{className:"shop-switcher ".concat(t),children:(0,n.jsxs)("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:[(0,n.jsx)("p",{className:"text-sm text-red-600 font-medium mb-2",children:"Fehler beim Laden der Shops"}),(0,n.jsx)("p",{className:"text-xs text-red-500",children:d}),(0,n.jsx)("button",{onClick:()=>u(),className:"mt-2 px-3 py-1 text-xs bg-red-100 text-red-700 rounded hover:bg-red-200",children:"Erneut versuchen"})]})});let S=o.find(e=>"demo"===e.type||999===e.id),w=o.filter(e=>"shopify"===e.type&&999!==e.id),v=w.filter(e=>999!==e.id&&"shopify"===e.type),b=o.filter(e=>"demo"===e.type||999===e.id);b.length>1&&console.warn("[ShopSwitcher] ⚠️ MEHRERE DEMO SHOPS GEFUNDEN:",b.map(e=>({id:e.id,name:e.name,type:e.type})));let j=w.find(e=>999===e.id||"demo"===e.type);return j&&console.error("[ShopSwitcher] ❌ BUG: Demo Shop in liveShops gefunden!",j),console.log("[ShopSwitcher] Render:",{shopsCount:o.length,shops:o.map(e=>({id:e.id,name:e.name,type:e.type})),demoShop:S?{id:S.id,name:S.name,type:S.type}:null,demoShopsCount:b.length,liveShopsCount:w.length,liveShops:w.map(e=>({id:e.id,name:e.name,type:e.type})),currentShop:a?{id:a.id,name:a.name,type:a.type}:null,isDemoMode:c,demoInLiveShops:j?"BUG!":"OK"}),(0,n.jsxs)("div",{className:"shop-switcher ".concat(t," relative"),children:[(0,n.jsxs)("div",{className:"mb-4",children:[(0,n.jsx)("div",{className:"text-sm font-medium text-gray-700 mb-2",children:"Aktiver Shop"}),(0,n.jsxs)("div",{className:"flex gap-2 bg-gray-100 p-1 rounded-lg",children:[(0,n.jsx)("button",{onClick:x,disabled:l,className:"flex-1 px-4 py-2 rounded-md font-medium transition-all ".concat(c?"text-gray-600 hover:text-gray-900":"bg-white text-blue-600 shadow-sm"," ").concat(l?"opacity-50 cursor-not-allowed":""),children:"Live"}),(0,n.jsx)("button",{onClick:y,disabled:l||!S,className:"flex-1 px-4 py-2 rounded-md font-medium transition-all ".concat(c?"bg-white text-blue-600 shadow-sm":"text-gray-600 hover:text-gray-900"," ").concat(l||!S?"opacity-50 cursor-not-allowed":""),children:"Demo"})]})]}),c?S&&(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:(0,n.jsxs)("div",{className:"flex items-start gap-2",children:[(0,n.jsx)("span",{className:"text-lg",children:"\uD83E\uDDEA"}),(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"font-semibold text-blue-900 text-sm",children:"Demo-Modus Aktiv"}),(0,n.jsx)("p",{className:"text-xs text-blue-700 mt-1",children:"Du testest mit 20 synthetischen Produkten. Wechsle zu Live um echte Shopify-Daten zu nutzen."})]})]})}),(0,n.jsx)("div",{className:"border-2 border-green-500 bg-green-50 rounded-lg p-4",children:(0,n.jsxs)("div",{className:"flex items-start gap-3",children:[(0,n.jsx)("div",{className:"text-2xl",children:"\uD83E\uDDEA"}),(0,n.jsxs)("div",{className:"flex-1",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsx)("div",{className:"font-semibold text-gray-900",children:S.name}),(0,n.jsxs)("div",{className:"flex items-center gap-1",children:[(0,n.jsx)("span",{className:"text-green-600 font-medium text-sm",children:"Aktiv"}),(0,n.jsx)("span",{className:"text-green-600",children:"✓"})]})]}),(0,n.jsxs)("div",{className:"text-sm text-gray-600 mt-1",children:[S.product_count," Produkte • 90 Tage Verlauf"]})]})]})})]}):(0,n.jsx)("div",{className:"space-y-2",children:v.length>0?v.map(e=>(0,n.jsx)("div",{className:"border-2 rounded-lg p-4 cursor-pointer transition-all ".concat(e.is_active?"border-green-500 bg-green-50":"border-gray-300 bg-white hover:bg-gray-50"," ").concat(l?"opacity-50 cursor-not-allowed":""),onClick:async()=>{l||await f(e,!1)},children:(0,n.jsxs)("div",{className:"flex items-start gap-3",children:[(0,n.jsx)("div",{className:"text-2xl",children:"\uD83C\uDFEA"}),(0,n.jsxs)("div",{className:"flex-1",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"font-semibold text-gray-900",children:e.name||e.shop_url||"Shopify Shop"}),e.shop_url&&(0,n.jsx)("div",{className:"text-xs text-gray-500 mt-0.5",children:e.shop_url})]}),(0,n.jsxs)("div",{className:"flex items-center gap-1",children:[(0,n.jsx)("span",{className:"font-medium text-sm ".concat(e.is_active?"text-green-600":"text-gray-500"),children:e.is_active?"Aktiv":"Verf\xfcgbar"}),e.is_active&&(0,n.jsx)("span",{className:"text-green-600",children:"✓"})]})]}),(0,n.jsxs)("div",{className:"text-sm text-gray-600 mt-2",children:[e.product_count||0," Produkte • Verbunden via Shopify"]})]})]})},e.id)):(0,n.jsx)("div",{className:"border-2 border-gray-300 border-dashed rounded-lg p-6 bg-gray-50",children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"text-5xl mb-4",children:"\uD83C\uDFEA"}),(0,n.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Shopify Shop verbinden"}),(0,n.jsx)("p",{className:"text-sm text-gray-600 mb-6",children:"Installiere PriceIQ in deinem Shopify Store um automatisch Preis-Optimierungen zu erhalten."}),(0,n.jsxs)("div",{className:"max-w-sm mx-auto space-y-3 mb-4",children:[(0,n.jsx)("input",{type:"text",placeholder:"dein-shop.myshopify.com",value:p,onChange:e=>m(e.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500",onKeyDown:e=>{"Enter"===e.key&&g()}}),(0,n.jsx)("button",{onClick:g,className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-3 px-4 rounded-lg transition-colors",children:"Shop verbinden"})]}),(0,n.jsxs)("div",{className:"text-sm text-gray-500",children:["Oder installiere PriceIQ direkt aus dem"," ",(0,n.jsx)("a",{href:"https://apps.shopify.com",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline font-medium",children:"Shopify App Store"})]})]})})}),l&&(0,n.jsx)("div",{className:"absolute inset-0 bg-white bg-opacity-50 flex items-center justify-center rounded-lg",children:(0,n.jsx)("div",{className:"text-sm text-gray-600",children:"Wechselt..."})})]})}},7307:function(e,t,o){o.d(t,{L:function(){return r}});var n=o(2265),s=o(826);function r(){let[e,t]=(0,n.useState)(null),[o,r]=(0,n.useState)(!1),[i,a]=(0,n.useState)([]),[c,l]=(0,n.useState)(!0),[d,h]=(0,n.useState)(null),u=async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{var n,c;h(null);let i=await (0,s.a5)();console.log("[useShop] getAvailableShops response:",i);let d=i.shops||[],u=d.filter(e=>"demo"===e.type);u.length>1&&console.warn("[useShop] ⚠️ BACKEND GIBT MEHRERE DEMO SHOPS ZUR\xdcCK:",u.map(e=>({id:e.id,name:e.name})));let p=d.reduce((e,t)=>("demo"===t.type&&e.some(e=>"demo"===e.type)?console.warn("[useShop] ⚠️ Doppelten Demo Shop entfernt:",t.name):e.push(t),e),[]);a(p),e||r(i.is_demo_mode||!1);let m=i.active_shop_id,f=e?o:i.is_demo_mode||!1,g=null;f?g=(null===(n=i.shops)||void 0===n?void 0:n.find(e=>"demo"===e.type))||null:(g=(null===(c=i.shops)||void 0===c?void 0:c.find(e=>e.id===m&&"shopify"===e.type&&999!==e.id))||null)||!i.shops||(g=i.shops.find(e=>"shopify"===e.type&&999!==e.id)||null),!g&&i.shops&&(g=i.shops.find(e=>e.is_active)||null),!g&&i.shops&&i.shops.length>0&&(g=i.shops[0],console.warn("[useShop] Using first shop as fallback:",g.name)),t(g),console.log("[useShop] Active shop set to:",(null==g?void 0:g.name)||"null","isDemoMode:",f),l(!1)}catch(e){h(e.message||"Fehler beim Laden der Shops"),console.error("Error loading shops:",e),0===i.length&&(a([{id:999,name:"Demo Shop",type:"demo",shop_url:null,product_count:20,is_active:!0}]),t({id:999,name:"Demo Shop",type:"demo",shop_url:null,product_count:20,is_active:!0}),r(!0)),l(!1)}},p=async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{await u(e),console.log("[useShop] Refresh completed")}catch(e){console.error("[useShop] Error during refresh:",e),l(!1)}},m=async(e,o)=>{try{console.log("[useShop] Switching to shop ".concat(e,", demo: ").concat(o)),l(!0),h(null);let n=await (0,s.YZ)(e,o);console.log("[useShop] Switch API response:",n),r(o);let a=i.find(t=>t.id===e);!a&&(n.active_shop?a={id:n.active_shop.id,name:n.active_shop.name,type:n.active_shop.type,shop_url:null,product_count:0,is_active:!0}:o&&(a={id:999,name:"Demo Shop",type:"demo",shop_url:null,product_count:0,is_active:!0})),a&&(t(a),console.log("[useShop] Optimistic update: currentShop = ".concat(a.name," ")+"isDemoMode = ".concat(o))),localStorage.setItem("current_shop_id",e.toString()),localStorage.setItem("shop_mode",o?"demo":"live"),window.dispatchEvent(new CustomEvent("shop-switched",{detail:{shopId:e,useDemo:o,mode:o?"demo":"live"}})),console.log("[useShop] shop-switched event dispatched"),await f(),console.log("[useShop] Data refreshed after switch")}catch(e){throw console.error("[useShop] Switch failed:",e),h(e.message||"Fehler beim Wechseln des Shops"),e}finally{l(!1)}},f=async()=>{try{let e=await (0,s.a5)();console.log("[useShop] getAvailableShops response:",e),a(e.shops||[]),console.log("[useShop] Shops list refreshed (without changing currentShop)")}catch(e){console.error("[useShop] Refresh failed:",e)}};return(0,n.useEffect)(()=>{{let e=localStorage.getItem("current_shop_id"),t=localStorage.getItem("shop_mode");if(e){console.log("[useShop] Found shop_id in localStorage:",e);let o=parseInt(e),n="demo"===t;if(!isNaN(o)){console.log("[useShop] Auto-switching to shop from localStorage:",o,"demo:",n),m(o,n).catch(e=>{console.error("[useShop] Error auto-switching shop:",e),p()});return}}}p();let e=e=>{var o;if(console.log("[useShop] shop-switched event received:",e.detail),null===(o=e.detail)||void 0===o?void 0:o.shopId){localStorage.setItem("current_shop_id",e.detail.shopId.toString());let o=e.detail.mode||(e.detail.useDemo?"demo":"live");localStorage.setItem("shop_mode",o);let n="demo"===o;r(n);let s=i.find(t=>t.id===e.detail.shopId);s&&(t(s),console.log("[useShop] Shop updated from event:",s.name,"demo:",n))}p(!0).then(()=>{var t;(null===(t=e.detail)||void 0===t?void 0:t.useDemo)!==void 0&&r(e.detail.useDemo)})};return window.addEventListener("shop-switched",e),()=>window.removeEventListener("shop-switched",e)},[]),{currentShop:e,isDemoMode:o,shops:i,loading:c,error:d,refresh:p,switchToShop:m}}},826:function(e,t,o){o.d(t,{$m:function(){return x},Ow:function(){return u},QJ:function(){return p},R5:function(){return y},Rd:function(){return m},T5:function(){return n},YH:function(){return d},YZ:function(){return h},_M:function(){return f},a5:function(){return l},gU:function(){return a},ku:function(){return g},n8:function(){return c},t2:function(){return i},z2:function(){return s}});let n="http://localhost:8000";async function s(){let e=await fetch("".concat(n,"/api/dashboard/stats"),{headers:r()});if(!e.ok)throw Error((await e.json()).detail||"Fehler beim Laden der Dashboard-Daten");return e.json()}function r(){let e;let t={"Content-Type":"application/json"},o=((e=localStorage.getItem("session_id"))||(e="session_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9)),localStorage.setItem("session_id",e),console.log("[API] Neue Session-ID generiert:",e)),e);return o&&(t["X-Session-ID"]=o),t}async function i(e){let t=e?"".concat(n,"/products/?shop_id=").concat(e):"".concat(n,"/products/"),o=await fetch(t,{headers:r()});if(!o.ok)throw Error((await o.json()).detail||"Fehler beim Laden der Produkte");return o.json()}async function a(e){return(await fetch("".concat(n,"/products/sync/").concat(e),{method:"POST"})).json()}async function c(e){let t=await fetch("".concat(n,"/recommendations/generate/").concat(e),{method:"POST",headers:r()});if(!t.ok)throw Error((await t.json()).detail||"Fehler beim Generieren der Empfehlung");return t.json()}async function l(){let e=await fetch("".concat(n,"/shops"),{headers:r()});if(!e.ok)throw Error((await e.json()).detail||"Fehler beim Laden der Shops");return e.json()}async function d(){let e=await fetch("".concat(n,"/shops/current"),{headers:r()});if(!e.ok)throw Error((await e.json()).detail||"Fehler beim Laden des aktuellen Shops");return e.json()}async function h(e,t){let o=await fetch("".concat(n,"/shops/switch"),{method:"POST",headers:r(),body:JSON.stringify({shop_id:e,use_demo:t})});if(!o.ok)throw Error((await o.json()).detail||"Fehler beim Wechseln des Shops");return o.json()}async function u(e,t){let o=new URLSearchParams;(null==t?void 0:t.maxResults)&&o.set("max_results",String(t.maxResults)),(null==t?void 0:t.forceRefresh)&&o.set("force_refresh","true");let s=await fetch("".concat(n,"/competitors/products/").concat(e,"/competitor-search?").concat(o),{method:"POST",headers:r(),credentials:"include"});if(!s.ok)throw Error((await s.json()).detail||"Competitor search failed");return s.json()}async function p(e,t){let o=await fetch("".concat(n,"/margin/costs"),{method:"POST",headers:r(),credentials:"include",body:JSON.stringify({product_id:e,...t})});if(!o.ok)throw Error((await o.json()).detail||"Fehler beim Speichern der Kosten");return o.json()}async function m(e){let t=await fetch("".concat(n,"/margin/costs/").concat(e),{headers:r(),credentials:"include"});if(404===t.status)return null;if(!t.ok)throw Error((await t.json()).detail||"Fehler beim Laden der Kosten");return t.json()}async function f(e,t){let o=await fetch("".concat(n,"/margin/costs/").concat(e),{method:"PUT",headers:r(),credentials:"include",body:JSON.stringify(t)});if(!o.ok)throw Error((await o.json()).detail||"Fehler beim Aktualisieren der Kosten");return o.json()}async function g(e,t){let o=await fetch("".concat(n,"/margin/calculate/").concat(e),{method:"POST",headers:r(),credentials:"include",body:JSON.stringify({selling_price:t,save_to_history:!0,triggered_by:"manual"})});if(!o.ok)throw Error((await o.json()).detail||"Fehler beim Berechnen der Marge");return o.json()}async function x(e){let t=await fetch("".concat(n,"/margin/category-defaults/").concat(e),{headers:r(),credentials:"include"});if(!t.ok)throw Error((await t.json()).detail||"Fehler beim Laden der Category-Defaults");return t.json()}async function y(e,t){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"DE",s=await fetch("".concat(n,"/margin/estimate-costs?selling_price=").concat(e,"&category=").concat(t,"&country_code=").concat(o),{method:"POST",headers:r(),credentials:"include"});if(!s.ok)throw Error((await s.json()).detail||"Fehler beim Sch\xe4tzen der Kosten");return s.json()}},5967:function(e,t,o){o.d(t,{rU:function(){return r},jD:function(){return a},tv:function(){return c}});var n=o(6709);let s=(0,o(1585).Z)({locales:["de","en"],defaultLocale:"de",localePrefix:"as-needed"}),{Link:r,redirect:i,usePathname:a,useRouter:c}=(0,n.Z)(s)}}]);