(()=>{var e={};e.id=136,e.ids=[136],e.modules={7849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},5528:e=>{"use strict";e.exports=require("next/dist\\client\\components\\action-async-storage.external.js")},1877:e=>{"use strict";e.exports=require("next/dist\\client\\components\\request-async-storage.external.js")},5319:e=>{"use strict";e.exports=require("next/dist\\client\\components\\static-generation-async-storage.external.js")},3956:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>i.a,__next_app__:()=>x,originalPathname:()=>m,pages:()=>o,routeModule:()=>u,tree:()=>d});var r=s(482),n=s(9108),a=s(2563),i=s.n(a),l=s(8300),c={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(c[e]=()=>l[e]);s.d(t,c);let d=["",{children:["[locale]",{children:["recommendations",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,6222)),"C:\\Users\\Kujti\\Desktop\\Trading Tools\\MVP PRICE\\frontend\\app\\[locale]\\recommendations\\page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,3471)),"C:\\Users\\Kujti\\Desktop\\Trading Tools\\MVP PRICE\\frontend\\app\\[locale]\\layout.tsx"]}]},{layout:[()=>Promise.resolve().then(s.bind(s,2917)),"C:\\Users\\Kujti\\Desktop\\Trading Tools\\MVP PRICE\\frontend\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,9361,23)),"next/dist/client/components/not-found-error"]}],o=["C:\\Users\\Kujti\\Desktop\\Trading Tools\\MVP PRICE\\frontend\\app\\[locale]\\recommendations\\page.tsx"],m="/[locale]/recommendations/page",x={require:s,loadChunk:()=>Promise.resolve()},u=new r.AppPageRouteModule({definition:{kind:n.x.APP_PAGE,page:"/[locale]/recommendations/page",pathname:"/[locale]/recommendations",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},4965:(e,t,s)=>{Promise.resolve().then(s.bind(s,1463))},1463:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>Q});var r=s(2295),n=s(3729),a=s(2186),i=s(2254),l=s(2542),c=s(531),d=s(8117);async function o(e){let t=await fetch(`${d.T5}/api/shopify/apply-price`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(e)});if(!t.ok)throw Error((await t.json()).detail||"Fehler beim Anwenden des Preises");return t.json()}var m=s(7075);let x=(0,m.Z)("triangle-alert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),u=(0,m.Z)("clock",[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),h=(0,m.Z)("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);var g=s(8632);function p(e,t){return(...e)=>{try{return t(...e)}catch{throw Error(void 0)}}}let b=p(0,g.T_);p(0,g.Gb);var f=s(6262),j=s(5269);let y=(0,m.Z)("circle-question-mark",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),N=(0,m.Z)("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);function v({confidence:e,reasoning:t,compact:s=!1,confidenceBasis:n}){let a=b("confidence"),i=e>1?e:100*e,l={high:{icon:f.Z,color:"green",bgColor:"bg-gradient-to-r from-green-50 to-emerald-50",borderColor:"border-green-200",textColor:"text-green-700",barColor:"bg-green-500",gradientBar:"bg-gradient-to-r from-green-500 to-emerald-600"},medium:{icon:j.Z,color:"yellow",bgColor:"bg-gradient-to-r from-yellow-50 to-amber-50",borderColor:"border-yellow-200",textColor:"text-yellow-700",barColor:"bg-yellow-500",gradientBar:"bg-gradient-to-r from-yellow-500 to-amber-600"},low:{icon:y,color:"red",bgColor:"bg-gradient-to-r from-red-50 to-orange-50",borderColor:"border-red-200",textColor:"text-red-700",barColor:"bg-red-500",gradientBar:"bg-gradient-to-r from-red-500 to-orange-600"}}[i>=85?"high":i>=60?"medium":"low"],c=l.icon;if(s)return(0,r.jsxs)("div",{className:`inline-flex items-center gap-2 px-3 py-1.5 rounded-full border ${l.bgColor} ${l.borderColor}`,children:[r.jsx(c,{className:`w-4 h-4 ${l.textColor}`}),(0,r.jsxs)("span",{className:`text-sm font-semibold ${l.textColor}`,children:[i.toFixed(0),"%"]})]});let d=n?.competitor_count||0;return n?.sales_30d,(0,r.jsxs)("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 p-6 rounded-2xl border-l-4 border-blue-500 space-y-4",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:"w-12 h-12 bg-blue-500 rounded-2xl flex items-center justify-center flex-shrink-0",children:r.jsx(N,{className:"w-6 h-6 text-white"})}),(0,r.jsxs)("div",{className:"flex-1",children:[r.jsx("h3",{className:"text-2xl font-bold text-gray-900",children:a("title",{confidence:i.toFixed(0)})}),r.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 mt-2",children:r.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-indigo-600 h-2 rounded-full transition-all duration-500",style:{width:`${i}%`}})})]})]}),(0,r.jsxs)("div",{className:"p-4 bg-white/50 rounded-xl border",children:[(0,r.jsxs)("h4",{className:"font-semibold text-gray-900 mb-3 flex items-center gap-2",children:["\uD83D\uDCCA ",r.jsx("span",{children:a("whatAnalyzes")})]}),(0,r.jsxs)("ul",{className:"space-y-2 text-sm text-gray-700",children:[r.jsx("li",{children:"• Echte Verkaufsdaten aus deinem Shopify-Shop"}),(0,r.jsxs)("li",{children:["• Aktuelle Preise deiner ",d>0?`${d}-${Math.max(d,10)}`:"5-10"," wichtigsten Konkurrenten"]}),(0,r.jsxs)("li",{children:["• ",n?.ml_models||4," spezialisierte Machine-Learning-Modelle (Umsatz, Konkurrenz, Marge, Saisonalit\xe4t)"]}),r.jsx("li",{children:"• Deine eingetragenen Kosten und bisherigen Margen"})]})]}),(0,r.jsxs)("div",{className:"p-4 bg-yellow-50/80 border border-yellow-200 rounded-xl",children:[(0,r.jsxs)("h4",{className:"font-semibold text-gray-900 mb-3 flex items-center gap-2",children:["\uD83D\uDCA1 ",a("why",{confidence:i.toFixed(0)})]}),r.jsx("p",{className:"text-sm text-gray-800 leading-relaxed",children:a("whyText")})]})]})}let w=(0,m.Z)("circle-check",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]),_=(0,m.Z)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);function k(e,t="EUR"){return new Intl.NumberFormat("de-DE",{style:"currency",currency:t,minimumFractionDigits:2,maximumFractionDigits:2}).format(e)}function D(e,t=1){return`${e>=0?"+":""}${e.toFixed(t)}%`}function P({recommendedPrice:e,onApply:t,onDismiss:s,isApplying:a,isDisabled:i=!1,marginAnalysis:l}){let c=b("pricing"),d=b("common"),o=b("actions"),[m,h]=(0,n.useState)(!1),g=l&&!l.is_safe,p=l?.details?.margin?.euro?30*l.details.margin.euro:null;return(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[r.jsx("button",{onClick:t,disabled:a||i,className:`
            flex items-center justify-center gap-2 px-6 py-3 rounded-lg font-semibold
            transition-all duration-200 transform hover:scale-105
            disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none
            ${i?"bg-gray-300 text-gray-600":g?"bg-orange-600 hover:bg-orange-700 text-white shadow-lg hover:shadow-xl":"bg-green-600 hover:bg-green-700 text-white shadow-lg hover:shadow-xl"}
          `,children:a?(0,r.jsxs)(r.Fragment,{children:[r.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),r.jsx("span",{children:c("applying")})]}):(0,r.jsxs)(r.Fragment,{children:[r.jsx(w,{className:"w-5 h-5"}),(0,r.jsxs)("div",{className:"flex flex-col items-start",children:[r.jsx("span",{children:c("apply_price",{price:k(e)})}),p&&(0,r.jsxs)("span",{className:"text-xs opacity-80 font-normal",children:["+",k(p),o("month_est")]})]})]})}),(0,r.jsxs)("button",{onClick:s,disabled:a,className:"flex items-center justify-center gap-2 px-6 py-3 rounded-lg font-semibold border-2 border-gray-300 text-gray-700 hover:bg-gray-50 transition-all disabled:opacity-50",children:[r.jsx(_,{className:"w-5 h-5"}),r.jsx("span",{children:d("dismiss")})]})]}),(0,r.jsxs)("button",{onClick:()=>h(!m),className:"w-full flex items-center justify-center gap-2 px-4 py-2 text-sm text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",children:[r.jsx(u,{className:"w-4 h-4"}),r.jsx("span",{children:c("schedule_later")})]}),m&&(0,r.jsxs)("div",{className:"p-4 bg-blue-50 rounded-lg border border-blue-200 space-y-3",children:[r.jsx("p",{className:"text-sm font-medium text-blue-900",children:o("schedule_price_change")}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-xs text-blue-700 mb-1",children:o("date")}),r.jsx("input",{type:"date",className:"w-full px-3 py-2 border border-blue-300 rounded-lg text-sm"})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-xs text-blue-700 mb-1",children:o("time")}),r.jsx("input",{type:"time",defaultValue:"09:00",className:"w-full px-3 py-2 border border-blue-300 rounded-lg text-sm"})]})]}),r.jsx("button",{className:"w-full px-4 py-2 bg-blue-600 text-white rounded-lg text-sm font-medium hover:bg-blue-700 transition-colors",children:o("schedule_change")})]}),i&&(0,r.jsxs)("div",{className:"flex items-start gap-2 p-3 bg-red-50 border border-red-200 rounded-lg",children:[r.jsx(_,{className:"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5"}),r.jsx("p",{className:"text-sm text-red-800",children:o("cannot_apply_warning")})]}),g&&!i&&(0,r.jsxs)("div",{className:"flex items-start gap-2 p-3 bg-orange-50 border border-orange-200 rounded-lg",children:[r.jsx(x,{className:"w-5 h-5 text-orange-600 flex-shrink-0 mt-0.5"}),(0,r.jsxs)("div",{className:"flex-1",children:[r.jsx("p",{className:"text-sm font-medium text-orange-900 mb-1",children:o("margin_warning")}),r.jsx("p",{className:"text-xs text-orange-800",children:l?.message})]})]})]})}function C({recommendedPrice:e,currentPrice:t,strategyDetails:s=[],competitorData:n}){let a=e=>{let t=100*e;return t>=90?r.jsx("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-green-100 text-green-700 rounded text-xs font-medium border border-green-200",children:"✅ Datenqualit\xe4t: Exzellent"}):t>=80?r.jsx("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-green-100 text-green-700 rounded text-xs font-medium border border-green-200",children:"✅ Datenqualit\xe4t: Sehr gut"}):t>=70?r.jsx("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-yellow-100 text-yellow-700 rounded text-xs font-medium border border-yellow-200",children:"⚠️ Datenqualit\xe4t: Gut"}):t>=60?r.jsx("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-orange-100 text-orange-700 rounded text-xs font-medium border border-orange-200",children:"⚠️ Datenqualit\xe4t: Ausreichend"}):r.jsx("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-red-100 text-red-700 rounded text-xs font-medium border border-red-200",children:"⚠️ Datenqualit\xe4t: Begrenzt"})},i={competitive:{emoji:"\uD83C\uDFEA",title:"Du bist teurer als der Markt",getStory:s=>{let r=s.competitorData?.avg||0,n=s.competitorData?.prices?.length||5,a=t-r,i=(a/r*100).toFixed(0),l=e-r;return a>0?`Wir haben ${n} Wettbewerber analysiert. Der durchschnittliche Preis liegt bei ${k(r)}. Du bist ${i}% teurer als der Durchschnitt. Du solltest ${k(Math.abs(l))} ${l<0?"senken":"erh\xf6hen"} um wettbewerbsf\xe4hig zu bleiben.`:`Wir haben ${n} Wettbewerber analysiert. Der durchschnittliche Preis liegt bei ${k(r)}. Du bist bereits wettbewerbsf\xe4hig positioniert.`},getBasedOn:e=>{let s=e.competitorData?.prices?.length||5,r=e.competitorData?.avg||0,n=r>0?((t-r)/r*100).toFixed(0):"0",a=t>r?`${n}% \xfcber`:`${Math.abs(Number(n))}% unter`;return[`Echtzeitpreise von ${s} Konkurrenten`,"Aktuelle Marktdaten (heute aktualisiert)",`Deine Position: ${a} Durchschnitt`]}},demand:{emoji:"\uD83D\uDCC8",title:"Die Nachfrage steigt stark",getStory:e=>{let t=e.sales||64,s=e.previousSales||54,r=s>0?((t-s)/s*100).toFixed(0):"19";return`In den letzten 7 Tagen hast du ${t} Verk\xe4ufe gemacht (vorher: ${s} Verk\xe4ufe). Das ist ein +${r}% Wachstum! Wenn die Nachfrage steigt, kannst du h\xf6here Preise durchsetzen.`},getBasedOn:e=>["Deine letzten 30 Tage Verkaufsdaten","Trendanalyse der letzten Woche","Machine-Learning Vorhersage f\xfcr n\xe4chste 7 Tage"]},inventory:{emoji:"\uD83D\uDCE6",title:"Dein Lagerbestand ist niedrig",getStory:e=>{let t=e.stock||45,s=e.daysOfStock||20;return`Mit ${t} Einheiten auf Lager hast du bei aktuellem Tempo noch ${s} Tage Vorrat. Das ist knapp! Du solltest vorsichtig mit Preissenkungen sein.`},getBasedOn:e=>{let t=e.stock||45,s=e.avgDaily||2.25;return[`Aktueller Lagerbestand: ${t} St\xfcck`,`Durchschnittlicher Verkauf: ${s.toFixed(1)}/Tag`,"Berechnung basierend auf letzten 7 Tagen Verk\xe4ufen"]}},cost:{emoji:"\uD83D\uDCB0",title:"Deine Kosten sind stabil",getStory:e=>`Deine Einkaufskosten liegen bei einem stabilen Niveau. Die empfohlene Preis\xe4nderung ber\xfccksichtigt deine aktuellen Margen und stellt sicher, dass du profitabel bleibst.`,getBasedOn:e=>["Deine hinterlegten Produktkosten","Aktuelle Marge-Berechnung","Historische Kostenentwicklung"]}},l=e=>{let s=e.recommended_price-t;return{value:s,formatted:k(Math.abs(s)),isIncrease:s>0,isDecrease:s<0}},c=[...s].sort((e,t)=>{let s=Math.abs(l(e).value);return Math.abs(l(t).value)-s}),d=e-t,o=d<0;return(0,r.jsxs)("div",{className:"bg-white rounded-xl border border-gray-200 p-6",children:[(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsxs)("h3",{className:"text-2xl font-bold text-gray-900 mb-2 flex items-center gap-2",children:[r.jsx("span",{children:"\uD83D\uDCA1"}),(0,r.jsxs)("span",{children:["Warum empfehlen wir ",k(e),"?"]})]}),(0,r.jsxs)("p",{className:"text-gray-600",children:["Unsere KI hat ",s.length," wichtige Marktfaktoren analysiert:"]})]}),r.jsx("div",{className:"space-y-4 mb-6",children:c.map((s,c)=>{let d=i[s.strategy]||{emoji:"\uD83D\uDCCA",title:s.strategy,getStory:()=>s.reasoning||"Keine Details verf\xfcgbar.",getBasedOn:()=>["Daten aus KI-Analyse"]},o=l(s);return(0,r.jsxs)("div",{className:"border-2 border-gray-200 rounded-lg p-4 hover:border-blue-300 transition-colors",children:[(0,r.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[r.jsx("span",{className:"text-2xl font-bold text-blue-600",children:c+1+"️⃣"}),r.jsx("span",{className:"text-2xl",children:d.emoji}),r.jsx("h4",{className:"text-lg font-semibold text-gray-900",children:d.title})]}),a(s.confidence)]}),r.jsx("p",{className:"text-gray-700 mb-3 leading-relaxed",children:d.getStory({competitorData:n,currentPrice:t,recommendedPrice:e,strategy:s})}),(0,r.jsxs)("div",{className:`flex items-center gap-2 mb-3 p-2 rounded ${o.isDecrease?"bg-red-50":o.isIncrease?"bg-green-50":"bg-gray-50"}`,children:[r.jsx("span",{className:"text-xl",children:"\uD83D\uDCB0"}),(0,r.jsxs)("span",{className:`font-semibold ${o.isDecrease?"text-red-600":o.isIncrease?"text-green-600":"text-gray-600"}`,children:["Preisimpact: ",o.isDecrease?"-":o.isIncrease?"+":"",o.formatted," ",o.isDecrease?"Senkung empfohlen":o.isIncrease?"Erh\xf6hung empfohlen":"Keine \xc4nderung"]})]}),(0,r.jsxs)("details",{className:"mt-2",children:[(0,r.jsxs)("summary",{className:"cursor-pointer text-sm text-blue-600 hover:text-blue-700 font-medium flex items-center gap-2",children:[r.jsx("span",{children:"ℹ️"}),r.jsx("span",{children:"Basiert auf..."})]}),r.jsx("div",{className:"mt-3 p-3 bg-blue-50 rounded-lg border border-blue-200",children:r.jsx("ul",{className:"list-disc list-inside space-y-1 text-sm text-gray-700",children:d.getBasedOn({competitorData:n,strategy:s,currentPrice:t}).map((e,t)=>r.jsx("li",{children:e},t))})})]})]},c)})}),(0,r.jsxs)("div",{className:`mt-6 p-4 rounded-lg border-2 ${o?"bg-red-50 border-red-300":d>0?"bg-green-50 border-green-300":"bg-gray-50 border-gray-300"}`,children:[r.jsx("h4",{className:"font-semibold text-gray-900 mb-2",children:"Gesamt-Effekt:"}),(0,r.jsxs)("p",{className:"text-gray-700 mb-2",children:["Die Analyse zeigt, dass eine Preis",o?"senkung":d>0?"erh\xf6hung":"\xe4nderung"," um ",k(Math.abs(d))," ",o?"sinnvoll w\xe4re um wettbewerbsf\xe4hig zu bleiben":d>0?"sinnvoll w\xe4re um die Marge zu optimieren":"nicht empfohlen wird","."]}),(0,r.jsxs)("div",{className:"flex items-center justify-between mt-3 pt-3 border-t border-gray-300",children:[r.jsx("span",{className:"text-sm text-gray-600",children:"Berechnung:"}),(0,r.jsxs)("span",{className:"font-mono font-semibold text-gray-900",children:[k(t)," ",o?"-":"+"," ",k(Math.abs(d))," = ",k(e)]})]})]})]})}function M({recommendation:e,onApply:t,onDismiss:s,onRefresh:a}){let i=b("pricing"),l=b("common");b("market");let[c,d]=(0,n.useState)(!1),[o,m]=(0,n.useState)(!1),g=e.recommended_price,p=g-e.current_price,f=p/e.current_price*100,j=p>0,y=0===p,N=e.margin_analysis&&!e.margin_analysis.is_safe,w=e.warnings?.some(e=>"HIGH"===e.severity||"high"===e.severity),_=function(e){var t;let s=e.recommended_price-e.current_price,r=Math.abs(e.price_change_pct),n=(t=s<0,`Empfohlene ${t?"Preissenkung":"Preiserh\xf6hung"} um ${r.toFixed(1)}%, ${t?"um wettbewerbsf\xe4hig zu bleiben":"aufgrund gestiegener Nachfrage"}.`);return{headline:n,bulletPoints:function(e){let t=[];if(e.competitor_context){var s;let r=e.competitor_context,n={most_expensive:"Teuerste Option",above_average:"\xdcber dem Durchschnitt",average:"Marktdurchschnitt",below_average:"Unter dem Durchschnitt",cheapest:"G\xfcnstigste Option",unknown:"Unbekannt"}[r.position]||"Unbekannt",a=r.price_diff_pct>0?`${r.price_diff_pct.toFixed(1)}% \xfcber`:`${Math.abs(r.price_diff_pct).toFixed(1)}% unter`;t.push(`Du liegst aktuell ${a} dem durchschnittlichen Marktpreis (${(s=r.avg_price,new Intl.NumberFormat("de-DE",{style:"currency",currency:"EUR",minimumFractionDigits:2,maximumFractionDigits:2}).format(s))}).`),"unknown"!==n&&t.push(`Deine Position: ${n} (${r.competitor_count} Wettbewerber analysiert).`)}if(e.strategies?.inventory){let s=e.strategies.inventory;if(s.reasoning.includes("Normaler Bestand")||s.reasoning.includes("normal")){let e=s.reasoning.match(/\((\d+)\)/),r=e?e[1]:"";t.push(`Dein Bestand ist normal${r?` (${r} St\xfcck)`:""} – es besteht kein akuter Abverkaufsdruck.`)}else s.reasoning.includes("Hoher Bestand")||s.reasoning.includes("hoch")?t.push("Dein Bestand ist hoch – eine Preissenkung k\xf6nnte den Absatz ankurbeln."):(s.reasoning.includes("Niedriger Bestand")||s.reasoning.includes("niedrig"))&&t.push("Dein Bestand ist niedrig – du k\xf6nntest den Preis erh\xf6hen, ohne Absatz zu verlieren.")}if(e.strategies?.cost){let s=e.strategies.cost.reasoning.match(/(\d+)%/i),r=s?s[1]:"30";t.push(`Die empfohlene Anpassung h\xe4lt deine Zielmarge von ca. ${r}% ein.`)}if(e.margin&&(e.margin.is_safe&&e.margin.margin_pct>=20?t.push(`Deine Marge bleibt mit ${e.margin.margin_pct.toFixed(1)}% auf einem gesunden Niveau.`):e.margin.margin_pct<20&&t.push(`Achtung: Deine Marge liegt bei ${e.margin.margin_pct.toFixed(1)}% – unter dem empfohlenen Minimum von 20%.`)),e.strategies?.demand){let s=e.strategies.demand;s.confidence>.6&&!s.reasoning.includes("Zu wenig Daten")&&(s.reasoning.includes("wachsend")||s.reasoning.includes("steigend")?t.push("Die Nachfrage zeigt einen positiven Trend – eine moderate Preiserh\xf6hung k\xf6nnte m\xf6glich sein."):(s.reasoning.includes("r\xfcckl\xe4ufig")||s.reasoning.includes("sinkend"))&&t.push("Die Nachfrage ist r\xfcckl\xe4ufig – eine Preissenkung k\xf6nnte den Absatz stabilisieren."))}return t.length<2&&(t.push("Die Empfehlung basiert auf einer Analyse deiner aktuellen Preislage und Marktvergleichen."),t.push("Der empfohlene Preis optimiert deine Wettbewerbsposition bei gleichbleibender Profitabilit\xe4t.")),t.slice(0,5)}(e),confidence:function(e){let t=(100*e.confidence).toFixed(1),s=e.ml_predictions?.combined_ml_confidence?(100*e.ml_predictions.combined_ml_confidence).toFixed(1):null,r=[];e.confidence>=.8?r.push("Hohe Sicherheit"):e.confidence>=.6?r.push("Moderate Sicherheit"):r.push("Eingeschr\xe4nkte Sicherheit"),r.push(`${t}%`);let n=[];return e.competitor_context&&n.push("Wettbewerbsvergleich"),e.strategies?.cost&&n.push("Kosten"),e.strategies?.inventory&&n.push("Bestand"),s&&n.push("historische Daten"),n.length>0&&r.push(`basierend auf ${n.join(", ")}`),s&&parseFloat(s)>90&&r.push(`und ML-Vorhersage (${s}%)`),r.join(": ")+"."}(e),insights:function(e){if(e.has_insights){let t=[];return e.competitor_context&&("most_expensive"===e.competitor_context.position&&e.competitor_context.price_diff_pct>30?t.push(`Du bist deutlich teurer als der Markt (${e.competitor_context.price_diff_pct.toFixed(1)}% \xfcber Durchschnitt).`):"cheapest"===e.competitor_context.position&&Math.abs(e.competitor_context.price_diff_pct)>20&&t.push(`Du bist deutlich g\xfcnstiger als der Markt – eine moderate Preiserh\xf6hung k\xf6nnte m\xf6glich sein.`)),e.margin&&!e.margin.is_safe&&t.push(`Achtung: Die empfohlene Preis\xe4nderung w\xfcrde deine Marge auf ${e.margin.margin_pct.toFixed(1)}% reduzieren.`),t.join(" ")||"Aktuell liegen keine besonderen Auff\xe4lligkeiten vor."}return"Aktuell liegen keine besonderen Auff\xe4lligkeiten vor. Die Empfehlung basiert auf Standardmodellen und den aktuellen Marktpreisen."}(e)}}({product_title:e.product_title||e.product_name,product_name:e.product_name,current_price:e.current_price,recommended_price:e.recommended_price,price_change_pct:e.price_change_pct,confidence:e.confidence,strategies:function(e){if(e.strategy_details&&Array.isArray(e.strategy_details)){let t={};return e.strategy_details.forEach(e=>{t[e.strategy]={price:e.recommended_price,confidence:e.confidence,strategy:e.strategy,reasoning:e.reasoning||""}}),t}let t=e.reasoning;if("object"==typeof t&&t?.strategies)return t.strategies}(e),competitor_context:function(e){if(e.competitor_data){let t=e.competitor_data,s=e.recommended_price,r="unknown";return t.avg&&(r=s>=.95*t.max?"most_expensive":s<=1.05*t.min?"cheapest":s>1.1*t.avg?"above_average":s<.9*t.avg?"below_average":"average"),{position:r,avg_price:t.avg||0,min_price:t.min||0,max_price:t.max||0,price_diff_pct:t.avg?(s-t.avg)/t.avg*100:0,competitor_count:t.prices?.length||0}}}(e),ml_predictions:function(e){let t=e.reasoning;if("object"==typeof t&&t?.ml_predictions)return t.ml_predictions}(e),margin:e.margin_analysis?{is_safe:e.margin_analysis.is_safe,margin_pct:e.margin_analysis.margin||0}:void 0,has_insights:e.warnings&&e.warnings.length>0});_.confidence;let M=async()=>{if(t){d(!0);try{await t(g)}catch(e){console.error("Failed to apply price:",e)}finally{d(!1)}}},S=async()=>{if(a){m(!0);try{await a()}catch(e){console.error("Failed to refresh:",e)}finally{m(!1)}}},$=e.product_title||e.product_name||`Product ${e.product_id}`,A=e.generated_at||e.created_at||new Date().toISOString();return(0,r.jsxs)("div",{className:"bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden",children:[(0,r.jsxs)("div",{className:"p-6 pb-4 bg-gradient-to-br from-blue-50 to-white",children:[(0,r.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,r.jsxs)("div",{className:"flex-1",children:[r.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-1",children:$}),(0,r.jsxs)("p",{className:"text-xs text-gray-500",children:[i("product_id"),": ",e.product_id]})]}),(0,r.jsxs)("span",{className:"inline-flex items-center rounded-full bg-emerald-50 px-3 py-1 text-xs font-medium text-emerald-700 border border-emerald-100",children:[Math.round(100*e.confidence),"% ",i("confidence")]})]}),_.headline&&r.jsx("div",{className:"mb-6",children:r.jsx("p",{className:"text-base font-medium text-gray-900",children:_.headline})}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-8 mb-4",children:[(0,r.jsxs)("div",{className:"bg-white rounded-lg p-4 border border-gray-200",children:[r.jsx("p",{className:"text-sm text-gray-600 mb-1 font-medium",children:i("current")}),r.jsx("p",{className:"text-3xl font-bold text-gray-900",children:k(e.current_price)})]}),(0,r.jsxs)("div",{className:`rounded-lg p-4 border-2 ${w?"bg-red-50 border-red-300":N?"bg-orange-50 border-orange-300":"bg-green-50 border-green-300"}`,children:[r.jsx("p",{className:`text-sm font-medium mb-1 ${w?"text-red-700":N?"text-orange-700":"text-green-700"}`,children:i("recommended")}),r.jsx("p",{className:`text-3xl font-bold ${w?"text-red-900":N?"text-orange-900":"text-green-900"}`,children:k(g)})]})]}),r.jsx("div",{className:"flex items-center justify-center mb-4",children:y?r.jsx("div",{className:"flex items-center gap-2 px-4 py-2 bg-gray-100 rounded-full",children:r.jsx("span",{className:"text-gray-600 font-medium",children:i("no_change")})}):(0,r.jsxs)("div",{className:`flex items-center gap-2 px-4 py-2 rounded-full ${j?"bg-blue-100":"bg-orange-100"}`,children:[r.jsx("span",{className:"text-2xl",children:j?"\uD83D\uDCC8":"\uD83D\uDCC9"}),(0,r.jsxs)("span",{className:`text-lg font-bold ${j?"text-blue-700":"text-orange-700"}`,children:[p>0?"+":"",k(p)]}),(0,r.jsxs)("span",{className:`text-lg font-semibold ${j?"text-blue-600":"text-orange-600"}`,children:["(",f>0?"+":"",D(f),")"]})]})}),r.jsx("div",{className:"mt-6 px-6",children:r.jsx(v,{confidence:e.confidence,reasoning:_.confidence,compact:!1,confidenceBasis:e.confidence_basis})}),e.strategy_details&&e.strategy_details.length>0&&(0,r.jsxs)("div",{className:"mt-6 p-4 bg-gradient-to-br from-blue-50 to-indigo-50 rounded-lg border-2 border-blue-300",children:[(0,r.jsxs)("h4",{className:"text-sm font-semibold text-indigo-900 mb-3 flex items-center gap-2",children:[r.jsx("span",{children:"\uD83E\uDDEE"}),"Wie wird ",p>0?"+":"",k(p)," berechnet?"]}),(0,r.jsxs)("p",{className:"text-xs text-indigo-800 mb-4 leading-relaxed",children:["Die Empfehlung ist ein ",r.jsx("strong",{children:"gewichteter Durchschnitt"}),", NICHT die Summe. Jede Strategie wird mit ihrer ",r.jsx("strong",{children:"Datenqualit\xe4t gewichtet"}),"."]}),(()=>{let t=e=>{let t=100*e;return t>=90?"Datenqualit\xe4t: Exzellent":t>=80?"Datenqualit\xe4t: Sehr gut":t>=70?"Datenqualit\xe4t: Gut":t>=60?"Datenqualit\xe4t: Ausreichend":"Datenqualit\xe4t: Begrenzt"};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"mb-4",children:[r.jsx("p",{className:"text-xs font-semibold text-indigo-900 mb-2",children:"1️⃣ Einzelne Strategien-Empfehlungen:"}),r.jsx("div",{className:"space-y-1.5",children:e.strategy_details.map((s,n)=>{let a=s.recommended_price-e.current_price;return(0,r.jsxs)("div",{className:"flex items-center justify-between text-xs py-1 px-3 bg-white/60 rounded",children:[(0,r.jsxs)("span",{className:"text-gray-700",children:[{competitive:"\uD83C\uDFEA",demand:"\uD83D\uDCCA",inventory:"\uD83D\uDCE6",cost:"\uD83D\uDCB0"}[s.strategy]||"⚖️"," ",i(`strategy_${s.strategy}`)," (",t(s.confidence),")"]}),(0,r.jsxs)("span",{className:"font-mono font-bold text-gray-900",children:[a>0?"+":"",k(a)]})]},n)})})]}),(0,r.jsxs)("div",{className:"mb-4 p-3 bg-white/80 rounded-lg border border-indigo-200",children:[r.jsx("p",{className:"text-xs font-semibold text-indigo-900 mb-3",children:"2️⃣ Gewichtete Beitr\xe4ge (Datenqualit\xe4t \xd7 Basis-Gewicht):"}),r.jsx("div",{className:"space-y-2.5",children:e.strategy_details.map((s,n)=>{let a={competitive:.35,demand:.4,inventory:.25,cost:.25},l=a[s.strategy]||.1,c=l*s.confidence/(e.strategy_details||[]).reduce((e,t)=>e+(a[t.strategy]||.1)*t.confidence,0),d=(s.recommended_price-e.current_price)*c;return(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex items-center justify-between text-[10px] mb-1",children:[(0,r.jsxs)("span",{className:"text-indigo-700 font-medium",children:[i(`strategy_${s.strategy}`),":"]}),(0,r.jsxs)("span",{className:"font-mono text-indigo-900",children:[(100*l).toFixed(0),"% \xd7 ",t(s.confidence)," =",(0,r.jsxs)("strong",{className:"ml-1 text-indigo-600",children:[(100*c).toFixed(1),"%"]})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[r.jsx("div",{className:"flex-1 h-2.5 bg-gray-200 rounded-full overflow-hidden",children:r.jsx("div",{className:"h-full bg-gradient-to-r from-indigo-400 to-indigo-600 transition-all duration-500",style:{width:`${100*c}%`}})}),(0,r.jsxs)("span",{className:"text-xs font-bold text-indigo-900 tabular-nums min-w-[70px] text-right",children:["= ",d>0?"+":"",k(d)]})]})]},n)})})]})]})})(),(0,r.jsxs)("div",{className:"p-4 bg-gradient-to-r from-indigo-100 via-purple-100 to-indigo-100 rounded-xl border-2 border-indigo-400 shadow-sm",children:[r.jsx("p",{className:"text-xs font-semibold text-indigo-900 mb-2",children:"3️⃣ Finale Summe (Gewichteter Durchschnitt):"}),(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[r.jsx("span",{className:"text-sm text-indigo-800 font-medium",children:"Summe aller gewichteten Beitr\xe4ge"}),(0,r.jsxs)("div",{className:"text-right",children:[(0,r.jsxs)("div",{className:"text-3xl font-bold text-indigo-900 tabular-nums",children:[p>0?"+":"",k(p)]}),(0,r.jsxs)("div",{className:"text-xs text-indigo-700 mt-1",children:["(",D(f),")"]})]})]})]}),r.jsx("div",{className:"mt-3 p-3 bg-yellow-50 rounded-lg border border-yellow-300",children:(0,r.jsxs)("div",{className:"flex items-start gap-2",children:[r.jsx("span",{className:"text-lg flex-shrink-0",children:"\uD83D\uDCA1"}),(0,r.jsxs)("p",{className:"text-xs text-yellow-900 leading-relaxed",children:[r.jsx("strong",{children:"Warum nicht die einfache Summe?"})," Jede Strategie wird basierend auf ihrer Datenqualit\xe4t unterschiedlich stark gewichtet. Faktoren mit exzellenter Datenqualit\xe4t (z.B. Wettbewerbspreise) haben mehr Einfluss als Faktoren mit guter Datenqualit\xe4t (z.B. Nachfrage-Trends). Die gewichtete Berechnung stellt sicher, dass weniger zuverl\xe4ssige Daten nicht zu starken Einfluss haben."]})]})})]}),e.strategy_details&&e.strategy_details.length>0&&r.jsx("div",{className:"mt-6",children:r.jsx(C,{recommendedPrice:g,currentPrice:e.current_price,strategyDetails:e.strategy_details,competitorData:e.competitor_data})}),(t||s)&&r.jsx(P,{recommendedPrice:g,onApply:M,onDismiss:s||(()=>{}),isApplying:c,isDisabled:w,marginAnalysis:e.margin_analysis})]}),w&&r.jsx("div",{className:"px-6 py-4 bg-red-50 border-t border-red-200",children:(0,r.jsxs)("div",{className:"flex items-start gap-3",children:[r.jsx(x,{className:"w-6 h-6 text-red-600 flex-shrink-0 mt-0.5"}),(0,r.jsxs)("div",{children:[r.jsx("h4",{className:"font-semibold text-red-900 mb-1",children:i("critical_warning")}),e.warnings?.filter(e=>"HIGH"===e.severity||"high"===e.severity).map((e,t)=>r.jsx("p",{className:"text-sm text-red-800 mb-2",children:e.message},t))]})]})}),(0,r.jsxs)("div",{className:"px-6 py-3 bg-gray-50 border-t border-gray-200 flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[r.jsx(u,{className:"w-4 h-4"}),r.jsx("span",{children:function(e){let t=new Date,s=new Date(e),r=Math.floor((t.getTime()-s.getTime())/6e4);if(r<1)return"just now";if(1===r)return"1 minute ago";if(r<60)return`${r} minutes ago`;let n=Math.floor(r/60);if(1===n)return"1 hour ago";if(n<24)return`${n} hours ago`;let a=Math.floor(n/24);return 1===a?"1 day ago":`${a} days ago`}(A)})]}),a&&(0,r.jsxs)("button",{onClick:S,disabled:o,className:"flex items-center gap-2 px-3 py-1.5 text-sm font-medium text-blue-600 hover:bg-blue-50 rounded-lg transition-colors disabled:opacity-50",children:[r.jsx(h,{className:`w-4 h-4 ${o?"animate-spin":""}`}),r.jsx("span",{children:l("refresh")})]})]})]})}function S({productId:e,competitorCount:t,salesDataDays:s,onRunAnalysis:n}){return(0,r.jsxs)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-6",children:[(0,r.jsxs)("h3",{className:"font-bold text-xl text-yellow-800 mb-2",children:["⚠️ Erstmalige Analyse f\xfcr Produkt #",e]}),0===t&&r.jsx("div",{className:"bg-white p-4 rounded-lg border-l-4 border-orange-400 mb-3",children:(0,r.jsxs)("div",{className:"flex items-start gap-3",children:[r.jsx("span",{className:"text-2xl",children:"\uD83D\uDD0D"}),(0,r.jsxs)("div",{className:"flex-1",children:[r.jsx("h4",{className:"font-semibold text-gray-900 mb-1",children:"Wettbewerbsanalyse l\xe4uft..."}),r.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Wir sammeln gerade Preisdaten von Wettbewerbern f\xfcr dieses Produkt."}),n&&r.jsx("button",{onClick:n,className:"text-blue-600 underline hover:text-blue-800 text-sm font-medium mt-2",children:"Jetzt sofort analysieren →"})]})]})}),s<7&&r.jsx("div",{className:"bg-white p-4 rounded-lg border-l-4 border-blue-400",children:(0,r.jsxs)("div",{className:"flex items-start gap-3",children:[r.jsx("span",{className:"text-2xl",children:"\uD83D\uDCC8"}),(0,r.jsxs)("div",{className:"flex-1",children:[r.jsx("h4",{className:"font-semibold text-gray-900 mb-1",children:"Verkaufsdaten werden gesammelt"}),(0,r.jsxs)("p",{className:"text-sm text-gray-600",children:["Aktuell: ",(0,r.jsxs)("span",{className:"font-semibold",children:[s," Tage"]}),". Optimal: ",r.jsx("span",{className:"font-semibold text-green-600",children:"30+ Tage"})]}),r.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Mehr Verkaufsdaten f\xfchren zu pr\xe4ziseren Preisempfehlungen."})]})]})}),t>0&&s>=7&&r.jsx("div",{className:"bg-green-50 p-4 rounded-lg border-l-4 border-green-400",children:(0,r.jsxs)("div",{className:"flex items-start gap-3",children:[r.jsx("span",{className:"text-2xl",children:"✅"}),(0,r.jsxs)("div",{className:"flex-1",children:[r.jsx("h4",{className:"font-semibold text-gray-900 mb-1",children:"Datenbasis vorhanden"}),r.jsx("p",{className:"text-sm text-gray-600",children:"Wir haben genug Daten f\xfcr eine erste Analyse. Die Empfehlung wird mit mehr Daten pr\xe4ziser."})]})]})})]})}function $({productId:e}){let[t,s]=(0,n.useState)(null),[a,i]=(0,n.useState)(!1),[l,m]=(0,n.useState)(!1),[x,u]=(0,n.useState)(null),{currentShop:h,isDemoMode:g}=(0,c.L)(),p=async()=>{if(!e)return;let t="string"==typeof e?parseInt(e,10):e;if(isNaN(t)){u("Ung\xfcltige Produkt-ID");return}i(!0),u(null);try{console.log("[LatestRecommendation] \uD83D\uDD04 Generating FRESH recommendation for product:",t);let e=await (0,d.n8)(t);console.log("[LatestRecommendation] ✅ Fresh recommendation generated:",e);let r=e.recommendation||e;if(r){console.log("[LatestRecommendation] Recommendation data:",r),r.product_name||(r.product_name=e.product_name||`Product ${r.product_id}`),!r.current_price&&e.current_price&&(r.current_price=e.current_price);let t=r.reasoning;if("string"==typeof r.reasoning)try{t=JSON.parse(r.reasoning)}catch{t=r.reasoning}r.reasoning=t,console.log("[LatestRecommendation] ✅ Setting fresh recommendation:",r),s(r)}else console.log("[LatestRecommendation] No recommendation in response"),s(null)}catch(e){console.error("[LatestRecommendation] Error generating recommendation:",e),console.error("[LatestRecommendation] Error details:",e.response||e.message),u(e.message||"Fehler beim Generieren der Empfehlung"),s(null)}finally{i(!1)}},b=async()=>{if(!e){alert("Bitte w\xe4hle eine Produkt-ID aus!");return}if(isNaN("string"==typeof e?parseInt(e,10):e)){alert("Ung\xfcltige Produkt-ID");return}m(!0),u(null);try{console.log("[LatestRecommendation] \uD83D\uDD04 Manual refresh requested"),await p()}catch(e){console.error("[LatestRecommendation] Error generating recommendation:",e),u(e.message||"Fehler beim Generieren der Empfehlung")}finally{m(!1)}},f=async t=>{if(!e){alert("Bitte w\xe4hle eine Produkt-ID aus!");return}if(g){alert("Demo Mode: Preis kann nicht auf Shopify angewendet werden.");return}if(!h?.id){alert("Kein Shop ausgew\xe4hlt. Bitte w\xe4hle einen Shop aus.");return}let s="string"==typeof e?parseInt(e,10):e;if(isNaN(s)){alert("Ung\xfcltige Produkt-ID");return}try{console.log("[LatestRecommendation] Applying price:",{productIdNum:s,price:t,shopId:h.id});let e=await o({product_id:s,recommended_price:t});console.log("[LatestRecommendation] Price applied successfully:",e),alert(`Preis erfolgreich auf Shopify aktualisiert: €${e.new_price.toFixed(2)}`),await p()}catch(e){throw console.error("[LatestRecommendation] Error applying price:",e),alert(`Fehler beim Anwenden des Preises: ${e.message||"Unbekannter Fehler"}`),e}};if((0,n.useEffect)(()=>{p()},[e]),a||l)return(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 space-y-4",children:[r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),(0,r.jsxs)("div",{className:"text-gray-600 text-center",children:[r.jsx("p",{className:"font-medium",children:"Analysiere aktuelle Marktdaten..."}),r.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Pr\xfcfe Wettbewerber, analysiere 90 Tage Verkaufsdaten..."})]})]});if(x)return(0,r.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[r.jsx("p",{className:"text-red-700 text-sm",children:x}),r.jsx("button",{onClick:p,className:"mt-2 px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 text-sm",children:"Erneut versuchen"})]});if(!t)return r.jsx(S,{productId:e,competitorCount:0,salesDataDays:0,onRunAnalysis:b});let j=!t.confidence||t.confidence===-1/0||t.confidence<0||isNaN(t.confidence),y=t.competitor_avg_price?1:0,N=t.sales_7d?7:0;if(j||0===y&&N<7)return r.jsx(S,{productId:e,competitorCount:y,salesDataDays:N,onRunAnalysis:b});let v=t.reasoning,w="object"==typeof v&&null!==v?v:{},_=w.strategies||{},k=[];k=t.strategy_details&&Array.isArray(t.strategy_details)?t.strategy_details:t.strategyDetails&&Array.isArray(t.strategyDetails)?t.strategyDetails:Object.entries(_).map(([e,s])=>({strategy:e,recommended_price:s?.price||s?.recommended_price||t.recommended_price,confidence:s?.confidence||.5,reasoning:s?.reasoning||"",competitor_context:s?.competitor_context||s?.competitive?.competitor_context}));let D=_.competitive?.competitor_context||_.competitive?.competitor_context,P=t.competitor_avg_price?{avg:t.competitor_avg_price,min:D?.min_price||.9*t.competitor_avg_price,max:D?.max_price||1.1*t.competitor_avg_price,prices:D?.sources?.map((e,s)=>({source:e,price:t.competitor_avg_price*(.9+.05*s)}))||[]}:void 0,C={product_id:t.product_id,product_name:t.product_name,current_price:t.current_price,recommended_price:t.recommended_price,price_change:t.recommended_price-t.current_price,price_change_pct:t.price_change_pct,confidence:t.confidence,reasoning:"string"==typeof v?v:w.summary||JSON.stringify(w),strategy_details:k.length>0?k:void 0,competitor_data:P,created_at:t.created_at,generated_at:t.created_at};return r.jsx("div",{className:"space-y-6",children:r.jsx(M,{recommendation:C,onRefresh:b,onDismiss:()=>{},onApply:f})})}function A({competitors:e,yourPrice:t}){let[s,a]=(0,n.useState)("all");if(!e||0===e.length)return(0,r.jsxs)("div",{className:"text-center py-4 text-gray-500",children:[r.jsx("p",{className:"font-medium mb-2",children:"❓ Unbekannt"}),r.jsx("p",{className:"text-sm",children:"Keine Wettbewerber gefunden"}),r.jsx("p",{className:"text-xs mt-2 text-gray-400",children:"Die Suche hat keine Ergebnisse zur\xfcckgegeben. M\xf6gliche Gr\xfcnde:"}),(0,r.jsxs)("ul",{className:"text-xs mt-2 text-gray-400 text-left max-w-md mx-auto",children:[r.jsx("li",{children:"• Produktname zu spezifisch oder ungew\xf6hnlich"}),r.jsx("li",{children:"• Serper API Key fehlt oder ist ung\xfcltig"}),r.jsx("li",{children:"• Rate Limit erreicht (2500 Calls/Monat)"}),r.jsx("li",{children:"• Keine Shopping-Ergebnisse f\xfcr dieses Produkt verf\xfcgbar"})]})]});let i=e=>{let t=(e.title||"").toLowerCase(),s=(e.source||"").toLowerCase();return t.includes("gebraucht")||t.includes("used")||t.includes("wie neu")||t.includes("zustand")||s.includes("kleinanzeigen")||s.includes("willhaben")||s.includes("shpock")||s.includes("vinted")?"used":t.includes("refurbished")||t.includes("general\xfcberholt")?"refurbished":"new"},l=[...e.filter(e=>"all"===s||i(e)===s)].sort((e,t)=>e.price-t.price),c=e.filter(e=>"new"===i(e)).length,d=e.filter(e=>"used"===i(e)).length,o=e.filter(e=>"refurbished"===i(e)).length,m=l.every(e=>e.price<t),x=l.length>0?Math.max(...l.map(e=>e.price)):0,u=(e,t)=>0===e?{label:"G\xdcNSTIGSTER",icon:"\uD83D\uDFE2"}:e===t-1?{label:"TEUERSTER",icon:"\uD83D\uDD34"}:{label:`#${e+1}`,icon:"\uD83D\uDFE1"};return(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[(0,r.jsxs)("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[r.jsx("span",{children:"\uD83D\uDCB0"}),e.length," WETTBEWERBER IM VERGLEICH"]}),(0,r.jsxs)("div",{className:"flex gap-2 mb-6",children:[r.jsx("button",{className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${"all"===s?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,onClick:()=>a("all"),children:"Alle"}),c>0&&(0,r.jsxs)("button",{className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${"new"===s?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,onClick:()=>a("new"),children:["Nur Neuware (",c,")"]}),d>0&&(0,r.jsxs)("button",{className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${"used"===s?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,onClick:()=>a("used"),children:["Nur Gebraucht (",d,")"]}),o>0&&(0,r.jsxs)("button",{className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${"refurbished"===s?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,onClick:()=>a("refurbished"),children:["Nur Refurbished (",o,")"]})]}),r.jsx("div",{className:"space-y-4",children:l.map((e,s)=>{let{label:n,icon:a}=u(s,l.length),c=i(e),d=t-e.price,o=Math.round(d/t*100);return(0,r.jsxs)("div",{className:"border-2 rounded-lg p-5 hover:shadow-md transition-shadow",children:[(0,r.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[r.jsx("span",{className:"text-2xl",children:a}),(0,r.jsxs)("div",{children:[r.jsx("div",{className:"text-xs text-gray-500 uppercase tracking-wide",children:n}),r.jsx("div",{className:"text-xl font-bold",children:e.source})]})]}),r.jsx("div",{className:"text-right",children:r.jsx("div",{className:"text-2xl font-bold text-gray-900",children:k(e.price)})})]}),r.jsx("div",{className:"mb-3",children:r.jsx("p",{className:"text-sm text-gray-700 line-clamp-2",children:e.title})}),(0,r.jsxs)("div",{className:"flex items-center gap-4 text-sm mb-4",children:[e.rating&&(0,r.jsxs)("span",{className:"text-gray-600",children:["⭐ ",e.rating.toFixed(1)," Sterne"]}),r.jsx("span",{className:`px-3 py-1 rounded-full font-medium ${"new"===c?"bg-green-100 text-green-800":"refurbished"===c?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"}`,children:"new"===c?"Neuware":"refurbished"===c?"Refurbished":"Gebraucht"})]}),r.jsx("div",{className:"bg-blue-50 border-l-4 border-blue-400 p-3 rounded",children:(0,r.jsxs)("p",{className:"text-sm font-medium text-blue-900",children:["\uD83D\uDCA1 ",k(Math.abs(d))," g\xfcnstiger als du (",o>0?"-":"+",Math.abs(o),"%)"]})})]},s)})}),m&&l.length>0&&r.jsx("div",{className:"mt-6 bg-orange-50 border-l-4 border-orange-400 p-4",children:(0,r.jsxs)("p",{className:"text-sm font-medium text-orange-900",children:["⚠️ ",r.jsx("strong",{children:"WICHTIG:"})," Selbst der teuerste Wettbewerber ist"," ",k(t-x)," g\xfcnstiger als dein aktueller Preis!"]})})]})}let E=["kleinanzeigen","ebay kleinanzeigen","willhaben","facebook marketplace","shpock","vinted","ebay"],F=["bundle","set","kit","paket","creator edition","limited edition","special edition","travel bundle","starter kit","combo","pack","+","mit","inkl.","inklusive","includes","enth\xe4lt","zubeh\xf6r","accessories"];function z(e){let t=e.toLowerCase();for(let e of F)if(t.includes(e)){if("edition"===e&&t.includes("standard edition"))continue;return!0}return!!(/\+\s*[A-Za-z]/.test(e)||/mit\s+[A-Za-z]/.test(t))}function I(e){return new Intl.NumberFormat("de-DE",{style:"currency",currency:"EUR",minimumFractionDigits:2,maximumFractionDigits:2}).format(e)}let K=e=>null,B=(e,t)=>{};function T({productId:e,currentPrice:t}){let[s,a]=(0,n.useState)(!1),[i,l]=(0,n.useState)(null),[c,o]=(0,n.useState)(null);(0,n.useEffect)(()=>{let t=K(e);t&&l(t)},[e]);let m=async(t=!1)=>{a(!0),o(null);try{let s=await (0,d.Ow)(e,{maxResults:5,forceRefresh:t});l(s),B(e,s)}catch(t){console.error("[CompetitorAnalysis] Fehler beim Laden:",t);let e="Fehler beim Laden der Wettbewerber-Daten";t?.response?.status===404?e="Produkt nicht gefunden. Pr\xfcfe Shop-Auswahl und Produkt-ID.":t?.response?.status===429?e="API-Limit erreicht. Bitte sp\xe4ter erneut versuchen.":t?.response?.status===500?e="Server-Fehler. Bitte sp\xe4ter erneut versuchen oder Support kontaktieren.":t?.message&&(e=t.message),o(e)}finally{a(!1)}},x=(()=>{if(!i||!i.competitors||0===i.competitors.length)return null;let e=i.competitors.map(e=>e.price),s=Math.min(...e),r=Math.max(...e),n=e.reduce((e,t)=>e+t,0)/e.length,a=t-n,l=n>0?(t-n)/n*100:0,c=i.competitors.filter(e=>{let t=(e.title||"").toLowerCase(),s=(e.source||"").toLowerCase();return!(t.includes("gebraucht")||t.includes("used")||s.includes("kleinanzeigen")||s.includes("willhaben"))&&!(t.includes("refurbished")||t.includes("general\xfcberholt"))}),d=i.competitors.filter(e=>{let t=(e.title||"").toLowerCase(),s=(e.source||"").toLowerCase();return t.includes("gebraucht")||t.includes("used")||s.includes("kleinanzeigen")||s.includes("willhaben")}),o=c.length>0?Math.min(...c.map(e=>e.price)):null,m=c.length>0?Math.max(...c.map(e=>e.price)):null,x=d.length>0?Math.min(...d.map(e=>e.price)):null;return{minPrice:s,maxPrice:r,avgPrice:n,priceSpread:r-s,yourPriceDiff:a,percentAboveAvg:l,competitorCount:i.competitors.length,newCount:c.length,usedCount:d.length,newMin:o,newMax:m,usedMin:x}})(),u=i?function(e){var t;let s=e.offers.filter(e=>!("new"!==e.condition||function(e){let t=e.toLowerCase();for(let e of E)if(t.includes(e))return!0;return!1}(e.source)||z(e.title))),r=function(e){if(0===e.length)return{core_count:0,core_min:0,core_max:0,core_avg:0,price_spread_pct:0};let t=e.map(e=>e.price).sort((e,t)=>e-t),s=Math.round(100*t[0])/100,r=Math.round(100*t[t.length-1])/100,n=Math.round(t.reduce((e,t)=>e+t,0)/t.length*100)/100;return{core_count:e.length,core_min:s,core_max:r,core_avg:n,price_spread_pct:Math.round(100*(n>0?(r-s)/n*100:0))/100}}(s),n=function(e,t){if(0===t)return"unbekannt";let s=(e-t)/t*100;return s<-15?"deutlich unter Durchschnitt":s<-5?"unter Durchschnitt":s<=5?"im Bereich des Durchschnitts":s<=20?"\xfcber Durchschnitt":"deutlich \xfcber Durchschnitt"}(e.our_price,r.core_avg),a=e.data_age_days||0,i=function(e,t,s){let r=[],n=!1;return e<3&&(n=!0,r.push("zu wenig vergleichbare Angebote")),t>7&&(n=!0,r.push(`Daten sind ${t} Tage alt`)),s>40&&(n=!0,r.push("sehr hohe Preisstreuung")),{isUncertain:n,reasons:r}}(r.core_count,a,r.price_spread_pct),l=e.offers.filter(e=>"used"===e.condition),c=e.offers.filter(e=>"new"===e.condition&&z(e.title)),d=l.length>0?Math.round(100*Math.min(...l.map(e=>e.price)))/100:null,o=c.length>0?Math.round(100*Math.min(...c.map(e=>e.price)))/100:null,m=function(e,t,s){if(0===s)return"Keine vergleichbaren Neuware-Angebote gefunden.";if(1===s){let s=e-t.core_avg,r=s>0?`${I(Math.abs(s))} teurer`:`${I(Math.abs(s))} g\xfcnstiger`;return`Du liegst mit ${I(e)} ${r} als das einzige vergleichbare Neuware-Angebot (${I(t.core_avg)}).`}let r=t.core_avg>0?(e-t.core_avg)/t.core_avg*100:0;if(1>Math.abs(r))return`Du liegst mit ${I(e)} nahe am Marktdurchschnitt von ${I(t.core_avg)}.`;let n=Math.abs(r).toFixed(1);return`Du liegst mit ${I(e)} ${n}% ${r>0?"\xfcber":"unter"} dem Marktdurchschnitt von ${I(t.core_avg)}.`}(e.our_price,r,s.length);return{summary:m,marketOverview:function(e,t,s,r){let n=[];return 0===r?n.push("Keine vergleichbaren Neuware-Angebote gefunden."):1===r?n.push(`Nur 1 vergleichbares Neuware-Angebot gefunden (${I(e.core_avg)}).`):(n.push(`${r} vergleichbare Neuware-Angebote gefunden (Spanne: ${I(e.core_min)} – ${I(e.core_max)}).`),n.push(`Durchschnittspreis: ${I(e.core_avg)}.`)),null!==s&&n.push(`Bundles mit Zubeh\xf6r starten ab ${I(s)} (nicht in der Berechnung).`),null!==t&&n.push(`Gebrauchtangebote starten ab ${I(t)} (nicht in der Berechnung).`),n}(r,d,o,s.length),position:(t=e.our_price,0===r.core_count?"Vergleichsbasis fehlt – Position kann nicht bestimmt werden.":r.core_count<3?"Vergleichsbasis ist sehr d\xfcnn – Position kann nicht sicher bestimmt werden.":"im Bereich des Durchschnitts"===n?`Du liegst im Bereich des Marktdurchschnitts – wettbewerbsf\xe4hige Position.`:`Deine Position: ${n} (${I(t)} vs. Durchschnitt ${I(r.core_avg)}).`),dataQuality:function(e,t,s){if(!e.isUncertain){let e=0===t?"aktuell":1===t?"vor 1 Tag":`vor ${t} Tagen`;return`Wettbewerbsdaten sind zuverl\xe4ssig (${s} vergleichbare Angebote, Stand: ${e}).`}let r=e.reasons.join(", "),n=0===t?"aktuell":1===t?"vor 1 Tag":`vor ${t} Tagen`;return`Hinweis: Wettbewerbsdaten sind eingeschr\xe4nkt zuverl\xe4ssig (${r}, Stand: ${n}).`}(i,a,r.core_count)}}({product_title:i.product_title||"",our_price:t,offers:i.competitors.map(e=>{let t="new",s=(e.title||"").toLowerCase(),r=(e.source||"").toLowerCase();return s.includes("gebraucht")||s.includes("used")||r.includes("kleinanzeigen")||r.includes("willhaben")?t="used":(s.includes("refurbished")||s.includes("general\xfcberholt"))&&(t="refurbished"),{source:e.source||"Unknown",title:e.title||"",price:e.price,rating:e.rating,url:e.url||"",condition:t}}),data_age_days:0}):null,h=(()=>{if(!x)return{label:"Unbekannt",color:"gray",explanation:""};let e=x.priceSpread/x.avgPrice>.4,t=x.competitorCount<3;return e||t?{label:"Eingeschr\xe4nkt zuverl\xe4ssig",color:"orange",explanation:e?"sehr hohe Preisstreuung":"zu wenig vergleichbare Angebote"}:{label:"Zuverl\xe4ssig",color:"green",explanation:""}})();return(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("h3",{className:"text-lg font-bold flex items-center gap-2",children:[r.jsx("span",{children:"\uD83C\uDFE2"}),"Wettbewerbsanalyse"]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[i&&r.jsx("button",{onClick:()=>m(!0),disabled:s,className:"text-sm text-gray-600 hover:text-gray-900 px-3 py-1 rounded hover:bg-gray-100 disabled:opacity-50",children:"\uD83D\uDD04 Aktualisieren"}),r.jsx("button",{onClick:()=>m(!1),disabled:s,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50 transition",children:s?"Suche l\xe4uft...":i?"Erneut suchen":"Wettbewerber suchen"})]})]}),i&&u&&u.dataQuality.includes("eingeschr\xe4nkt")&&r.jsx("div",{className:"mt-4 p-3 bg-orange-50 border-l-4 border-orange-400 rounded",children:(0,r.jsxs)("p",{className:"text-sm font-medium text-orange-900",children:["⚠️ Hinweis: ",u.dataQuality]})})]}),s&&(0,r.jsxs)("div",{className:"text-center py-8",children:[r.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),r.jsx("p",{className:"text-gray-600",children:"Suche Wettbewerber-Preise..."})]}),c&&(0,r.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 text-red-700",children:[r.jsx("p",{className:"text-sm font-medium mb-1",children:"⚠️ Fehler"}),r.jsx("p",{className:"text-sm",children:c})]}),i&&!s&&x&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[(0,r.jsxs)("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[r.jsx("span",{children:"\uD83D\uDCCA"}),"DEINE MARKTPOSITION AUF EINEN BLICK"]}),(0,r.jsxs)("div",{className:"bg-gradient-to-r from-green-50 via-yellow-50 to-red-50 rounded-lg p-6 mb-4",children:[(0,r.jsxs)("div",{className:"flex justify-between text-sm mb-3",children:[(0,r.jsxs)("div",{children:[r.jsx("div",{className:"text-gray-600 mb-1",children:"\uD83D\uDCB6 G\xfcnstigster"}),r.jsx("div",{className:"text-xl font-bold text-green-700",children:k(x.minPrice)})]}),(0,r.jsxs)("div",{className:"text-center",children:[r.jsx("div",{className:"text-gray-600 mb-1",children:"\uD83D\uDCB6 \xd8-Preis"}),r.jsx("div",{className:"text-xl font-bold text-gray-800",children:k(x.avgPrice)})]}),(0,r.jsxs)("div",{className:"text-right",children:[r.jsx("div",{className:"text-gray-600 mb-1",children:"\uD83D\uDCB6 Teuerster"}),r.jsx("div",{className:"text-xl font-bold text-orange-700",children:k(x.maxPrice)})]})]}),(0,r.jsxs)("div",{className:"relative mt-6",children:[r.jsx("div",{className:"h-3 bg-gradient-to-r from-green-400 via-yellow-400 to-red-400 rounded-full"}),(0,r.jsxs)("div",{className:"absolute -top-1 w-5 h-5 bg-red-600 rounded-full border-3 border-white shadow-lg z-10",style:{left:`${Math.min(95,Math.max(5,(t-x.minPrice)/(x.maxPrice-x.minPrice)*100))}%`,transform:"translateX(-50%)"},children:[r.jsx("div",{className:"absolute -top-8 left-1/2 -translate-x-1/2 whitespace-nowrap",children:r.jsx("div",{className:"bg-red-600 text-white px-2 py-1 rounded text-xs font-bold",children:"DU"})}),r.jsx("div",{className:"absolute top-6 left-1/2 -translate-x-1/2 whitespace-nowrap",children:r.jsx("div",{className:"font-bold text-sm",children:k(t)})})]})]}),r.jsx("div",{className:"text-center mt-8",children:(0,r.jsxs)("span",{className:"inline-flex items-center px-4 py-2 rounded-full text-sm font-bold bg-red-100 text-red-800",children:["⚠️ Du bist ",x.percentAboveAvg.toFixed(1),"% teurer als der Durchschnitt"]})})]}),x.percentAboveAvg>50&&r.jsx("div",{className:"bg-red-50 border-l-4 border-red-500 p-4",children:(0,r.jsxs)("div",{className:"flex items-start gap-3",children:[r.jsx("span",{className:"text-2xl",children:"\uD83D\uDEA8"}),(0,r.jsxs)("div",{children:[r.jsx("h4",{className:"font-bold text-red-900 mb-1",children:"RISIKO: Du bist teurer als ALLE gefundenen Wettbewerber!"}),r.jsx("p",{className:"text-sm text-red-800",children:"Kunden werden wahrscheinlich zur Konkurrenz wechseln."})]})]})})]}),(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[(0,r.jsxs)("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[r.jsx("span",{children:"\uD83D\uDCC8"}),"MARKTDATEN IM \xdcBERBLICK"]}),(0,r.jsxs)("div",{className:"grid grid-cols-4 gap-4 mb-6",children:[(0,r.jsxs)("div",{className:"text-center p-4 bg-blue-50 rounded-lg",children:[r.jsx("div",{className:"text-3xl font-bold text-blue-700",children:x.competitorCount}),(0,r.jsxs)("div",{className:"text-sm text-gray-600 mt-1",children:["Gefunden",r.jsx("br",{}),"Anbieter"]})]}),(0,r.jsxs)("div",{className:"text-center p-4 bg-green-50 rounded-lg",children:[r.jsx("div",{className:"text-3xl font-bold text-green-700",children:k(x.avgPrice)}),r.jsx("div",{className:"text-sm text-gray-600 mt-1",children:"\xd8-Preis"})]}),(0,r.jsxs)("div",{className:"text-center p-4 bg-purple-50 rounded-lg",children:[r.jsx("div",{className:"text-3xl font-bold text-purple-700",children:k(x.priceSpread)}),(0,r.jsxs)("div",{className:"text-sm text-gray-600 mt-1",children:["Preis-",r.jsx("br",{}),"Spanne"]})]}),(0,r.jsxs)("div",{className:"text-center p-4 bg-red-50 rounded-lg",children:[(0,r.jsxs)("div",{className:"text-3xl font-bold text-red-700",children:["+",k(x.yourPriceDiff)]}),(0,r.jsxs)("div",{className:"text-sm text-gray-600 mt-1",children:["Du vs \xd8",r.jsx("br",{}),"teurer"]})]})]}),(0,r.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,r.jsxs)("h4",{className:"font-semibold mb-3 flex items-center gap-2",children:[r.jsx("span",{children:"\uD83D\uDCE6"}),"Produktzustand:"]}),(0,r.jsxs)("ul",{className:"space-y-2 text-sm",children:[x.newCount>0&&(0,r.jsxs)("li",{className:"flex items-start gap-2",children:[r.jsx("span",{className:"text-green-600",children:"• "}),(0,r.jsxs)("span",{children:[r.jsx("strong",{children:"Neuware:"})," ",x.newCount," Anbieter bieten von"," ",x.newMin&&k(x.newMin)," - ",x.newMax&&k(x.newMax)]})]}),x.usedCount>0&&(0,r.jsxs)("li",{className:"flex items-start gap-2",children:[r.jsx("span",{className:"text-gray-600",children:"• "}),(0,r.jsxs)("span",{children:[r.jsx("strong",{children:"Gebraucht:"})," ",x.usedCount," Anbieter bieten ab"," ",x.usedMin&&k(x.usedMin)]})]})]})]})]}),r.jsx(A,{competitors:i.competitors,yourPrice:t}),(0,r.jsxs)("div",{className:"bg-gray-50 rounded-lg border border-gray-200 p-6",children:[(0,r.jsxs)("h3",{className:"text-lg font-semibold mb-3 flex items-center gap-2",children:[r.jsx("span",{children:"⚙️"}),"DATENQUALIT\xc4T & AKTUALIT\xc4T"]}),(0,r.jsxs)("div",{className:"flex items-start gap-4",children:[(0,r.jsxs)("div",{className:`px-4 py-2 rounded-lg font-medium ${"green"===h.color?"bg-green-100 text-green-800":"bg-orange-100 text-orange-800"}`,children:["Eingeschr\xe4nkt zuverl\xe4ssig"===h.label?"⚠️ ":"✅ ",h.label]}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsxs)("p",{className:"text-sm text-gray-700 mb-4",children:["Diese Daten sind ",r.jsx("strong",{children:"heute"})," aktualisiert worden, zeigen aber"," ",h.explanation||"eine normale Preisstreuung","."]}),(0,r.jsxs)("div",{className:"bg-white rounded-lg border p-4",children:[r.jsx("h4",{className:"font-medium mb-2 text-sm",children:"Das bedeutet:"}),(0,r.jsxs)("ul",{className:"space-y-1 text-sm text-gray-700",children:[(0,r.jsxs)("li",{className:"flex items-start gap-2",children:[r.jsx("span",{children:"- "}),r.jsx("span",{children:"Die Produkte k\xf6nnten unterschiedliche Varianten sein"})]}),(0,r.jsxs)("li",{className:"flex items-start gap-2",children:[r.jsx("span",{children:"- "}),r.jsx("span",{children:"Einige Angebote k\xf6nnten nicht mehr verf\xfcgbar sein"})]}),(0,r.jsxs)("li",{className:"flex items-start gap-2",children:[r.jsx("span",{children:"- "}),r.jsx("span",{children:"Preise k\xf6nnen sich schnell \xe4ndern"})]})]})]}),(0,r.jsxs)("p",{className:"text-sm text-blue-700 mt-4",children:["\uD83D\uDCA1 ",r.jsx("strong",{children:"Tipp:"}),' Nutze "Aktualisieren" um die neuesten Preise zu laden. Die Daten werden automatisch alle 24h erneuert.']})]})]})]})]}),!i&&!s&&!c&&(0,r.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[r.jsx("p",{children:"Noch keine Wettbewerber-Daten geladen."}),r.jsx("p",{className:"text-sm mt-2",children:'Klicke auf "Wettbewerber suchen" um zu starten.'})]})]})}let L=(0,m.Z)("trending-down",[["path",{d:"M16 17h6v-6",key:"t6n2it"}],["path",{d:"m22 17-8.5-8.5-5 5L2 7",key:"x473p"}]]),R=(0,m.Z)("dollar-sign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]),W=(0,m.Z)("pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]);function V({marginData:e,compact:t=!1,onAddCosts:s,onEditCosts:n}){if(!e.has_cost_data)return r.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:(0,r.jsxs)("div",{className:"flex items-start gap-3",children:[r.jsx("div",{className:"flex-shrink-0 w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:r.jsx("span",{className:"text-lg",children:"\uD83D\uDCA1"})}),(0,r.jsxs)("div",{className:"flex-1",children:[r.jsx("h3",{className:"text-sm font-semibold text-gray-900 mb-1",children:"Noch pr\xe4ziser mit Kostendaten"}),(0,r.jsxs)("p",{className:"text-xs text-gray-600 mb-3",children:["Die Preisempfehlung funktioniert auch ohne Kosten.",r.jsx("strong",{children:" Mit Kostendaten"})," k\xf6nnen wir zus\xe4tzlich deine ",r.jsx("strong",{children:"Marge optimieren"})," und sicherstellen, dass du immer profitabel bleibst."]}),s&&r.jsx("button",{onClick:s,className:"text-xs font-medium text-blue-600 hover:text-blue-700 underline transition",children:"Kosten hinterlegen (optional)"})]})]})});let a=e.is_above_min_margin?"text-green-600":e.is_above_break_even?"text-orange-600":"text-red-600",i=e.is_above_min_margin?"bg-green-50 border-green-200":e.is_above_break_even?"bg-orange-50 border-orange-200":"bg-red-50 border-red-200",l=e.is_above_min_margin?r.jsx(f.Z,{className:"w-5 h-5 text-green-600"}):e.is_above_break_even?r.jsx(x,{className:"w-5 h-5 text-orange-600"}):r.jsx(L,{className:"w-5 h-5 text-red-600"});return t?(0,r.jsxs)("div",{className:`inline-flex items-center gap-2 px-3 py-1.5 rounded-full border-2 ${i}`,children:[l,(0,r.jsxs)("span",{className:`font-semibold ${a}`,children:[e.margin?.percent.toFixed(1),"% Marge"]}),(0,r.jsxs)("span",{className:"text-sm text-gray-600",children:["(€",e.margin?.euro.toFixed(2),")"]})]}):(0,r.jsxs)("div",{className:"bg-white border-2 border-gray-200 rounded-xl p-6 space-y-4",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[r.jsx(R,{className:"w-6 h-6 text-gray-700"}),r.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Margin-Analyse"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsxs)("div",{className:`flex items-center gap-2 ${a}`,children:[l,(0,r.jsxs)("span",{className:"text-2xl font-bold",children:[e.margin?.percent.toFixed(1),"%"]})]}),e.has_cost_data&&n&&(0,r.jsxs)("button",{onClick:n,className:"flex items-center gap-2 px-3 py-1.5 text-sm font-medium text-blue-600 bg-blue-50 hover:bg-blue-100 border border-blue-200 rounded-lg transition-all",title:"Kosten bearbeiten","aria-label":"Kostendaten bearbeiten",children:[r.jsx(W,{className:"w-4 h-4"}),r.jsx("span",{className:"hidden sm:inline",children:"Bearbeiten"})]})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4 py-3 border-y",children:[(0,r.jsxs)("div",{children:[r.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Verkaufspreis"}),(0,r.jsxs)("p",{className:"text-xl font-semibold text-gray-900",children:["€",e.selling_price?.toFixed(2)]})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("p",{className:"text-sm text-gray-600 mb-1",children:["Nettoerl\xf6s",e.vat_rate&&(0,r.jsxs)("span",{className:"ml-1 text-xs",children:["(nach ",(100*e.vat_rate).toFixed(0),"% MwSt)"]})]}),(0,r.jsxs)("p",{className:"text-xl font-semibold text-gray-900",children:["€",e.net_revenue?.toFixed(2)]})]})]}),e.costs&&(0,r.jsxs)("div",{children:[r.jsx("p",{className:"text-sm font-medium text-gray-700 mb-3",children:"Variable Kosten:"}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("div",{className:"flex justify-between text-sm",children:[r.jsx("span",{className:"text-gray-600",children:"• Einkauf:"}),(0,r.jsxs)("span",{className:"font-medium text-gray-900",children:["€",e.costs.purchase.toFixed(2)]})]}),(0,r.jsxs)("div",{className:"flex justify-between text-sm",children:[r.jsx("span",{className:"text-gray-600",children:"• Versand:"}),(0,r.jsxs)("span",{className:"font-medium text-gray-900",children:["€",e.costs.shipping.toFixed(2)]})]}),(0,r.jsxs)("div",{className:"flex justify-between text-sm",children:[r.jsx("span",{className:"text-gray-600",children:"• Verpackung:"}),(0,r.jsxs)("span",{className:"font-medium text-gray-900",children:["€",e.costs.packaging.toFixed(2)]})]}),(0,r.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,r.jsxs)("span",{className:"text-gray-600",children:["• Payment Fee",e.payment_provider&&(0,r.jsxs)("span",{className:"ml-1 text-xs",children:["(",e.payment_provider,")"]}),":"]}),(0,r.jsxs)("span",{className:"font-medium text-gray-900",children:["€",e.costs.payment_fee.toFixed(2)]})]}),(0,r.jsxs)("div",{className:"flex justify-between text-sm font-semibold pt-2 border-t",children:[r.jsx("span",{className:"text-gray-900",children:"Gesamt:"}),(0,r.jsxs)("span",{className:"text-gray-900",children:["€",e.costs.total_variable.toFixed(2)]})]})]})]}),e.margin&&(0,r.jsxs)("div",{className:`p-4 rounded-lg border-2 ${i}`,children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[l,r.jsx("span",{className:"font-semibold text-gray-900",children:"Deckungsbeitrag I:"})]}),(0,r.jsxs)("div",{className:"flex items-baseline gap-3",children:[(0,r.jsxs)("span",{className:`text-3xl font-bold ${a}`,children:["€",e.margin.euro.toFixed(2)]}),(0,r.jsxs)("span",{className:`text-xl font-semibold ${a}`,children:["(",e.margin.percent.toFixed(1),"%)"]})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-3 pt-2",children:[e.break_even_price&&(0,r.jsxs)("div",{className:"text-sm",children:[r.jsx("p",{className:"text-gray-600 mb-1",children:"⚠️ Break-Even:"}),(0,r.jsxs)("p",{className:"font-semibold text-gray-900",children:["€",e.break_even_price.toFixed(2)]})]}),e.recommended_min_price&&(0,r.jsxs)("div",{className:"text-sm",children:[r.jsx("p",{className:"text-gray-600 mb-1",children:"✅ Min. empfohlen (20%):"}),(0,r.jsxs)("p",{className:"font-semibold text-green-600",children:["€",e.recommended_min_price.toFixed(2)]})]})]}),!e.is_above_break_even&&(0,r.jsxs)("div",{className:"bg-red-100 border border-red-300 rounded-lg p-3 text-sm",children:[r.jsx("p",{className:"font-semibold text-red-900 mb-1",children:"❌ KRITISCH: Unter Break-Even"}),r.jsx("p",{className:"text-red-800",children:"Dieser Preis liegt unter deinen Kosten. Du machst Verlust bei jedem Verkauf!"})]}),e.is_above_break_even&&!e.is_above_min_margin&&(0,r.jsxs)("div",{className:"bg-orange-100 border border-orange-300 rounded-lg p-3 text-sm",children:[r.jsx("p",{className:"font-semibold text-orange-900 mb-1",children:"⚠️ NIEDRIGE MARGE"}),r.jsx("p",{className:"text-orange-800",children:"Marge liegt unter der empfohlenen Mindestmarge von 20%. Ber\xfccksichtige Fixkosten und unerwartete Ausgaben."})]}),e.is_above_min_margin&&(0,r.jsxs)("div",{className:"bg-green-100 border border-green-300 rounded-lg p-3 text-sm",children:[r.jsx("p",{className:"font-semibold text-green-900 mb-1",children:"✅ GESUNDE MARGE"}),r.jsx("p",{className:"text-green-800",children:"Marge \xfcber 20% - gute Profitabilit\xe4t! Genug Puffer f\xfcr Fixkosten und Gewinn."})]})]})}let G=(0,m.Z)("info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]),U=(0,m.Z)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);var q=s(6064);function Z({isOpen:e,onClose:t,productId:s,productTitle:a,currentPrice:i,shopId:l,onSave:c}){let[o,m]=(0,n.useState)({purchase_cost:0,shipping_cost:0,packaging_cost:0,payment_provider:"stripe",country_code:"DE",category:void 0}),[x,u]=(0,n.useState)(!1),[h,g]=(0,n.useState)(!1),[p,b]=(0,n.useState)(!1),[f,j]=(0,n.useState)(null),[y,v]=(0,n.useState)(null),[w,k]=(0,n.useState)(!1),[D,P]=(0,n.useState)(null);(0,n.useEffect)(()=>{e&&s&&C()},[e,s]);let C=async()=>{try{u(!0),v(null);let e=await (0,d.Rd)(s);e?(P({purchase_cost:e.purchase_cost,shipping_cost:e.shipping_cost,packaging_cost:e.packaging_cost,payment_provider:e.payment_provider,country_code:e.country_code,category:e.category}),m({purchase_cost:e.purchase_cost,shipping_cost:e.shipping_cost,packaging_cost:e.packaging_cost,payment_provider:e.payment_provider,country_code:e.country_code,category:e.category}),k(!1)):(P(null),m({purchase_cost:0,shipping_cost:0,packaging_cost:0,payment_provider:"stripe",country_code:"DE",category:void 0}),k(!0),v(null))}catch(e){console.error("Failed to load costs:",e),e?.response?.status!==404&&e?.status!==404?v("Fehler beim Laden der Kosten"):(P(null),k(!0),v(null))}finally{u(!1)}};(0,n.useEffect)(()=>{o.category&&M(o.category)},[o.category]);let M=async e=>{try{let t=await (0,d.$m)(e);j(t)}catch(e){console.error("Failed to load category defaults:",e)}},S=async()=>{if(!i||!o.category){v("Bitte w\xe4hle zuerst eine Kategorie");return}u(!0),v(null);try{let e=await (0,d.R5)(i,o.category,o.country_code);m(t=>({...t,purchase_cost:e.estimated_purchase_cost,shipping_cost:e.estimated_shipping_cost,packaging_cost:e.estimated_packaging_cost})),b(!0)}catch(e){console.error("Failed to estimate costs:",e),v("Fehler beim Sch\xe4tzen der Kosten")}finally{u(!1)}},$=async()=>{if(o.purchase_cost<=0){v("Einkaufspreis muss gr\xf6\xdfer als 0 sein");return}g(!0),v(null);try{D?await (0,d._M)(s,o):await (0,d.QJ)(s,o),await c(o),await C(),k(!0)}catch(e){console.error("Failed to save costs:",e),v(e?.message||e?.detail||"Fehler beim Speichern der Kosten")}finally{g(!1)}};if(!e)return null;let A=o.purchase_cost+o.shipping_cost+o.packaging_cost,E=i?(i/1.19-A)/(i/1.19)*100:0;return(0,r.jsxs)(r.Fragment,{children:[r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40",onClick:t}),r.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-50 p-4",children:(0,r.jsxs)("div",{className:"bg-white rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[(0,r.jsxs)("div",{className:"flex items-start justify-between p-6 border-b sticky top-0 bg-white z-10",children:[(0,r.jsxs)("div",{className:"flex-1",children:[r.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-1",children:"Kosten hinterlegen"}),r.jsx("p",{className:"text-sm text-gray-600",children:a})]}),r.jsx("button",{onClick:t,className:"p-2 hover:bg-gray-100 rounded-full transition",children:r.jsx(_,{className:"w-6 h-6"})})]}),y&&r.jsx("div",{className:"mx-6 mt-4 p-3 bg-red-50 border border-red-200 rounded-lg text-red-800 text-sm",children:y}),(0,r.jsxs)("div",{className:"p-6 space-y-6",children:[D&&!w&&(0,r.jsxs)("div",{className:"bg-green-50 border-2 border-green-300 rounded-xl p-6 mb-8 shadow-md",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,r.jsxs)("div",{children:[r.jsx("h3",{className:"text-xl font-bold text-green-800 mb-1",children:"✅ Gespeicherte Kosten"}),r.jsx("p",{className:"text-sm text-green-700",children:"Klicke Bearbeiten um Werte anzupassen"})]}),(0,r.jsxs)("button",{onClick:()=>k(!0),className:"px-6 py-2 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 flex items-center gap-2 shadow-md transition-all hover:scale-105",title:"Kosten bearbeiten",children:[r.jsx(W,{className:"w-4 h-4"}),"Bearbeiten"]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm mb-6",children:[(0,r.jsxs)("div",{children:[r.jsx("span",{className:"text-gray-600",children:"Einkauf:"}),(0,r.jsxs)("span",{className:"font-bold ml-2 text-gray-900",children:["€",D.purchase_cost.toFixed(2)]})]}),(0,r.jsxs)("div",{children:[r.jsx("span",{className:"text-gray-600",children:"Versand:"}),(0,r.jsxs)("span",{className:"font-bold ml-2 text-gray-900",children:["€",D.shipping_cost.toFixed(2)]})]}),(0,r.jsxs)("div",{children:[r.jsx("span",{className:"text-gray-600",children:"Verpackung:"}),(0,r.jsxs)("span",{className:"font-bold ml-2 text-gray-900",children:["€",D.packaging_cost.toFixed(2)]})]}),(0,r.jsxs)("div",{children:[r.jsx("span",{className:"text-gray-600",children:"Payment:"}),r.jsx("span",{className:"font-bold ml-2 text-gray-900",children:D.payment_provider})]}),(0,r.jsxs)("div",{children:[r.jsx("span",{className:"text-gray-600",children:"MwSt:"}),r.jsx("span",{className:"font-bold ml-2 text-gray-900",children:D.country_code})]}),(0,r.jsxs)("div",{children:[r.jsx("span",{className:"text-gray-600",children:"Kategorie:"}),r.jsx("span",{className:"font-bold ml-2 text-gray-900",children:D.category||"N/A"})]})]}),r.jsx("div",{className:"pt-4 border-t border-green-300",children:(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[r.jsx("span",{className:"font-bold text-gray-900",children:"Gesamt Kosten:"}),(0,r.jsxs)("span",{className:"text-2xl font-bold text-green-600",children:["€",(D.purchase_cost+D.shipping_cost+D.packaging_cost).toFixed(2)]})]})})]}),(w||!D)&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Kategorie"}),(0,r.jsxs)("select",{value:o.category||"",onChange:e=>m(t=>({...t,category:e.target.value})),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[r.jsx("option",{value:"",children:"Kategorie w\xe4hlen..."}),["fashion","electronics","beauty","home","food"].map(e=>r.jsx("option",{value:e,children:e.charAt(0).toUpperCase()+e.slice(1)},e))]}),f&&r.jsx("div",{className:"mt-2 p-3 bg-blue-50 rounded-lg",children:(0,r.jsxs)("div",{className:"flex items-start gap-2",children:[r.jsx(G,{className:"w-4 h-4 text-blue-600 mt-0.5"}),(0,r.jsxs)("div",{className:"text-sm text-blue-900",children:[(0,r.jsxs)("p",{className:"font-medium",children:["Typisch f\xfcr ",o.category,":"]}),(0,r.jsxs)("p",{children:["Versand: €",f.shipping_estimate.toFixed(2),", Verpackung: €",f.packaging_estimate.toFixed(2)]}),r.jsx("button",{onClick:()=>{f&&m(e=>({...e,shipping_cost:f.shipping_estimate,packaging_cost:f.packaging_estimate}))},className:"text-blue-600 hover:text-blue-800 font-medium mt-1 underline",children:"→ Werte \xfcbernehmen"})]})]})})]}),i&&o.category&&(0,r.jsxs)("button",{onClick:S,disabled:x,className:"w-full flex items-center justify-center gap-2 py-3 px-4 bg-purple-100 text-purple-700 rounded-lg hover:bg-purple-200 transition disabled:opacity-50 disabled:cursor-not-allowed",children:[x?r.jsx(U,{className:"w-4 h-4 animate-spin"}):r.jsx(q.Z,{className:"w-4 h-4"}),r.jsx("span",{children:x?"Sch\xe4tze...":`Kosten sch\xe4tzen (Verkaufspreis: €${i.toFixed(2)})`})]}),p&&r.jsx("div",{className:"p-3 bg-yellow-50 border border-yellow-200 rounded-lg text-sm text-yellow-800",children:"⚠️ Dies sind Sch\xe4tzungen basierend auf Branchendurchschnitten. Bitte mit echten Daten ersetzen!"}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\uD83D\uDCB0 Einkaufspreis (netto) *"}),(0,r.jsxs)("div",{className:"relative",children:[r.jsx("input",{type:"number",step:"0.01",min:"0",value:o.purchase_cost||"",onChange:e=>m(t=>({...t,purchase_cost:parseFloat(e.target.value)||0})),className:"w-full px-4 py-2 pr-8 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"0.00",required:!0}),r.jsx("span",{className:"absolute right-3 top-2.5 text-gray-500",children:"€"})]})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\uD83D\uDCE6 Versandkosten (pro St\xfcck)"}),(0,r.jsxs)("div",{className:"relative",children:[r.jsx("input",{type:"number",step:"0.01",min:"0",value:o.shipping_cost||"",onChange:e=>m(t=>({...t,shipping_cost:parseFloat(e.target.value)||0})),className:"w-full px-4 py-2 pr-8 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"0.00"}),r.jsx("span",{className:"absolute right-3 top-2.5 text-gray-500",children:"€"})]})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\uD83D\uDCE6 Verpackung (pro St\xfcck)"}),(0,r.jsxs)("div",{className:"relative",children:[r.jsx("input",{type:"number",step:"0.01",min:"0",value:o.packaging_cost||"",onChange:e=>m(t=>({...t,packaging_cost:parseFloat(e.target.value)||0})),className:"w-full px-4 py-2 pr-8 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"0.00"}),r.jsx("span",{className:"absolute right-3 top-2.5 text-gray-500",children:"€"})]})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\uD83D\uDCB3 Payment Provider"}),r.jsx("select",{value:o.payment_provider,onChange:e=>m(t=>({...t,payment_provider:e.target.value})),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[{value:"stripe",label:"Stripe (2.9% + €0.30)"},{value:"paypal",label:"PayPal (2.49% + €0.35)"},{value:"klarna",label:"Klarna (4.5%)"},{value:"custom",label:"Custom"}].map(e=>r.jsx("option",{value:e.value,children:e.label},e.value))})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\uD83C\uDF0D Land (MwSt)"}),(0,r.jsxs)("select",{value:o.country_code,onChange:e=>m(t=>({...t,country_code:e.target.value})),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[r.jsx("option",{value:"DE",children:"Deutschland (19%)"}),r.jsx("option",{value:"AT",children:"\xd6sterreich (20%)"}),r.jsx("option",{value:"CH",children:"Schweiz (7.7%)"}),r.jsx("option",{value:"GB",children:"UK (20%)"}),r.jsx("option",{value:"US",children:"USA (0%)"})]})]})]}),(0,r.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4 space-y-2",children:[(0,r.jsxs)("div",{className:"flex justify-between text-sm",children:[r.jsx("span",{className:"text-gray-600",children:"Summe variable Kosten:"}),(0,r.jsxs)("span",{className:"font-semibold",children:["€",A.toFixed(2)]})]}),i&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"flex justify-between text-sm",children:[r.jsx("span",{className:"text-gray-600",children:"Aktueller Preis:"}),(0,r.jsxs)("span",{className:"font-semibold",children:["€",i.toFixed(2)]})]}),(0,r.jsxs)("div",{className:"flex justify-between text-lg font-bold pt-2 border-t",children:[r.jsx("span",{children:"Gesch\xe4tzte Marge:"}),(0,r.jsxs)("span",{className:E>=20?"text-green-600":"text-orange-600",children:[E.toFixed(1),"%"]})]})]})]})]})]}),r.jsx("div",{className:"flex gap-3 p-6 border-t bg-gray-50 sticky bottom-0",children:D&&w?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("button",{onClick:()=>{D&&m({...D}),k(!1),v(null)},disabled:h,className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-100 transition disabled:opacity-50 flex items-center justify-center gap-2",children:[r.jsx(_,{className:"w-4 h-4"}),"Abbrechen"]}),r.jsx("button",{onClick:$,disabled:h||0===o.purchase_cost,className:"flex-1 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:h?(0,r.jsxs)(r.Fragment,{children:[r.jsx(U,{className:"w-4 h-4 animate-spin"}),r.jsx("span",{children:"Speichern..."})]}):(0,r.jsxs)(r.Fragment,{children:[r.jsx(N,{className:"w-4 h-4"}),r.jsx("span",{children:"Speichern"})]})})]}):(0,r.jsxs)(r.Fragment,{children:[r.jsx("button",{onClick:t,disabled:h,className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-100 transition disabled:opacity-50",children:D?"Schlie\xdfen":"Abbrechen"}),!D&&r.jsx("button",{onClick:$,disabled:h||0===o.purchase_cost,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:h?(0,r.jsxs)(r.Fragment,{children:[r.jsx(U,{className:"w-4 h-4 animate-spin"}),r.jsx("span",{children:"Speichern..."})]}):r.jsx("span",{children:"Kosten erfassen"})})]})})]})})]})}let O=(0,m.Z)("chevron-up",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]),H=(0,m.Z)("chevron-down",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);function J(){let e=(0,i.useSearchParams)().get("product_id"),[t,s]=(0,n.useState)(e?Number(e):1),[o,m]=(0,n.useState)(0),[x,u]=(0,n.useState)(null),[h,g]=(0,n.useState)(!1),[p,b]=(0,n.useState)(""),[f,j]=(0,n.useState)({margin:!1,price:!1,competitor:!1}),[y,N]=(0,n.useState)({margin:!1,price:!1,competitor:!1}),{isDemoMode:v,currentShop:w}=(0,c.L)(),_=e=>{j(t=>({...t,[e]:!t[e]}))};return(0,n.useEffect)(()=>{if(!t||!w){console.log("[RecommendationsPage] Missing productId or currentShop, skipping load");return}(async()=>{try{console.log("[RecommendationsPage] Loading product data:",{productId:t,shopId:w.id,isDemoMode:v});let e=await (0,d.t2)();console.log("[RecommendationsPage] Products received:",e.length,"First ID type:",typeof e[0]?.id),console.log("[RecommendationsPage] Searching for:",t,"Type:",typeof t);let s=e.find(e=>String(e.id)===String(t));if(!s){console.error("[RecommendationsPage] Product not found in current shop",{productId:t,productIdType:typeof t,currentShop:w,productsCount:e.length,availableIds:e.slice(0,5).map(e=>({id:e.id,idType:typeof e.id}))}),u({has_cost_data:!1,error:`Produkt ${t} nicht im aktuellen Shop gefunden. Bitte Shop wechseln oder Produkt-ID pr\xfcfen.`}),m(0),b(`Product ${t} (nicht gefunden)`);return}if(console.log("[RecommendationsPage] Product found:",{id:s.id,title:s.title,price:s.price}),m(s.price||0),b(s.title||s.name||`Product ${t}`),s.price&&s.price>0)try{let e=await (0,d.ku)(t.toString(),s.price);u(e)}catch(e){u({has_cost_data:!1})}}catch(e){console.error("[RecommendationsPage] Fehler beim Laden der Produktdaten:",e),u({has_cost_data:!1,error:"Fehler beim Laden der Produktdaten."})}})()},[t,w?.id,v]),(0,n.useEffect)(()=>{let e=e=>{console.log("[RecommendationsPage] Shop switched event received:",e.detail),t&&setTimeout(()=>{(async()=>{try{let e=(await (0,d.t2)()).find(e=>String(e.id)===String(t));e?(console.log("[RecommendationsPage] Product reloaded after shop switch:",{id:e.id,title:e.title,price:e.price}),m(e.price||0),b(e.title||e.name||`Product ${t}`)):u({has_cost_data:!1,error:`Produkt ${t} nicht im neuen Shop gefunden.`})}catch(e){console.error("[RecommendationsPage] Error reloading product after shop switch:",e)}})()},300)};return window.addEventListener("shop-switched",e),()=>window.removeEventListener("shop-switched",e)},[t]),(0,n.useEffect)(()=>{let e=e=>{e.target.closest(".info-tooltip-button")||N({margin:!1,price:!1,competitor:!1})};if(y.margin||y.price||y.competitor)return document.addEventListener("click",e),()=>document.removeEventListener("click",e)},[y]),(0,r.jsxs)("div",{className:"min-h-screen bg-gray-50 flex",children:[(0,r.jsxs)("aside",{className:"w-80 bg-gradient-to-b from-white via-gray-50 to-white border-r border-gray-200 p-6 overflow-y-auto shadow-sm",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3 mb-8 pb-6 border-b border-gray-200",children:[r.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-blue-600 to-indigo-600 rounded-xl flex items-center justify-center shadow-lg transform hover:scale-105 transition-transform",children:r.jsx("span",{className:"text-2xl",children:"\uD83D\uDCA1"})}),r.jsx("h2",{className:"text-2xl font-bold bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent",children:"PriceIQ"})]}),r.jsx("div",{className:"mb-6",children:r.jsx(l.D,{})}),(0,r.jsxs)("nav",{className:"space-y-2",children:[r.jsx(a.rU,{href:"/",className:"block px-4 py-2 text-gray-700 rounded-lg hover:bg-gray-100 transition-colors",children:"Dashboard"}),r.jsx(a.rU,{href:"/products",className:"block px-4 py-2 text-gray-700 rounded-lg hover:bg-gray-100 transition-colors",children:"Produkte"}),r.jsx(a.rU,{href:"/recommendations",className:"block px-4 py-2 text-gray-700 rounded-lg hover:bg-gray-100 transition-colors bg-gray-100",children:"Empfehlungen"})]})]}),r.jsx("main",{className:"flex-1 p-8 overflow-y-auto",children:(0,r.jsxs)("div",{className:"max-w-7xl mx-auto",children:[r.jsx("div",{className:"mb-8",children:(0,r.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[r.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-2xl flex items-center justify-center shadow-lg",children:r.jsx("span",{className:"text-3xl",children:"\uD83D\uDCCA"})}),(0,r.jsxs)("div",{children:[r.jsx("h1",{className:"text-4xl font-bold text-gray-900 mb-1",children:"Produkt-Analysen"}),r.jsx("p",{className:"text-gray-600 text-sm",children:"Vollst\xe4ndige Analyse f\xfcr optimale Preisentscheidungen"})]})]}),r.jsx(a.rU,{href:"/",className:"px-6 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors font-medium shadow-sm hover:shadow-md",children:"← Zur\xfcck"})]})}),r.jsx("div",{className:"mb-6 p-6 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl border-2 border-blue-200 shadow-sm",children:(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[r.jsx("div",{className:"w-12 h-12 bg-blue-500 rounded-xl flex items-center justify-center flex-shrink-0",children:r.jsx("span",{className:"text-2xl",children:"\uD83D\uDCE6"})}),(0,r.jsxs)("div",{className:"flex-1",children:[r.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:p||`Produkt ${t}`}),o>0&&(0,r.jsxs)("p",{className:"text-sm text-gray-600 mt-1",children:["Aktueller Preis: ",(0,r.jsxs)("span",{className:"font-semibold text-gray-900",children:[o.toFixed(2)," €"]})]})]})]})}),o>0&&x&&(0,r.jsxs)("section",{className:"mb-6",children:[r.jsx("div",{className:"relative",children:(0,r.jsxs)("button",{onClick:()=>_("margin"),className:"w-full flex items-center justify-between p-6 bg-white rounded-lg border-2 border-gray-200 hover:border-blue-400 hover:shadow-lg transition-all duration-200 text-left",children:[(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[r.jsx("span",{className:"text-4xl",children:"\uD83D\uDCB0"}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[r.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Margen-Analyse"}),(0,r.jsxs)("button",{onClick:e=>{e.stopPropagation(),N(e=>({...e,margin:!e.margin}))},className:"relative info-tooltip-button",children:[r.jsx(G,{className:"w-5 h-5 text-gray-400 hover:text-blue-600 transition-colors"}),y.margin&&(0,r.jsxs)("div",{className:"absolute left-0 bottom-full mb-2 w-80 p-4 bg-gray-900 text-white text-sm rounded-lg shadow-xl z-50",children:[r.jsx("div",{className:"font-semibold mb-2",children:"Was passiert hier?"}),r.jsx("p",{className:"mb-2",children:"Die Margen-Analyse zeigt dir, ob dein aktueller Preis \xfcber deinen Kosten liegt und wie viel Gewinn du pro Verkauf machst."}),(0,r.jsxs)("p",{className:"mb-2",children:[r.jsx("strong",{children:"Wichtig:"})," Bevor du Preise \xe4nderst, solltest du immer pr\xfcfen, dass du nicht unter deine Kosten verkaufst!"]}),r.jsx("p",{children:"Hier kannst du auch Kosten f\xfcr dein Produkt hinterlegen (Einkaufspreis, Versand, Verpackung, etc.)."}),r.jsx("div",{className:"absolute bottom-0 left-4 transform translate-y-full",children:r.jsx("div",{className:"w-0 h-0 border-l-8 border-r-8 border-t-8 border-transparent border-t-gray-900"})})]})]})]}),r.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Pr\xfcfe deine Kosten und Margen vor Preis\xe4nderungen"})]})]}),f.margin?r.jsx(O,{className:"w-6 h-6 text-gray-500"}):r.jsx(H,{className:"w-6 h-6 text-gray-500"})]})}),f.margin&&r.jsx("div",{className:"mt-4 bg-white rounded-lg border border-gray-200 p-6 transition-all duration-300 ease-in-out",children:r.jsx(V,{marginData:x||{has_cost_data:!1},onAddCosts:()=>g(!0),onEditCosts:()=>g(!0)})})]}),(0,r.jsxs)("section",{className:"mb-6",children:[r.jsx("div",{className:"relative",children:(0,r.jsxs)("button",{onClick:()=>_("price"),className:"w-full flex items-center justify-between p-6 bg-white rounded-lg border-2 border-gray-200 hover:border-blue-400 hover:shadow-lg transition-all duration-200 text-left",children:[(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[r.jsx("span",{className:"text-4xl",children:"\uD83D\uDCA1"}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[r.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Preisempfehlung"}),(0,r.jsxs)("button",{onClick:e=>{e.stopPropagation(),N(e=>({...e,price:!e.price}))},className:"relative info-tooltip-button",children:[r.jsx(G,{className:"w-5 h-5 text-gray-400 hover:text-blue-600 transition-colors"}),y.price&&(0,r.jsxs)("div",{className:"absolute left-0 bottom-full mb-2 w-80 p-4 bg-gray-900 text-white text-sm rounded-lg shadow-xl z-50",children:[r.jsx("div",{className:"font-semibold mb-2",children:"Was passiert hier?"}),r.jsx("p",{className:"mb-2",children:"Unsere KI analysiert verschiedene Faktoren wie Nachfrage, Lagerbestand, Wettbewerbspreise und deine Kosten, um dir eine optimale Preisempfehlung zu geben."}),r.jsx("p",{className:"mb-2",children:r.jsx("strong",{children:"Die Empfehlung ber\xfccksichtigt:"})}),(0,r.jsxs)("ul",{className:"list-disc list-inside mb-2 space-y-1",children:[r.jsx("li",{children:"Verkaufsdaten der letzten 30 Tage"}),r.jsx("li",{children:"Aktuelle Preise deiner Konkurrenten"}),r.jsx("li",{children:"Deine Lagerbest\xe4nde"}),r.jsx("li",{children:"Deine Kosten und Margen"})]}),r.jsx("p",{children:"Du kannst die Empfehlung direkt anwenden oder erst die Details ansehen."}),r.jsx("div",{className:"absolute bottom-0 left-4 transform translate-y-full",children:r.jsx("div",{className:"w-0 h-0 border-l-8 border-r-8 border-t-8 border-transparent border-t-gray-900"})})]})]})]}),r.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"KI-basierte Preisempfehlung basierend auf Marktdaten"})]})]}),f.price?r.jsx(O,{className:"w-6 h-6 text-gray-500"}):r.jsx(H,{className:"w-6 h-6 text-gray-500"})]})}),f.price&&r.jsx("div",{className:"mt-4 bg-white rounded-lg border border-gray-200 p-6 transition-all duration-300 ease-in-out",children:r.jsx($,{productId:t})})]}),o>0&&(0,r.jsxs)("section",{className:"mb-6",children:[r.jsx("div",{className:"relative",children:(0,r.jsxs)("button",{onClick:()=>_("competitor"),className:"w-full flex items-center justify-between p-6 bg-white rounded-lg border-2 border-gray-200 hover:border-blue-400 hover:shadow-lg transition-all duration-200 text-left",children:[(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[r.jsx("span",{className:"text-4xl",children:"\uD83C\uDFEA"}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[r.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Wettbewerbsanalyse"}),(0,r.jsxs)("button",{onClick:e=>{e.stopPropagation(),N(e=>({...e,competitor:!e.competitor}))},className:"relative info-tooltip-button",children:[r.jsx(G,{className:"w-5 h-5 text-gray-400 hover:text-blue-600 transition-colors"}),y.competitor&&(0,r.jsxs)("div",{className:"absolute left-0 bottom-full mb-2 w-80 p-4 bg-gray-900 text-white text-sm rounded-lg shadow-xl z-50",children:[r.jsx("div",{className:"font-semibold mb-2",children:"Was passiert hier?"}),r.jsx("p",{className:"mb-2",children:"Die Wettbewerbsanalyse zeigt dir, wie dein Preis im Vergleich zu anderen Anbietern steht."}),r.jsx("p",{className:"mb-2",children:r.jsx("strong",{children:"Du siehst:"})}),(0,r.jsxs)("ul",{className:"list-disc list-inside mb-2 space-y-1",children:[r.jsx("li",{children:"Preise deiner Konkurrenten (Neuware, Gebraucht, etc.)"}),r.jsx("li",{children:"Deine Marktposition (g\xfcnstigster, teuerster, Durchschnitt)"}),r.jsx("li",{children:"Durchschnittspreis und Preisspanne"}),r.jsx("li",{children:"Datenqualit\xe4t der Analyse"})]}),r.jsx("p",{children:"Nutze diese Informationen, um deine Preise strategisch anzupassen."}),r.jsx("div",{className:"absolute bottom-0 left-4 transform translate-y-full",children:r.jsx("div",{className:"w-0 h-0 border-l-8 border-r-8 border-t-8 border-transparent border-t-gray-900"})})]})]})]}),r.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Vergleiche deine Preise mit der Konkurrenz"})]})]}),f.competitor?r.jsx(O,{className:"w-6 h-6 text-gray-500"}):r.jsx(H,{className:"w-6 h-6 text-gray-500"})]})}),f.competitor&&r.jsx("div",{className:"mt-4 bg-white rounded-lg border border-gray-200 p-6 transition-all duration-300 ease-in-out",children:r.jsx(T,{productId:t,currentPrice:o})})]})]})}),r.jsx(Z,{isOpen:h,onClose:()=>g(!1),productId:t.toString(),productTitle:p||`Product ${t}`,currentPrice:o,shopId:w?.id?.toString()||"demo",onSave:async e=>{try{if(await (0,d.QJ)(t.toString(),e),g(!1),o>0){let e=await (0,d.ku)(t.toString(),o);u(e)}}catch(e){throw console.error("Fehler beim Speichern der Kosten:",e),e}}})]})}function Q(){return r.jsx(n.Suspense,{fallback:r.jsx("div",{className:"min-h-screen p-8",children:"Lade..."}),children:r.jsx(J,{})})}},7075:(e,t,s)=>{"use strict";s.d(t,{Z:()=>m});var r=s(3729);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let n=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),a=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,s)=>s?s.toUpperCase():t.toLowerCase()),i=e=>{let t=a(e);return t.charAt(0).toUpperCase()+t.slice(1)},l=(...e)=>e.filter((e,t,s)=>!!e&&""!==e.trim()&&s.indexOf(e)===t).join(" ").trim(),c=e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0};/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var d={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let o=(0,r.forwardRef)(({color:e="currentColor",size:t=24,strokeWidth:s=2,absoluteStrokeWidth:n,className:a="",children:i,iconNode:o,...m},x)=>(0,r.createElement)("svg",{ref:x,...d,width:t,height:t,stroke:e,strokeWidth:n?24*Number(s)/Number(t):s,className:l("lucide",a),...!i&&!c(m)&&{"aria-hidden":"true"},...m},[...o.map(([e,t])=>(0,r.createElement)(e,t)),...Array.isArray(i)?i:[i]])),m=(e,t)=>{let s=(0,r.forwardRef)(({className:s,...a},c)=>(0,r.createElement)(o,{ref:c,iconNode:t,className:l(`lucide-${n(i(e))}`,`lucide-${e}`,s),...a}));return s.displayName=i(e),s}},5269:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});let r=(0,s(7075).Z)("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},6262:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});let r=(0,s(7075).Z)("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},6064:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});let r=(0,s(7075).Z)("trending-up",[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]])},6222:(e,t,s)=>{"use strict";s.r(t),s.d(t,{$$typeof:()=>a,__esModule:()=>n,default:()=>i});let r=(0,s(6843).createProxy)(String.raw`C:\Users\Kujti\Desktop\Trading Tools\MVP PRICE\frontend\app\[locale]\recommendations\page.tsx`),{__esModule:n,$$typeof:a}=r,i=r.default}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[638,312,356,242],()=>s(3956));module.exports=r})();