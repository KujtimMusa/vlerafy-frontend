(()=>{var e={};e.id=136,e.ids=[136],e.modules={7849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},5528:e=>{"use strict";e.exports=require("next/dist\\client\\components\\action-async-storage.external.js")},1877:e=>{"use strict";e.exports=require("next/dist\\client\\components\\request-async-storage.external.js")},5319:e=>{"use strict";e.exports=require("next/dist\\client\\components\\static-generation-async-storage.external.js")},3956:(e,s,t)=>{"use strict";t.r(s),t.d(s,{GlobalError:()=>i.a,__next_app__:()=>x,originalPathname:()=>m,pages:()=>o,routeModule:()=>u,tree:()=>d});var r=t(482),a=t(9108),n=t(2563),i=t.n(n),l=t(8300),c={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(c[e]=()=>l[e]);t.d(s,c);let d=["",{children:["[locale]",{children:["recommendations",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,6222)),"C:\\Users\\Kujti\\Desktop\\Trading Tools\\MVP PRICE\\frontend\\app\\[locale]\\recommendations\\page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,3471)),"C:\\Users\\Kujti\\Desktop\\Trading Tools\\MVP PRICE\\frontend\\app\\[locale]\\layout.tsx"]}]},{layout:[()=>Promise.resolve().then(t.bind(t,2917)),"C:\\Users\\Kujti\\Desktop\\Trading Tools\\MVP PRICE\\frontend\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,9361,23)),"next/dist/client/components/not-found-error"]}],o=["C:\\Users\\Kujti\\Desktop\\Trading Tools\\MVP PRICE\\frontend\\app\\[locale]\\recommendations\\page.tsx"],m="/[locale]/recommendations/page",x={require:t,loadChunk:()=>Promise.resolve()},u=new r.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/[locale]/recommendations/page",pathname:"/[locale]/recommendations",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},4965:(e,s,t)=>{Promise.resolve().then(t.bind(t,25))},25:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>O});var r=t(2295),a=t(3729),n=t(2186),i=t(2254),l=t(2542),c=t(531),d=t(8117);async function o(e){let s=await fetch(`${d.T5}/api/shopify/apply-price`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(e)});if(!s.ok)throw Error((await s.json()).detail||"Fehler beim Anwenden des Preises");return s.json()}var m=t(6262),x=t(5269),u=t(7075);let h=(0,u.Z)("circle-question-mark",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),g=(0,u.Z)("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);var p=t(8632);function b(e,s){return(...e)=>{try{return s(...e)}catch{throw Error(void 0)}}}let f=b(0,p.T_);function j({confidence:e,reasoning:s,compact:t=!1,confidenceBasis:a}){let n=f("confidence"),i=e>1?e:100*e,l={high:{icon:m.Z,color:"green",bgColor:"bg-gradient-to-r from-green-50 to-emerald-50",borderColor:"border-green-200",textColor:"text-green-700",barColor:"bg-green-500",gradientBar:"bg-gradient-to-r from-green-500 to-emerald-600"},medium:{icon:x.Z,color:"yellow",bgColor:"bg-gradient-to-r from-yellow-50 to-amber-50",borderColor:"border-yellow-200",textColor:"text-yellow-700",barColor:"bg-yellow-500",gradientBar:"bg-gradient-to-r from-yellow-500 to-amber-600"},low:{icon:h,color:"red",bgColor:"bg-gradient-to-r from-red-50 to-orange-50",borderColor:"border-red-200",textColor:"text-red-700",barColor:"bg-red-500",gradientBar:"bg-gradient-to-r from-red-500 to-orange-600"}}[i>=85?"high":i>=60?"medium":"low"],c=l.icon;if(t)return(0,r.jsxs)("div",{className:`inline-flex items-center gap-2 px-3 py-1.5 rounded-full border ${l.bgColor} ${l.borderColor}`,children:[r.jsx(c,{className:`w-4 h-4 ${l.textColor}`}),(0,r.jsxs)("span",{className:`text-sm font-semibold ${l.textColor}`,children:[i.toFixed(0),"%"]})]});let d=a?.competitor_count||0;return a?.sales_30d,(0,r.jsxs)("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 p-6 rounded-2xl border-l-4 border-blue-500 space-y-4",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:"w-12 h-12 bg-blue-500 rounded-2xl flex items-center justify-center flex-shrink-0",children:r.jsx(g,{className:"w-6 h-6 text-white"})}),(0,r.jsxs)("div",{className:"flex-1",children:[r.jsx("h3",{className:"text-2xl font-bold text-gray-900",children:n("title",{confidence:i.toFixed(0)})}),r.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 mt-2",children:r.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-indigo-600 h-2 rounded-full transition-all duration-500",style:{width:`${i}%`}})})]})]}),(0,r.jsxs)("div",{className:"p-4 bg-white/50 rounded-xl border",children:[(0,r.jsxs)("h4",{className:"font-semibold text-gray-900 mb-3 flex items-center gap-2",children:["\uD83D\uDCCA ",r.jsx("span",{children:n("whatAnalyzes")})]}),(0,r.jsxs)("ul",{className:"space-y-2 text-sm text-gray-700",children:[r.jsx("li",{children:"• Echte Verkaufsdaten aus deinem Shopify-Shop"}),(0,r.jsxs)("li",{children:["• Aktuelle Preise deiner ",d>0?`${d}-${Math.max(d,10)}`:"5-10"," wichtigsten Konkurrenten"]}),(0,r.jsxs)("li",{children:["• ",a?.ml_models||4," spezialisierte Machine-Learning-Modelle (Umsatz, Konkurrenz, Marge, Saisonalit\xe4t)"]}),r.jsx("li",{children:"• Deine eingetragenen Kosten und bisherigen Margen"})]})]}),(0,r.jsxs)("div",{className:"p-4 bg-yellow-50/80 border border-yellow-200 rounded-xl",children:[(0,r.jsxs)("h4",{className:"font-semibold text-gray-900 mb-3 flex items-center gap-2",children:["\uD83D\uDCA1 ",n("why",{confidence:i.toFixed(0)})]}),r.jsx("p",{className:"text-sm text-gray-800 leading-relaxed",children:n("whyText")})]})]})}b(0,p.Gb);let y=(0,u.Z)("circle-check",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);var N=t(4513);let v=(0,u.Z)("clock",[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),w=(0,u.Z)("triangle-alert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);var _=t(5137);function k({recommendedPrice:e,onApply:s,onDismiss:t,isApplying:n,isDisabled:i=!1,marginAnalysis:l}){let c=f("pricing"),d=f("common"),o=f("actions"),[m,x]=(0,a.useState)(!1),u=l&&!l.is_safe,h=l?.details?.margin?.euro?30*l.details.margin.euro:null;return(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[r.jsx("button",{onClick:s,disabled:n||i,className:`
            flex items-center justify-center gap-2 px-6 py-3 rounded-lg font-semibold
            transition-all duration-200 transform hover:scale-105
            disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none
            ${i?"bg-gray-300 text-gray-600":u?"bg-orange-600 hover:bg-orange-700 text-white shadow-lg hover:shadow-xl":"bg-green-600 hover:bg-green-700 text-white shadow-lg hover:shadow-xl"}
          `,children:n?(0,r.jsxs)(r.Fragment,{children:[r.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),r.jsx("span",{children:c("applying")})]}):(0,r.jsxs)(r.Fragment,{children:[r.jsx(y,{className:"w-5 h-5"}),(0,r.jsxs)("div",{className:"flex flex-col items-start",children:[r.jsx("span",{children:c("apply_price",{price:(0,_.xG)(e)})}),h&&(0,r.jsxs)("span",{className:"text-xs opacity-80 font-normal",children:["+",(0,_.xG)(h),o("month_est")]})]})]})}),(0,r.jsxs)("button",{onClick:t,disabled:n,className:"flex items-center justify-center gap-2 px-6 py-3 rounded-lg font-semibold border-2 border-gray-300 text-gray-700 hover:bg-gray-50 transition-all disabled:opacity-50",children:[r.jsx(N.Z,{className:"w-5 h-5"}),r.jsx("span",{children:d("dismiss")})]})]}),(0,r.jsxs)("button",{onClick:()=>x(!m),className:"w-full flex items-center justify-center gap-2 px-4 py-2 text-sm text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",children:[r.jsx(v,{className:"w-4 h-4"}),r.jsx("span",{children:c("schedule_later")})]}),m&&(0,r.jsxs)("div",{className:"p-4 bg-blue-50 rounded-lg border border-blue-200 space-y-3",children:[r.jsx("p",{className:"text-sm font-medium text-blue-900",children:o("schedule_price_change")}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-xs text-blue-700 mb-1",children:o("date")}),r.jsx("input",{type:"date",className:"w-full px-3 py-2 border border-blue-300 rounded-lg text-sm"})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-xs text-blue-700 mb-1",children:o("time")}),r.jsx("input",{type:"time",defaultValue:"09:00",className:"w-full px-3 py-2 border border-blue-300 rounded-lg text-sm"})]})]}),r.jsx("button",{className:"w-full px-4 py-2 bg-blue-600 text-white rounded-lg text-sm font-medium hover:bg-blue-700 transition-colors",children:o("schedule_change")})]}),i&&(0,r.jsxs)("div",{className:"flex items-start gap-2 p-3 bg-red-50 border border-red-200 rounded-lg",children:[r.jsx(N.Z,{className:"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5"}),r.jsx("p",{className:"text-sm text-red-800",children:o("cannot_apply_warning")})]}),u&&!i&&(0,r.jsxs)("div",{className:"flex items-start gap-2 p-3 bg-orange-50 border border-orange-200 rounded-lg",children:[r.jsx(w,{className:"w-5 h-5 text-orange-600 flex-shrink-0 mt-0.5"}),(0,r.jsxs)("div",{className:"flex-1",children:[r.jsx("p",{className:"text-sm font-medium text-orange-900 mb-1",children:o("margin_warning")}),r.jsx("p",{className:"text-xs text-orange-800",children:l?.message})]})]})]})}function D({recommendation:e,onApply:s,onDismiss:t,onRefresh:n}){let[i,l]=(0,a.useState)(!1),c=async()=>{if(s){l(!0);try{await s(e.recommended_price)}catch(e){console.error("Error applying recommendation:",e)}finally{l(!1)}}},d=e.price_change||e.recommended_price-e.current_price,o=d>0,m=d<0;return(0,r.jsxs)("div",{className:"bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden",children:[(0,r.jsxs)("div",{className:"p-6 pb-4 bg-gradient-to-br from-blue-50 to-white",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[r.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:e.product_name||"Produkt"}),r.jsx(j,{confidence:e.confidence,compact:!0,confidenceBasis:e.confidence_basis})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[(0,r.jsxs)("div",{className:"bg-white p-4 rounded-lg border-2 border-gray-200",children:[r.jsx("div",{className:"text-sm text-gray-600 mb-1",children:"Aktuell"}),r.jsx("div",{className:"text-2xl font-bold text-gray-900",children:(0,_.xG)(e.current_price)})]}),(0,r.jsxs)("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 p-4 rounded-lg border-2 border-blue-300",children:[r.jsx("div",{className:"text-sm text-gray-600 mb-1",children:"Empfohlen"}),r.jsx("div",{className:"text-2xl font-bold text-blue-600",children:(0,_.xG)(e.recommended_price)})]})]}),r.jsx("div",{className:"flex items-center gap-2",children:(0,r.jsxs)("div",{className:`px-4 py-2 rounded-lg font-bold ${o?"bg-green-100 text-green-700":m?"bg-red-100 text-red-700":"bg-gray-100 text-gray-700"}`,children:[o?"+":"",(0,_.xG)(d)," (",o?"+":"",e.price_change_pct.toFixed(1),"%)"]})})]}),r.jsx("div",{className:"mt-6 px-6",children:r.jsx(j,{confidence:e.confidence,reasoning:e.reasoning,compact:!1,confidenceBasis:e.confidence_basis})}),(s||t)&&r.jsx("div",{className:"p-6 border-t border-gray-200",children:r.jsx(k,{recommendedPrice:e.recommended_price,onApply:c,onDismiss:t||(()=>{}),isApplying:i,isDisabled:!1,marginAnalysis:e.margin_analysis})})]})}function P({productId:e,competitorCount:s,salesDataDays:t,onRunAnalysis:a}){return(0,r.jsxs)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-6",children:[(0,r.jsxs)("h3",{className:"font-bold text-xl text-yellow-800 mb-2",children:["⚠️ Erstmalige Analyse f\xfcr Produkt #",e]}),0===s&&r.jsx("div",{className:"bg-white p-4 rounded-lg border-l-4 border-orange-400 mb-3",children:(0,r.jsxs)("div",{className:"flex items-start gap-3",children:[r.jsx("span",{className:"text-2xl",children:"\uD83D\uDD0D"}),(0,r.jsxs)("div",{className:"flex-1",children:[r.jsx("h4",{className:"font-semibold text-gray-900 mb-1",children:"Wettbewerbsanalyse l\xe4uft..."}),r.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Wir sammeln gerade Preisdaten von Wettbewerbern f\xfcr dieses Produkt."}),a&&r.jsx("button",{onClick:a,className:"text-blue-600 underline hover:text-blue-800 text-sm font-medium mt-2",children:"Jetzt sofort analysieren →"})]})]})}),t<7&&r.jsx("div",{className:"bg-white p-4 rounded-lg border-l-4 border-blue-400",children:(0,r.jsxs)("div",{className:"flex items-start gap-3",children:[r.jsx("span",{className:"text-2xl",children:"\uD83D\uDCC8"}),(0,r.jsxs)("div",{className:"flex-1",children:[r.jsx("h4",{className:"font-semibold text-gray-900 mb-1",children:"Verkaufsdaten werden gesammelt"}),(0,r.jsxs)("p",{className:"text-sm text-gray-600",children:["Aktuell: ",(0,r.jsxs)("span",{className:"font-semibold",children:[t," Tage"]}),". Optimal: ",r.jsx("span",{className:"font-semibold text-green-600",children:"30+ Tage"})]}),r.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Mehr Verkaufsdaten f\xfchren zu pr\xe4ziseren Preisempfehlungen."})]})]})}),s>0&&t>=7&&r.jsx("div",{className:"bg-green-50 p-4 rounded-lg border-l-4 border-green-400",children:(0,r.jsxs)("div",{className:"flex items-start gap-3",children:[r.jsx("span",{className:"text-2xl",children:"✅"}),(0,r.jsxs)("div",{className:"flex-1",children:[r.jsx("h4",{className:"font-semibold text-gray-900 mb-1",children:"Datenbasis vorhanden"}),r.jsx("p",{className:"text-sm text-gray-600",children:"Wir haben genug Daten f\xfcr eine erste Analyse. Die Empfehlung wird mit mehr Daten pr\xe4ziser."})]})]})})]})}function C({productId:e}){let[s,t]=(0,a.useState)(null),[n,i]=(0,a.useState)(!1),[l,m]=(0,a.useState)(!1),[x,u]=(0,a.useState)(null),{currentShop:h,isDemoMode:g}=(0,c.L)(),p=async()=>{if(!e)return;let s="string"==typeof e?parseInt(e,10):e;if(isNaN(s)){u("Ung\xfcltige Produkt-ID");return}i(!0),u(null);try{console.log("[LatestRecommendation] \uD83D\uDD04 Generating FRESH recommendation for product:",s);let e=await (0,d.n8)(s);console.log("[LatestRecommendation] ✅ Fresh recommendation generated:",e);let r=e.recommendation||e;if(r){console.log("[LatestRecommendation] Recommendation data:",r),r.product_name||(r.product_name=e.product_name||`Product ${r.product_id}`),!r.current_price&&e.current_price&&(r.current_price=e.current_price);let s=r.reasoning;if("string"==typeof r.reasoning)try{s=JSON.parse(r.reasoning)}catch{s=r.reasoning}r.reasoning=s,console.log("[LatestRecommendation] ✅ Setting fresh recommendation:",r),t(r)}else console.log("[LatestRecommendation] No recommendation in response"),t(null)}catch(e){console.error("[LatestRecommendation] Error generating recommendation:",e),console.error("[LatestRecommendation] Error details:",e.response||e.message),u(e.message||"Fehler beim Generieren der Empfehlung"),t(null)}finally{i(!1)}},b=async()=>{if(!e){alert("Bitte w\xe4hle eine Produkt-ID aus!");return}if(isNaN("string"==typeof e?parseInt(e,10):e)){alert("Ung\xfcltige Produkt-ID");return}m(!0),u(null);try{console.log("[LatestRecommendation] \uD83D\uDD04 Manual refresh requested"),await p()}catch(e){console.error("[LatestRecommendation] Error generating recommendation:",e),u(e.message||"Fehler beim Generieren der Empfehlung")}finally{m(!1)}},f=async s=>{if(!e){alert("Bitte w\xe4hle eine Produkt-ID aus!");return}if(g){alert("Demo Mode: Preis kann nicht auf Shopify angewendet werden.");return}if(!h?.id){alert("Kein Shop ausgew\xe4hlt. Bitte w\xe4hle einen Shop aus.");return}let t="string"==typeof e?parseInt(e,10):e;if(isNaN(t)){alert("Ung\xfcltige Produkt-ID");return}try{console.log("[LatestRecommendation] Applying price:",{productIdNum:t,price:s,shopId:h.id});let e=await o({product_id:t,recommended_price:s});console.log("[LatestRecommendation] Price applied successfully:",e),alert(`Preis erfolgreich auf Shopify aktualisiert: €${e.new_price.toFixed(2)}`),await p()}catch(e){throw console.error("[LatestRecommendation] Error applying price:",e),alert(`Fehler beim Anwenden des Preises: ${e.message||"Unbekannter Fehler"}`),e}};if((0,a.useEffect)(()=>{p()},[e]),n||l)return(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 space-y-4",children:[r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),(0,r.jsxs)("div",{className:"text-gray-600 text-center",children:[r.jsx("p",{className:"font-medium",children:"Analysiere aktuelle Marktdaten..."}),r.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Pr\xfcfe Wettbewerber, analysiere 90 Tage Verkaufsdaten..."})]})]});if(x)return(0,r.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[r.jsx("p",{className:"text-red-700 text-sm",children:x}),r.jsx("button",{onClick:p,className:"mt-2 px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 text-sm",children:"Erneut versuchen"})]});if(!s)return r.jsx(P,{productId:e,competitorCount:0,salesDataDays:0,onRunAnalysis:b});let j=!s.confidence||s.confidence===-1/0||s.confidence<0||isNaN(s.confidence),y=s.competitor_avg_price?1:0,N=s.sales_7d?7:0;if(j||0===y&&N<7)return r.jsx(P,{productId:e,competitorCount:y,salesDataDays:N,onRunAnalysis:b});let v=s.reasoning,w="object"==typeof v&&null!==v?v:{},_=w.strategies||{},k=[];k=s.strategy_details&&Array.isArray(s.strategy_details)?s.strategy_details:s.strategyDetails&&Array.isArray(s.strategyDetails)?s.strategyDetails:Object.entries(_).map(([e,t])=>({strategy:e,recommended_price:t?.price||t?.recommended_price||s.recommended_price,confidence:t?.confidence||.5,reasoning:t?.reasoning||"",competitor_context:t?.competitor_context||t?.competitive?.competitor_context}));let C=_.competitive?.competitor_context||_.competitive?.competitor_context,S=s.competitor_avg_price?{avg:s.competitor_avg_price,min:C?.min_price||.9*s.competitor_avg_price,max:C?.max_price||1.1*s.competitor_avg_price,prices:C?.sources?.map((e,t)=>({source:e,price:s.competitor_avg_price*(.9+.05*t)}))||[]}:void 0,E={product_id:s.product_id,product_name:s.product_name,current_price:s.current_price,recommended_price:s.recommended_price,price_change:s.recommended_price-s.current_price,price_change_pct:s.price_change_pct,confidence:s.confidence,reasoning:"string"==typeof v?v:w.summary||JSON.stringify(w),strategy_details:k.length>0?k:void 0,competitor_data:S,created_at:s.created_at,generated_at:s.created_at};return r.jsx("div",{className:"space-y-6",children:r.jsx(D,{recommendation:E,onRefresh:b,onDismiss:()=>{},onApply:f})})}function S({competitors:e,yourPrice:s}){let[t,n]=(0,a.useState)("all");if(!e||0===e.length)return(0,r.jsxs)("div",{className:"text-center py-4 text-gray-500",children:[r.jsx("p",{className:"font-medium mb-2",children:"❓ Unbekannt"}),r.jsx("p",{className:"text-sm",children:"Keine Wettbewerber gefunden"}),r.jsx("p",{className:"text-xs mt-2 text-gray-400",children:"Die Suche hat keine Ergebnisse zur\xfcckgegeben. M\xf6gliche Gr\xfcnde:"}),(0,r.jsxs)("ul",{className:"text-xs mt-2 text-gray-400 text-left max-w-md mx-auto",children:[r.jsx("li",{children:"• Produktname zu spezifisch oder ungew\xf6hnlich"}),r.jsx("li",{children:"• Serper API Key fehlt oder ist ung\xfcltig"}),r.jsx("li",{children:"• Rate Limit erreicht (2500 Calls/Monat)"}),r.jsx("li",{children:"• Keine Shopping-Ergebnisse f\xfcr dieses Produkt verf\xfcgbar"})]})]});let i=e=>{let s=(e.title||"").toLowerCase(),t=(e.source||"").toLowerCase();return s.includes("gebraucht")||s.includes("used")||s.includes("wie neu")||s.includes("zustand")||t.includes("kleinanzeigen")||t.includes("willhaben")||t.includes("shpock")||t.includes("vinted")?"used":s.includes("refurbished")||s.includes("general\xfcberholt")?"refurbished":"new"},l=[...e.filter(e=>"all"===t||i(e)===t)].sort((e,s)=>e.price-s.price),c=e.filter(e=>"new"===i(e)).length,d=e.filter(e=>"used"===i(e)).length,o=e.filter(e=>"refurbished"===i(e)).length,m=l.every(e=>e.price<s),x=l.length>0?Math.max(...l.map(e=>e.price)):0,u=(e,s)=>0===e?{label:"G\xdcNSTIGSTER",icon:"\uD83D\uDFE2"}:e===s-1?{label:"TEUERSTER",icon:"\uD83D\uDD34"}:{label:`#${e+1}`,icon:"\uD83D\uDFE1"};return(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[(0,r.jsxs)("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[r.jsx("span",{children:"\uD83D\uDCB0"}),e.length," WETTBEWERBER IM VERGLEICH"]}),(0,r.jsxs)("div",{className:"flex gap-2 mb-6",children:[r.jsx("button",{className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${"all"===t?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,onClick:()=>n("all"),children:"Alle"}),c>0&&(0,r.jsxs)("button",{className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${"new"===t?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,onClick:()=>n("new"),children:["Nur Neuware (",c,")"]}),d>0&&(0,r.jsxs)("button",{className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${"used"===t?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,onClick:()=>n("used"),children:["Nur Gebraucht (",d,")"]}),o>0&&(0,r.jsxs)("button",{className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${"refurbished"===t?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,onClick:()=>n("refurbished"),children:["Nur Refurbished (",o,")"]})]}),r.jsx("div",{className:"space-y-4",children:l.map((e,t)=>{let{label:a,icon:n}=u(t,l.length),c=i(e),d=s-e.price,o=Math.round(d/s*100);return(0,r.jsxs)("div",{className:"border-2 rounded-lg p-5 hover:shadow-md transition-shadow",children:[(0,r.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[r.jsx("span",{className:"text-2xl",children:n}),(0,r.jsxs)("div",{children:[r.jsx("div",{className:"text-xs text-gray-500 uppercase tracking-wide",children:a}),r.jsx("div",{className:"text-xl font-bold",children:e.source})]})]}),r.jsx("div",{className:"text-right",children:r.jsx("div",{className:"text-2xl font-bold text-gray-900",children:(0,_.xG)(e.price)})})]}),r.jsx("div",{className:"mb-3",children:r.jsx("p",{className:"text-sm text-gray-700 line-clamp-2",children:e.title})}),(0,r.jsxs)("div",{className:"flex items-center gap-4 text-sm mb-4",children:[e.rating&&(0,r.jsxs)("span",{className:"text-gray-600",children:["⭐ ",e.rating.toFixed(1)," Sterne"]}),r.jsx("span",{className:`px-3 py-1 rounded-full font-medium ${"new"===c?"bg-green-100 text-green-800":"refurbished"===c?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"}`,children:"new"===c?"Neuware":"refurbished"===c?"Refurbished":"Gebraucht"})]}),r.jsx("div",{className:"bg-blue-50 border-l-4 border-blue-400 p-3 rounded",children:(0,r.jsxs)("p",{className:"text-sm font-medium text-blue-900",children:["\uD83D\uDCA1 ",(0,_.xG)(Math.abs(d))," g\xfcnstiger als du (",o>0?"-":"+",Math.abs(o),"%)"]})})]},t)})}),m&&l.length>0&&r.jsx("div",{className:"mt-6 bg-orange-50 border-l-4 border-orange-400 p-4",children:(0,r.jsxs)("p",{className:"text-sm font-medium text-orange-900",children:["⚠️ ",r.jsx("strong",{children:"WICHTIG:"})," Selbst der teuerste Wettbewerber ist"," ",(0,_.xG)(s-x)," g\xfcnstiger als dein aktueller Preis!"]})})]})}let E=["kleinanzeigen","ebay kleinanzeigen","willhaben","facebook marketplace","shpock","vinted","ebay"],M=["bundle","set","kit","paket","creator edition","limited edition","special edition","travel bundle","starter kit","combo","pack","+","mit","inkl.","inklusive","includes","enth\xe4lt","zubeh\xf6r","accessories"];function A(e){let s=e.toLowerCase();for(let e of M)if(s.includes(e)){if("edition"===e&&s.includes("standard edition"))continue;return!0}return!!(/\+\s*[A-Za-z]/.test(e)||/mit\s+[A-Za-z]/.test(s))}function F(e){return new Intl.NumberFormat("de-DE",{style:"currency",currency:"EUR",minimumFractionDigits:2,maximumFractionDigits:2}).format(e)}let z=e=>null,$=(e,s)=>{};function K({productId:e,currentPrice:s}){let[t,n]=(0,a.useState)(!1),[i,l]=(0,a.useState)(null),[c,o]=(0,a.useState)(null);(0,a.useEffect)(()=>{let s=z(e);s&&l(s)},[e]);let m=async(s=!1)=>{n(!0),o(null);try{let t=await (0,d.Ow)(e,{maxResults:5,forceRefresh:s});l(t),$(e,t)}catch(s){console.error("[CompetitorAnalysis] Fehler beim Laden:",s);let e="Fehler beim Laden der Wettbewerber-Daten";s?.response?.status===404?e="Produkt nicht gefunden. Pr\xfcfe Shop-Auswahl und Produkt-ID.":s?.response?.status===429?e="API-Limit erreicht. Bitte sp\xe4ter erneut versuchen.":s?.response?.status===500?e="Server-Fehler. Bitte sp\xe4ter erneut versuchen oder Support kontaktieren.":s?.message&&(e=s.message),o(e)}finally{n(!1)}},x=(()=>{if(!i||!i.competitors||0===i.competitors.length)return null;let e=i.competitors.map(e=>e.price),t=Math.min(...e),r=Math.max(...e),a=e.reduce((e,s)=>e+s,0)/e.length,n=s-a,l=a>0?(s-a)/a*100:0,c=i.competitors.filter(e=>{let s=(e.title||"").toLowerCase(),t=(e.source||"").toLowerCase();return!(s.includes("gebraucht")||s.includes("used")||t.includes("kleinanzeigen")||t.includes("willhaben"))&&!(s.includes("refurbished")||s.includes("general\xfcberholt"))}),d=i.competitors.filter(e=>{let s=(e.title||"").toLowerCase(),t=(e.source||"").toLowerCase();return s.includes("gebraucht")||s.includes("used")||t.includes("kleinanzeigen")||t.includes("willhaben")}),o=c.length>0?Math.min(...c.map(e=>e.price)):null,m=c.length>0?Math.max(...c.map(e=>e.price)):null,x=d.length>0?Math.min(...d.map(e=>e.price)):null;return{minPrice:t,maxPrice:r,avgPrice:a,priceSpread:r-t,yourPriceDiff:n,percentAboveAvg:l,competitorCount:i.competitors.length,newCount:c.length,usedCount:d.length,newMin:o,newMax:m,usedMin:x}})(),u=i?function(e){var s;let t=e.offers.filter(e=>!("new"!==e.condition||function(e){let s=e.toLowerCase();for(let e of E)if(s.includes(e))return!0;return!1}(e.source)||A(e.title))),r=function(e){if(0===e.length)return{core_count:0,core_min:0,core_max:0,core_avg:0,price_spread_pct:0};let s=e.map(e=>e.price).sort((e,s)=>e-s),t=Math.round(100*s[0])/100,r=Math.round(100*s[s.length-1])/100,a=Math.round(s.reduce((e,s)=>e+s,0)/s.length*100)/100;return{core_count:e.length,core_min:t,core_max:r,core_avg:a,price_spread_pct:Math.round(100*(a>0?(r-t)/a*100:0))/100}}(t),a=function(e,s){if(0===s)return"unbekannt";let t=(e-s)/s*100;return t<-15?"deutlich unter Durchschnitt":t<-5?"unter Durchschnitt":t<=5?"im Bereich des Durchschnitts":t<=20?"\xfcber Durchschnitt":"deutlich \xfcber Durchschnitt"}(e.our_price,r.core_avg),n=e.data_age_days||0,i=function(e,s,t){let r=[],a=!1;return e<3&&(a=!0,r.push("zu wenig vergleichbare Angebote")),s>7&&(a=!0,r.push(`Daten sind ${s} Tage alt`)),t>40&&(a=!0,r.push("sehr hohe Preisstreuung")),{isUncertain:a,reasons:r}}(r.core_count,n,r.price_spread_pct),l=e.offers.filter(e=>"used"===e.condition),c=e.offers.filter(e=>"new"===e.condition&&A(e.title)),d=l.length>0?Math.round(100*Math.min(...l.map(e=>e.price)))/100:null,o=c.length>0?Math.round(100*Math.min(...c.map(e=>e.price)))/100:null,m=function(e,s,t){if(0===t)return"Keine vergleichbaren Neuware-Angebote gefunden.";if(1===t){let t=e-s.core_avg,r=t>0?`${F(Math.abs(t))} teurer`:`${F(Math.abs(t))} g\xfcnstiger`;return`Du liegst mit ${F(e)} ${r} als das einzige vergleichbare Neuware-Angebot (${F(s.core_avg)}).`}let r=s.core_avg>0?(e-s.core_avg)/s.core_avg*100:0;if(1>Math.abs(r))return`Du liegst mit ${F(e)} nahe am Marktdurchschnitt von ${F(s.core_avg)}.`;let a=Math.abs(r).toFixed(1);return`Du liegst mit ${F(e)} ${a}% ${r>0?"\xfcber":"unter"} dem Marktdurchschnitt von ${F(s.core_avg)}.`}(e.our_price,r,t.length);return{summary:m,marketOverview:function(e,s,t,r){let a=[];return 0===r?a.push("Keine vergleichbaren Neuware-Angebote gefunden."):1===r?a.push(`Nur 1 vergleichbares Neuware-Angebot gefunden (${F(e.core_avg)}).`):(a.push(`${r} vergleichbare Neuware-Angebote gefunden (Spanne: ${F(e.core_min)} – ${F(e.core_max)}).`),a.push(`Durchschnittspreis: ${F(e.core_avg)}.`)),null!==t&&a.push(`Bundles mit Zubeh\xf6r starten ab ${F(t)} (nicht in der Berechnung).`),null!==s&&a.push(`Gebrauchtangebote starten ab ${F(s)} (nicht in der Berechnung).`),a}(r,d,o,t.length),position:(s=e.our_price,0===r.core_count?"Vergleichsbasis fehlt – Position kann nicht bestimmt werden.":r.core_count<3?"Vergleichsbasis ist sehr d\xfcnn – Position kann nicht sicher bestimmt werden.":"im Bereich des Durchschnitts"===a?`Du liegst im Bereich des Marktdurchschnitts – wettbewerbsf\xe4hige Position.`:`Deine Position: ${a} (${F(s)} vs. Durchschnitt ${F(r.core_avg)}).`),dataQuality:function(e,s,t){if(!e.isUncertain){let e=0===s?"aktuell":1===s?"vor 1 Tag":`vor ${s} Tagen`;return`Wettbewerbsdaten sind zuverl\xe4ssig (${t} vergleichbare Angebote, Stand: ${e}).`}let r=e.reasons.join(", "),a=0===s?"aktuell":1===s?"vor 1 Tag":`vor ${s} Tagen`;return`Hinweis: Wettbewerbsdaten sind eingeschr\xe4nkt zuverl\xe4ssig (${r}, Stand: ${a}).`}(i,n,r.core_count)}}({product_title:i.product_title||"",our_price:s,offers:i.competitors.map(e=>{let s="new",t=(e.title||"").toLowerCase(),r=(e.source||"").toLowerCase();return t.includes("gebraucht")||t.includes("used")||r.includes("kleinanzeigen")||r.includes("willhaben")?s="used":(t.includes("refurbished")||t.includes("general\xfcberholt"))&&(s="refurbished"),{source:e.source||"Unknown",title:e.title||"",price:e.price,rating:e.rating,url:e.url||"",condition:s}}),data_age_days:0}):null,h=(()=>{if(!x)return{label:"Unbekannt",color:"gray",explanation:""};let e=x.priceSpread/x.avgPrice>.4,s=x.competitorCount<3;return e||s?{label:"Eingeschr\xe4nkt zuverl\xe4ssig",color:"orange",explanation:e?"sehr hohe Preisstreuung":"zu wenig vergleichbare Angebote"}:{label:"Zuverl\xe4ssig",color:"green",explanation:""}})();return(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("h3",{className:"text-lg font-bold flex items-center gap-2",children:[r.jsx("span",{children:"\uD83C\uDFE2"}),"Wettbewerbsanalyse"]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[i&&r.jsx("button",{onClick:()=>m(!0),disabled:t,className:"text-sm text-gray-600 hover:text-gray-900 px-3 py-1 rounded hover:bg-gray-100 disabled:opacity-50",children:"\uD83D\uDD04 Aktualisieren"}),r.jsx("button",{onClick:()=>m(!1),disabled:t,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50 transition",children:t?"Suche l\xe4uft...":i?"Erneut suchen":"Wettbewerber suchen"})]})]}),i&&u&&u.dataQuality.includes("eingeschr\xe4nkt")&&r.jsx("div",{className:"mt-4 p-3 bg-orange-50 border-l-4 border-orange-400 rounded",children:(0,r.jsxs)("p",{className:"text-sm font-medium text-orange-900",children:["⚠️ Hinweis: ",u.dataQuality]})})]}),t&&(0,r.jsxs)("div",{className:"text-center py-8",children:[r.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),r.jsx("p",{className:"text-gray-600",children:"Suche Wettbewerber-Preise..."})]}),c&&(0,r.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 text-red-700",children:[r.jsx("p",{className:"text-sm font-medium mb-1",children:"⚠️ Fehler"}),r.jsx("p",{className:"text-sm",children:c})]}),i&&!t&&x&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[(0,r.jsxs)("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[r.jsx("span",{children:"\uD83D\uDCCA"}),"DEINE MARKTPOSITION AUF EINEN BLICK"]}),(0,r.jsxs)("div",{className:"bg-gradient-to-r from-green-50 via-yellow-50 to-red-50 rounded-lg p-6 mb-4",children:[(0,r.jsxs)("div",{className:"flex justify-between text-sm mb-3",children:[(0,r.jsxs)("div",{children:[r.jsx("div",{className:"text-gray-600 mb-1",children:"\uD83D\uDCB6 G\xfcnstigster"}),r.jsx("div",{className:"text-xl font-bold text-green-700",children:(0,_.xG)(x.minPrice)})]}),(0,r.jsxs)("div",{className:"text-center",children:[r.jsx("div",{className:"text-gray-600 mb-1",children:"\uD83D\uDCB6 \xd8-Preis"}),r.jsx("div",{className:"text-xl font-bold text-gray-800",children:(0,_.xG)(x.avgPrice)})]}),(0,r.jsxs)("div",{className:"text-right",children:[r.jsx("div",{className:"text-gray-600 mb-1",children:"\uD83D\uDCB6 Teuerster"}),r.jsx("div",{className:"text-xl font-bold text-orange-700",children:(0,_.xG)(x.maxPrice)})]})]}),(0,r.jsxs)("div",{className:"relative mt-6",children:[r.jsx("div",{className:"h-3 bg-gradient-to-r from-green-400 via-yellow-400 to-red-400 rounded-full"}),(0,r.jsxs)("div",{className:"absolute -top-1 w-5 h-5 bg-red-600 rounded-full border-3 border-white shadow-lg z-10",style:{left:`${Math.min(95,Math.max(5,(s-x.minPrice)/(x.maxPrice-x.minPrice)*100))}%`,transform:"translateX(-50%)"},children:[r.jsx("div",{className:"absolute -top-8 left-1/2 -translate-x-1/2 whitespace-nowrap",children:r.jsx("div",{className:"bg-red-600 text-white px-2 py-1 rounded text-xs font-bold",children:"DU"})}),r.jsx("div",{className:"absolute top-6 left-1/2 -translate-x-1/2 whitespace-nowrap",children:r.jsx("div",{className:"font-bold text-sm",children:(0,_.xG)(s)})})]})]}),r.jsx("div",{className:"text-center mt-8",children:(0,r.jsxs)("span",{className:"inline-flex items-center px-4 py-2 rounded-full text-sm font-bold bg-red-100 text-red-800",children:["⚠️ Du bist ",x.percentAboveAvg.toFixed(1),"% teurer als der Durchschnitt"]})})]}),x.percentAboveAvg>50&&r.jsx("div",{className:"bg-red-50 border-l-4 border-red-500 p-4",children:(0,r.jsxs)("div",{className:"flex items-start gap-3",children:[r.jsx("span",{className:"text-2xl",children:"\uD83D\uDEA8"}),(0,r.jsxs)("div",{children:[r.jsx("h4",{className:"font-bold text-red-900 mb-1",children:"RISIKO: Du bist teurer als ALLE gefundenen Wettbewerber!"}),r.jsx("p",{className:"text-sm text-red-800",children:"Kunden werden wahrscheinlich zur Konkurrenz wechseln."})]})]})})]}),(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[(0,r.jsxs)("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[r.jsx("span",{children:"\uD83D\uDCC8"}),"MARKTDATEN IM \xdcBERBLICK"]}),(0,r.jsxs)("div",{className:"grid grid-cols-4 gap-4 mb-6",children:[(0,r.jsxs)("div",{className:"text-center p-4 bg-blue-50 rounded-lg",children:[r.jsx("div",{className:"text-3xl font-bold text-blue-700",children:x.competitorCount}),(0,r.jsxs)("div",{className:"text-sm text-gray-600 mt-1",children:["Gefunden",r.jsx("br",{}),"Anbieter"]})]}),(0,r.jsxs)("div",{className:"text-center p-4 bg-green-50 rounded-lg",children:[r.jsx("div",{className:"text-3xl font-bold text-green-700",children:(0,_.xG)(x.avgPrice)}),r.jsx("div",{className:"text-sm text-gray-600 mt-1",children:"\xd8-Preis"})]}),(0,r.jsxs)("div",{className:"text-center p-4 bg-purple-50 rounded-lg",children:[r.jsx("div",{className:"text-3xl font-bold text-purple-700",children:(0,_.xG)(x.priceSpread)}),(0,r.jsxs)("div",{className:"text-sm text-gray-600 mt-1",children:["Preis-",r.jsx("br",{}),"Spanne"]})]}),(0,r.jsxs)("div",{className:"text-center p-4 bg-red-50 rounded-lg",children:[(0,r.jsxs)("div",{className:"text-3xl font-bold text-red-700",children:["+",(0,_.xG)(x.yourPriceDiff)]}),(0,r.jsxs)("div",{className:"text-sm text-gray-600 mt-1",children:["Du vs \xd8",r.jsx("br",{}),"teurer"]})]})]}),(0,r.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,r.jsxs)("h4",{className:"font-semibold mb-3 flex items-center gap-2",children:[r.jsx("span",{children:"\uD83D\uDCE6"}),"Produktzustand:"]}),(0,r.jsxs)("ul",{className:"space-y-2 text-sm",children:[x.newCount>0&&(0,r.jsxs)("li",{className:"flex items-start gap-2",children:[r.jsx("span",{className:"text-green-600",children:"• "}),(0,r.jsxs)("span",{children:[r.jsx("strong",{children:"Neuware:"})," ",x.newCount," Anbieter bieten von"," ",x.newMin&&(0,_.xG)(x.newMin)," - ",x.newMax&&(0,_.xG)(x.newMax)]})]}),x.usedCount>0&&(0,r.jsxs)("li",{className:"flex items-start gap-2",children:[r.jsx("span",{className:"text-gray-600",children:"• "}),(0,r.jsxs)("span",{children:[r.jsx("strong",{children:"Gebraucht:"})," ",x.usedCount," Anbieter bieten ab"," ",x.usedMin&&(0,_.xG)(x.usedMin)]})]})]})]})]}),r.jsx(S,{competitors:i.competitors,yourPrice:s}),(0,r.jsxs)("div",{className:"bg-gray-50 rounded-lg border border-gray-200 p-6",children:[(0,r.jsxs)("h3",{className:"text-lg font-semibold mb-3 flex items-center gap-2",children:[r.jsx("span",{children:"⚙️"}),"DATENQUALIT\xc4T & AKTUALIT\xc4T"]}),(0,r.jsxs)("div",{className:"flex items-start gap-4",children:[(0,r.jsxs)("div",{className:`px-4 py-2 rounded-lg font-medium ${"green"===h.color?"bg-green-100 text-green-800":"bg-orange-100 text-orange-800"}`,children:["Eingeschr\xe4nkt zuverl\xe4ssig"===h.label?"⚠️ ":"✅ ",h.label]}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsxs)("p",{className:"text-sm text-gray-700 mb-4",children:["Diese Daten sind ",r.jsx("strong",{children:"heute"})," aktualisiert worden, zeigen aber"," ",h.explanation||"eine normale Preisstreuung","."]}),(0,r.jsxs)("div",{className:"bg-white rounded-lg border p-4",children:[r.jsx("h4",{className:"font-medium mb-2 text-sm",children:"Das bedeutet:"}),(0,r.jsxs)("ul",{className:"space-y-1 text-sm text-gray-700",children:[(0,r.jsxs)("li",{className:"flex items-start gap-2",children:[r.jsx("span",{children:"- "}),r.jsx("span",{children:"Die Produkte k\xf6nnten unterschiedliche Varianten sein"})]}),(0,r.jsxs)("li",{className:"flex items-start gap-2",children:[r.jsx("span",{children:"- "}),r.jsx("span",{children:"Einige Angebote k\xf6nnten nicht mehr verf\xfcgbar sein"})]}),(0,r.jsxs)("li",{className:"flex items-start gap-2",children:[r.jsx("span",{children:"- "}),r.jsx("span",{children:"Preise k\xf6nnen sich schnell \xe4ndern"})]})]})]}),(0,r.jsxs)("p",{className:"text-sm text-blue-700 mt-4",children:["\uD83D\uDCA1 ",r.jsx("strong",{children:"Tipp:"}),' Nutze "Aktualisieren" um die neuesten Preise zu laden. Die Daten werden automatisch alle 24h erneuert.']})]})]})]})]}),!i&&!t&&!c&&(0,r.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[r.jsx("p",{children:"Noch keine Wettbewerber-Daten geladen."}),r.jsx("p",{className:"text-sm mt-2",children:'Klicke auf "Wettbewerber suchen" um zu starten.'})]})]})}let I=(0,u.Z)("trending-down",[["path",{d:"M16 17h6v-6",key:"t6n2it"}],["path",{d:"m22 17-8.5-8.5-5 5L2 7",key:"x473p"}]]);var R=t(8411);let T=(0,u.Z)("pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]);function G({marginData:e,compact:s=!1,onAddCosts:t,onEditCosts:a}){if(!e.has_cost_data)return r.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:(0,r.jsxs)("div",{className:"flex items-start gap-3",children:[r.jsx("div",{className:"flex-shrink-0 w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:r.jsx("span",{className:"text-lg",children:"\uD83D\uDCA1"})}),(0,r.jsxs)("div",{className:"flex-1",children:[r.jsx("h3",{className:"text-sm font-semibold text-gray-900 mb-1",children:"Noch pr\xe4ziser mit Kostendaten"}),(0,r.jsxs)("p",{className:"text-xs text-gray-600 mb-3",children:["Die Preisempfehlung funktioniert auch ohne Kosten.",r.jsx("strong",{children:" Mit Kostendaten"})," k\xf6nnen wir zus\xe4tzlich deine ",r.jsx("strong",{children:"Marge optimieren"})," und sicherstellen, dass du immer profitabel bleibst."]}),t&&r.jsx("button",{onClick:t,className:"text-xs font-medium text-blue-600 hover:text-blue-700 underline transition",children:"Kosten hinterlegen (optional)"})]})]})});let n=e.is_above_min_margin?"text-green-600":e.is_above_break_even?"text-orange-600":"text-red-600",i=e.is_above_min_margin?"bg-green-50 border-green-200":e.is_above_break_even?"bg-orange-50 border-orange-200":"bg-red-50 border-red-200",l=e.is_above_min_margin?r.jsx(m.Z,{className:"w-5 h-5 text-green-600"}):e.is_above_break_even?r.jsx(w,{className:"w-5 h-5 text-orange-600"}):r.jsx(I,{className:"w-5 h-5 text-red-600"});return s?(0,r.jsxs)("div",{className:`inline-flex items-center gap-2 px-3 py-1.5 rounded-full border-2 ${i}`,children:[l,(0,r.jsxs)("span",{className:`font-semibold ${n}`,children:[e.margin?.percent.toFixed(1),"% Marge"]}),(0,r.jsxs)("span",{className:"text-sm text-gray-600",children:["(€",e.margin?.euro.toFixed(2),")"]})]}):(0,r.jsxs)("div",{className:"bg-white border-2 border-gray-200 rounded-xl p-6 space-y-4",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[r.jsx(R.Z,{className:"w-6 h-6 text-gray-700"}),r.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Margin-Analyse"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsxs)("div",{className:`flex items-center gap-2 ${n}`,children:[l,(0,r.jsxs)("span",{className:"text-2xl font-bold",children:[e.margin?.percent.toFixed(1),"%"]})]}),e.has_cost_data&&a&&(0,r.jsxs)("button",{onClick:a,className:"flex items-center gap-2 px-3 py-1.5 text-sm font-medium text-blue-600 bg-blue-50 hover:bg-blue-100 border border-blue-200 rounded-lg transition-all",title:"Kosten bearbeiten","aria-label":"Kostendaten bearbeiten",children:[r.jsx(T,{className:"w-4 h-4"}),r.jsx("span",{className:"hidden sm:inline",children:"Bearbeiten"})]})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4 py-3 border-y",children:[(0,r.jsxs)("div",{children:[r.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Verkaufspreis"}),(0,r.jsxs)("p",{className:"text-xl font-semibold text-gray-900",children:["€",e.selling_price?.toFixed(2)]})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("p",{className:"text-sm text-gray-600 mb-1",children:["Nettoerl\xf6s",e.vat_rate&&(0,r.jsxs)("span",{className:"ml-1 text-xs",children:["(nach ",(100*e.vat_rate).toFixed(0),"% MwSt)"]})]}),(0,r.jsxs)("p",{className:"text-xl font-semibold text-gray-900",children:["€",e.net_revenue?.toFixed(2)]})]})]}),e.costs&&(0,r.jsxs)("div",{children:[r.jsx("p",{className:"text-sm font-medium text-gray-700 mb-3",children:"Variable Kosten:"}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("div",{className:"flex justify-between text-sm",children:[r.jsx("span",{className:"text-gray-600",children:"• Einkauf:"}),(0,r.jsxs)("span",{className:"font-medium text-gray-900",children:["€",e.costs.purchase.toFixed(2)]})]}),(0,r.jsxs)("div",{className:"flex justify-between text-sm",children:[r.jsx("span",{className:"text-gray-600",children:"• Versand:"}),(0,r.jsxs)("span",{className:"font-medium text-gray-900",children:["€",e.costs.shipping.toFixed(2)]})]}),(0,r.jsxs)("div",{className:"flex justify-between text-sm",children:[r.jsx("span",{className:"text-gray-600",children:"• Verpackung:"}),(0,r.jsxs)("span",{className:"font-medium text-gray-900",children:["€",e.costs.packaging.toFixed(2)]})]}),(0,r.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,r.jsxs)("span",{className:"text-gray-600",children:["• Payment Fee",e.payment_provider&&(0,r.jsxs)("span",{className:"ml-1 text-xs",children:["(",e.payment_provider,")"]}),":"]}),(0,r.jsxs)("span",{className:"font-medium text-gray-900",children:["€",e.costs.payment_fee.toFixed(2)]})]}),(0,r.jsxs)("div",{className:"flex justify-between text-sm font-semibold pt-2 border-t",children:[r.jsx("span",{className:"text-gray-900",children:"Gesamt:"}),(0,r.jsxs)("span",{className:"text-gray-900",children:["€",e.costs.total_variable.toFixed(2)]})]})]})]}),e.margin&&(0,r.jsxs)("div",{className:`p-4 rounded-lg border-2 ${i}`,children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[l,r.jsx("span",{className:"font-semibold text-gray-900",children:"Deckungsbeitrag I:"})]}),(0,r.jsxs)("div",{className:"flex items-baseline gap-3",children:[(0,r.jsxs)("span",{className:`text-3xl font-bold ${n}`,children:["€",e.margin.euro.toFixed(2)]}),(0,r.jsxs)("span",{className:`text-xl font-semibold ${n}`,children:["(",e.margin.percent.toFixed(1),"%)"]})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-3 pt-2",children:[e.break_even_price&&(0,r.jsxs)("div",{className:"text-sm",children:[r.jsx("p",{className:"text-gray-600 mb-1",children:"⚠️ Break-Even:"}),(0,r.jsxs)("p",{className:"font-semibold text-gray-900",children:["€",e.break_even_price.toFixed(2)]})]}),e.recommended_min_price&&(0,r.jsxs)("div",{className:"text-sm",children:[r.jsx("p",{className:"text-gray-600 mb-1",children:"✅ Min. empfohlen (20%):"}),(0,r.jsxs)("p",{className:"font-semibold text-green-600",children:["€",e.recommended_min_price.toFixed(2)]})]})]}),!e.is_above_break_even&&(0,r.jsxs)("div",{className:"bg-red-100 border border-red-300 rounded-lg p-3 text-sm",children:[r.jsx("p",{className:"font-semibold text-red-900 mb-1",children:"❌ KRITISCH: Unter Break-Even"}),r.jsx("p",{className:"text-red-800",children:"Dieser Preis liegt unter deinen Kosten. Du machst Verlust bei jedem Verkauf!"})]}),e.is_above_break_even&&!e.is_above_min_margin&&(0,r.jsxs)("div",{className:"bg-orange-100 border border-orange-300 rounded-lg p-3 text-sm",children:[r.jsx("p",{className:"font-semibold text-orange-900 mb-1",children:"⚠️ NIEDRIGE MARGE"}),r.jsx("p",{className:"text-orange-800",children:"Marge liegt unter der empfohlenen Mindestmarge von 20%. Ber\xfccksichtige Fixkosten und unerwartete Ausgaben."})]}),e.is_above_min_margin&&(0,r.jsxs)("div",{className:"bg-green-100 border border-green-300 rounded-lg p-3 text-sm",children:[r.jsx("p",{className:"font-semibold text-green-900 mb-1",children:"✅ GESUNDE MARGE"}),r.jsx("p",{className:"text-green-800",children:"Marge \xfcber 20% - gute Profitabilit\xe4t! Genug Puffer f\xfcr Fixkosten und Gewinn."})]})]})}var L=t(1991);let B=(0,u.Z)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);var Z=t(6064);function V({isOpen:e,onClose:s,productId:t,productTitle:n,currentPrice:i,shopId:l,onSave:c}){let[o,m]=(0,a.useState)({purchase_cost:0,shipping_cost:0,packaging_cost:0,payment_provider:"stripe",country_code:"DE",category:void 0}),[x,u]=(0,a.useState)(!1),[h,p]=(0,a.useState)(!1),[b,f]=(0,a.useState)(!1),[j,y]=(0,a.useState)(null),[v,w]=(0,a.useState)(null),[_,k]=(0,a.useState)(!1),[D,P]=(0,a.useState)(null);(0,a.useEffect)(()=>{e&&t&&C()},[e,t]);let C=async()=>{try{u(!0),w(null);let e=await (0,d.Rd)(t);e?(P({purchase_cost:e.purchase_cost,shipping_cost:e.shipping_cost,packaging_cost:e.packaging_cost,payment_provider:e.payment_provider,country_code:e.country_code,category:e.category}),m({purchase_cost:e.purchase_cost,shipping_cost:e.shipping_cost,packaging_cost:e.packaging_cost,payment_provider:e.payment_provider,country_code:e.country_code,category:e.category}),k(!1)):(P(null),m({purchase_cost:0,shipping_cost:0,packaging_cost:0,payment_provider:"stripe",country_code:"DE",category:void 0}),k(!0),w(null))}catch(e){console.error("Failed to load costs:",e),e?.response?.status!==404&&e?.status!==404?w("Fehler beim Laden der Kosten"):(P(null),k(!0),w(null))}finally{u(!1)}};(0,a.useEffect)(()=>{o.category&&S(o.category)},[o.category]);let S=async e=>{try{let s=await (0,d.$m)(e);y(s)}catch(e){console.error("Failed to load category defaults:",e)}},E=async()=>{if(!i||!o.category){w("Bitte w\xe4hle zuerst eine Kategorie");return}u(!0),w(null);try{let e=await (0,d.R5)(i,o.category,o.country_code);m(s=>({...s,purchase_cost:e.estimated_purchase_cost,shipping_cost:e.estimated_shipping_cost,packaging_cost:e.estimated_packaging_cost})),f(!0)}catch(e){console.error("Failed to estimate costs:",e),w("Fehler beim Sch\xe4tzen der Kosten")}finally{u(!1)}},M=async()=>{if(o.purchase_cost<=0){w("Einkaufspreis muss gr\xf6\xdfer als 0 sein");return}p(!0),w(null);try{D?await (0,d._M)(t,o):await (0,d.QJ)(t,o),await c(o),await C(),k(!0)}catch(e){console.error("Failed to save costs:",e),w(e?.message||e?.detail||"Fehler beim Speichern der Kosten")}finally{p(!1)}};if(!e)return null;let A=o.purchase_cost+o.shipping_cost+o.packaging_cost,F=i?(i/1.19-A)/(i/1.19)*100:0;return(0,r.jsxs)(r.Fragment,{children:[r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40",onClick:s}),r.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-50 p-4",children:(0,r.jsxs)("div",{className:"bg-white rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[(0,r.jsxs)("div",{className:"flex items-start justify-between p-6 border-b sticky top-0 bg-white z-10",children:[(0,r.jsxs)("div",{className:"flex-1",children:[r.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-1",children:"Kosten hinterlegen"}),r.jsx("p",{className:"text-sm text-gray-600",children:n})]}),r.jsx("button",{onClick:s,className:"p-2 hover:bg-gray-100 rounded-full transition",children:r.jsx(N.Z,{className:"w-6 h-6"})})]}),v&&r.jsx("div",{className:"mx-6 mt-4 p-3 bg-red-50 border border-red-200 rounded-lg text-red-800 text-sm",children:v}),(0,r.jsxs)("div",{className:"p-6 space-y-6",children:[D&&!_&&(0,r.jsxs)("div",{className:"bg-green-50 border-2 border-green-300 rounded-xl p-6 mb-8 shadow-md",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,r.jsxs)("div",{children:[r.jsx("h3",{className:"text-xl font-bold text-green-800 mb-1",children:"✅ Gespeicherte Kosten"}),r.jsx("p",{className:"text-sm text-green-700",children:"Klicke Bearbeiten um Werte anzupassen"})]}),(0,r.jsxs)("button",{onClick:()=>k(!0),className:"px-6 py-2 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 flex items-center gap-2 shadow-md transition-all hover:scale-105",title:"Kosten bearbeiten",children:[r.jsx(T,{className:"w-4 h-4"}),"Bearbeiten"]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm mb-6",children:[(0,r.jsxs)("div",{children:[r.jsx("span",{className:"text-gray-600",children:"Einkauf:"}),(0,r.jsxs)("span",{className:"font-bold ml-2 text-gray-900",children:["€",D.purchase_cost.toFixed(2)]})]}),(0,r.jsxs)("div",{children:[r.jsx("span",{className:"text-gray-600",children:"Versand:"}),(0,r.jsxs)("span",{className:"font-bold ml-2 text-gray-900",children:["€",D.shipping_cost.toFixed(2)]})]}),(0,r.jsxs)("div",{children:[r.jsx("span",{className:"text-gray-600",children:"Verpackung:"}),(0,r.jsxs)("span",{className:"font-bold ml-2 text-gray-900",children:["€",D.packaging_cost.toFixed(2)]})]}),(0,r.jsxs)("div",{children:[r.jsx("span",{className:"text-gray-600",children:"Payment:"}),r.jsx("span",{className:"font-bold ml-2 text-gray-900",children:D.payment_provider})]}),(0,r.jsxs)("div",{children:[r.jsx("span",{className:"text-gray-600",children:"MwSt:"}),r.jsx("span",{className:"font-bold ml-2 text-gray-900",children:D.country_code})]}),(0,r.jsxs)("div",{children:[r.jsx("span",{className:"text-gray-600",children:"Kategorie:"}),r.jsx("span",{className:"font-bold ml-2 text-gray-900",children:D.category||"N/A"})]})]}),r.jsx("div",{className:"pt-4 border-t border-green-300",children:(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[r.jsx("span",{className:"font-bold text-gray-900",children:"Gesamt Kosten:"}),(0,r.jsxs)("span",{className:"text-2xl font-bold text-green-600",children:["€",(D.purchase_cost+D.shipping_cost+D.packaging_cost).toFixed(2)]})]})})]}),(_||!D)&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Kategorie"}),(0,r.jsxs)("select",{value:o.category||"",onChange:e=>m(s=>({...s,category:e.target.value})),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[r.jsx("option",{value:"",children:"Kategorie w\xe4hlen..."}),["fashion","electronics","beauty","home","food"].map(e=>r.jsx("option",{value:e,children:e.charAt(0).toUpperCase()+e.slice(1)},e))]}),j&&r.jsx("div",{className:"mt-2 p-3 bg-blue-50 rounded-lg",children:(0,r.jsxs)("div",{className:"flex items-start gap-2",children:[r.jsx(L.Z,{className:"w-4 h-4 text-blue-600 mt-0.5"}),(0,r.jsxs)("div",{className:"text-sm text-blue-900",children:[(0,r.jsxs)("p",{className:"font-medium",children:["Typisch f\xfcr ",o.category,":"]}),(0,r.jsxs)("p",{children:["Versand: €",j.shipping_estimate.toFixed(2),", Verpackung: €",j.packaging_estimate.toFixed(2)]}),r.jsx("button",{onClick:()=>{j&&m(e=>({...e,shipping_cost:j.shipping_estimate,packaging_cost:j.packaging_estimate}))},className:"text-blue-600 hover:text-blue-800 font-medium mt-1 underline",children:"→ Werte \xfcbernehmen"})]})]})})]}),i&&o.category&&(0,r.jsxs)("button",{onClick:E,disabled:x,className:"w-full flex items-center justify-center gap-2 py-3 px-4 bg-purple-100 text-purple-700 rounded-lg hover:bg-purple-200 transition disabled:opacity-50 disabled:cursor-not-allowed",children:[x?r.jsx(B,{className:"w-4 h-4 animate-spin"}):r.jsx(Z.Z,{className:"w-4 h-4"}),r.jsx("span",{children:x?"Sch\xe4tze...":`Kosten sch\xe4tzen (Verkaufspreis: €${i.toFixed(2)})`})]}),b&&r.jsx("div",{className:"p-3 bg-yellow-50 border border-yellow-200 rounded-lg text-sm text-yellow-800",children:"⚠️ Dies sind Sch\xe4tzungen basierend auf Branchendurchschnitten. Bitte mit echten Daten ersetzen!"}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\uD83D\uDCB0 Einkaufspreis (netto) *"}),(0,r.jsxs)("div",{className:"relative",children:[r.jsx("input",{type:"number",step:"0.01",min:"0",value:o.purchase_cost||"",onChange:e=>m(s=>({...s,purchase_cost:parseFloat(e.target.value)||0})),className:"w-full px-4 py-2 pr-8 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"0.00",required:!0}),r.jsx("span",{className:"absolute right-3 top-2.5 text-gray-500",children:"€"})]})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\uD83D\uDCE6 Versandkosten (pro St\xfcck)"}),(0,r.jsxs)("div",{className:"relative",children:[r.jsx("input",{type:"number",step:"0.01",min:"0",value:o.shipping_cost||"",onChange:e=>m(s=>({...s,shipping_cost:parseFloat(e.target.value)||0})),className:"w-full px-4 py-2 pr-8 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"0.00"}),r.jsx("span",{className:"absolute right-3 top-2.5 text-gray-500",children:"€"})]})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\uD83D\uDCE6 Verpackung (pro St\xfcck)"}),(0,r.jsxs)("div",{className:"relative",children:[r.jsx("input",{type:"number",step:"0.01",min:"0",value:o.packaging_cost||"",onChange:e=>m(s=>({...s,packaging_cost:parseFloat(e.target.value)||0})),className:"w-full px-4 py-2 pr-8 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"0.00"}),r.jsx("span",{className:"absolute right-3 top-2.5 text-gray-500",children:"€"})]})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\uD83D\uDCB3 Payment Provider"}),r.jsx("select",{value:o.payment_provider,onChange:e=>m(s=>({...s,payment_provider:e.target.value})),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[{value:"stripe",label:"Stripe (2.9% + €0.30)"},{value:"paypal",label:"PayPal (2.49% + €0.35)"},{value:"klarna",label:"Klarna (4.5%)"},{value:"custom",label:"Custom"}].map(e=>r.jsx("option",{value:e.value,children:e.label},e.value))})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\uD83C\uDF0D Land (MwSt)"}),(0,r.jsxs)("select",{value:o.country_code,onChange:e=>m(s=>({...s,country_code:e.target.value})),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[r.jsx("option",{value:"DE",children:"Deutschland (19%)"}),r.jsx("option",{value:"AT",children:"\xd6sterreich (20%)"}),r.jsx("option",{value:"CH",children:"Schweiz (7.7%)"}),r.jsx("option",{value:"GB",children:"UK (20%)"}),r.jsx("option",{value:"US",children:"USA (0%)"})]})]})]}),(0,r.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4 space-y-2",children:[(0,r.jsxs)("div",{className:"flex justify-between text-sm",children:[r.jsx("span",{className:"text-gray-600",children:"Summe variable Kosten:"}),(0,r.jsxs)("span",{className:"font-semibold",children:["€",A.toFixed(2)]})]}),i&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"flex justify-between text-sm",children:[r.jsx("span",{className:"text-gray-600",children:"Aktueller Preis:"}),(0,r.jsxs)("span",{className:"font-semibold",children:["€",i.toFixed(2)]})]}),(0,r.jsxs)("div",{className:"flex justify-between text-lg font-bold pt-2 border-t",children:[r.jsx("span",{children:"Gesch\xe4tzte Marge:"}),(0,r.jsxs)("span",{className:F>=20?"text-green-600":"text-orange-600",children:[F.toFixed(1),"%"]})]})]})]})]})]}),r.jsx("div",{className:"flex gap-3 p-6 border-t bg-gray-50 sticky bottom-0",children:D&&_?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("button",{onClick:()=>{D&&m({...D}),k(!1),w(null)},disabled:h,className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-100 transition disabled:opacity-50 flex items-center justify-center gap-2",children:[r.jsx(N.Z,{className:"w-4 h-4"}),"Abbrechen"]}),r.jsx("button",{onClick:M,disabled:h||0===o.purchase_cost,className:"flex-1 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:h?(0,r.jsxs)(r.Fragment,{children:[r.jsx(B,{className:"w-4 h-4 animate-spin"}),r.jsx("span",{children:"Speichern..."})]}):(0,r.jsxs)(r.Fragment,{children:[r.jsx(g,{className:"w-4 h-4"}),r.jsx("span",{children:"Speichern"})]})})]}):(0,r.jsxs)(r.Fragment,{children:[r.jsx("button",{onClick:s,disabled:h,className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-100 transition disabled:opacity-50",children:D?"Schlie\xdfen":"Abbrechen"}),!D&&r.jsx("button",{onClick:M,disabled:h||0===o.purchase_cost,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:h?(0,r.jsxs)(r.Fragment,{children:[r.jsx(B,{className:"w-4 h-4 animate-spin"}),r.jsx("span",{children:"Speichern..."})]}):r.jsx("span",{children:"Kosten erfassen"})})]})})]})})]})}let U=(0,u.Z)("chevron-up",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]),W=(0,u.Z)("chevron-down",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);function q(){let e=(0,i.useSearchParams)().get("product_id"),[s,t]=(0,a.useState)(e?Number(e):1),[o,m]=(0,a.useState)(0),[x,u]=(0,a.useState)(null),[h,g]=(0,a.useState)(!1),[p,b]=(0,a.useState)(""),[f,j]=(0,a.useState)({margin:!1,price:!1,competitor:!1}),[y,N]=(0,a.useState)({margin:!1,price:!1,competitor:!1}),{isDemoMode:v,currentShop:w}=(0,c.L)(),_=e=>{j(s=>({...s,[e]:!s[e]}))};return(0,a.useEffect)(()=>{if(!s||!w){console.log("[RecommendationsPage] Missing productId or currentShop, skipping load");return}(async()=>{try{console.log("[RecommendationsPage] Loading product data:",{productId:s,shopId:w.id,isDemoMode:v});let e=await (0,d.t2)();console.log("[RecommendationsPage] Products received:",e.length,"First ID type:",typeof e[0]?.id),console.log("[RecommendationsPage] Searching for:",s,"Type:",typeof s);let t=e.find(e=>String(e.id)===String(s));if(!t){console.error("[RecommendationsPage] Product not found in current shop",{productId:s,productIdType:typeof s,currentShop:w,productsCount:e.length,availableIds:e.slice(0,5).map(e=>({id:e.id,idType:typeof e.id}))}),u({has_cost_data:!1,error:`Produkt ${s} nicht im aktuellen Shop gefunden. Bitte Shop wechseln oder Produkt-ID pr\xfcfen.`}),m(0),b(`Product ${s} (nicht gefunden)`);return}if(console.log("[RecommendationsPage] Product found:",{id:t.id,title:t.title,price:t.price}),m(t.price||0),b(t.title||t.name||`Product ${s}`),t.price&&t.price>0)try{let e=await (0,d.ku)(s.toString(),t.price);u(e)}catch(e){u({has_cost_data:!1})}}catch(e){console.error("[RecommendationsPage] Fehler beim Laden der Produktdaten:",e),u({has_cost_data:!1,error:"Fehler beim Laden der Produktdaten."})}})()},[s,w?.id,v]),(0,a.useEffect)(()=>{let e=e=>{console.log("[RecommendationsPage] Shop switched event received:",e.detail),s&&setTimeout(()=>{(async()=>{try{let e=(await (0,d.t2)()).find(e=>String(e.id)===String(s));e?(console.log("[RecommendationsPage] Product reloaded after shop switch:",{id:e.id,title:e.title,price:e.price}),m(e.price||0),b(e.title||e.name||`Product ${s}`)):u({has_cost_data:!1,error:`Produkt ${s} nicht im neuen Shop gefunden.`})}catch(e){console.error("[RecommendationsPage] Error reloading product after shop switch:",e)}})()},300)};return window.addEventListener("shop-switched",e),()=>window.removeEventListener("shop-switched",e)},[s]),(0,a.useEffect)(()=>{let e=e=>{e.target.closest(".info-tooltip-button")||N({margin:!1,price:!1,competitor:!1})};if(y.margin||y.price||y.competitor)return document.addEventListener("click",e),()=>document.removeEventListener("click",e)},[y]),(0,r.jsxs)("div",{className:"min-h-screen bg-gray-50 flex",children:[(0,r.jsxs)("aside",{className:"w-80 bg-gradient-to-b from-white via-gray-50 to-white border-r border-gray-200 p-6 overflow-y-auto shadow-sm",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3 mb-8 pb-6 border-b border-gray-200",children:[r.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-blue-600 to-indigo-600 rounded-xl flex items-center justify-center shadow-lg transform hover:scale-105 transition-transform",children:r.jsx("span",{className:"text-2xl",children:"\uD83D\uDCA1"})}),r.jsx("h2",{className:"text-2xl font-bold bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent",children:"PriceIQ"})]}),r.jsx("div",{className:"mb-6",children:r.jsx(l.D,{})}),(0,r.jsxs)("nav",{className:"space-y-2",children:[r.jsx(n.rU,{href:"/",className:"block px-4 py-2 text-gray-700 rounded-lg hover:bg-gray-100 transition-colors",children:"Dashboard"}),r.jsx(n.rU,{href:"/products",className:"block px-4 py-2 text-gray-700 rounded-lg hover:bg-gray-100 transition-colors",children:"Produkte"}),r.jsx(n.rU,{href:"/recommendations",className:"block px-4 py-2 text-gray-700 rounded-lg hover:bg-gray-100 transition-colors bg-gray-100",children:"Empfehlungen"})]})]}),r.jsx("main",{className:"flex-1 p-8 overflow-y-auto",children:(0,r.jsxs)("div",{className:"max-w-7xl mx-auto",children:[r.jsx("div",{className:"mb-8",children:(0,r.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[r.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-2xl flex items-center justify-center shadow-lg",children:r.jsx("span",{className:"text-3xl",children:"\uD83D\uDCCA"})}),(0,r.jsxs)("div",{children:[r.jsx("h1",{className:"text-4xl font-bold text-gray-900 mb-1",children:"Produkt-Analysen"}),r.jsx("p",{className:"text-gray-600 text-sm",children:"Vollst\xe4ndige Analyse f\xfcr optimale Preisentscheidungen"})]})]}),r.jsx(n.rU,{href:"/",className:"px-6 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors font-medium shadow-sm hover:shadow-md",children:"← Zur\xfcck"})]})}),r.jsx("div",{className:"mb-6 p-6 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl border-2 border-blue-200 shadow-sm",children:(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[r.jsx("div",{className:"w-12 h-12 bg-blue-500 rounded-xl flex items-center justify-center flex-shrink-0",children:r.jsx("span",{className:"text-2xl",children:"\uD83D\uDCE6"})}),(0,r.jsxs)("div",{className:"flex-1",children:[r.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:p||`Produkt ${s}`}),o>0&&(0,r.jsxs)("p",{className:"text-sm text-gray-600 mt-1",children:["Aktueller Preis: ",(0,r.jsxs)("span",{className:"font-semibold text-gray-900",children:[o.toFixed(2)," €"]})]})]})]})}),o>0&&x&&(0,r.jsxs)("section",{className:"mb-6",children:[r.jsx("div",{className:"relative",children:(0,r.jsxs)("button",{onClick:()=>_("margin"),className:"w-full flex items-center justify-between p-6 bg-white rounded-lg border-2 border-gray-200 hover:border-blue-400 hover:shadow-lg transition-all duration-200 text-left",children:[(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[r.jsx("span",{className:"text-4xl",children:"\uD83D\uDCB0"}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[r.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Margen-Analyse"}),(0,r.jsxs)("button",{onClick:e=>{e.stopPropagation(),N(e=>({...e,margin:!e.margin}))},className:"relative info-tooltip-button",children:[r.jsx(L.Z,{className:"w-5 h-5 text-gray-400 hover:text-blue-600 transition-colors"}),y.margin&&(0,r.jsxs)("div",{className:"absolute left-0 bottom-full mb-2 w-80 p-4 bg-gray-900 text-white text-sm rounded-lg shadow-xl z-50",children:[r.jsx("div",{className:"font-semibold mb-2",children:"Was passiert hier?"}),r.jsx("p",{className:"mb-2",children:"Die Margen-Analyse zeigt dir, ob dein aktueller Preis \xfcber deinen Kosten liegt und wie viel Gewinn du pro Verkauf machst."}),(0,r.jsxs)("p",{className:"mb-2",children:[r.jsx("strong",{children:"Wichtig:"})," Bevor du Preise \xe4nderst, solltest du immer pr\xfcfen, dass du nicht unter deine Kosten verkaufst!"]}),r.jsx("p",{children:"Hier kannst du auch Kosten f\xfcr dein Produkt hinterlegen (Einkaufspreis, Versand, Verpackung, etc.)."}),r.jsx("div",{className:"absolute bottom-0 left-4 transform translate-y-full",children:r.jsx("div",{className:"w-0 h-0 border-l-8 border-r-8 border-t-8 border-transparent border-t-gray-900"})})]})]})]}),r.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Pr\xfcfe deine Kosten und Margen vor Preis\xe4nderungen"})]})]}),f.margin?r.jsx(U,{className:"w-6 h-6 text-gray-500"}):r.jsx(W,{className:"w-6 h-6 text-gray-500"})]})}),f.margin&&r.jsx("div",{className:"mt-4 bg-white rounded-lg border border-gray-200 p-6 transition-all duration-300 ease-in-out",children:r.jsx(G,{marginData:x||{has_cost_data:!1},onAddCosts:()=>g(!0),onEditCosts:()=>g(!0)})})]}),(0,r.jsxs)("section",{className:"mb-6",children:[r.jsx("div",{className:"relative",children:(0,r.jsxs)("button",{onClick:()=>_("price"),className:"w-full flex items-center justify-between p-6 bg-white rounded-lg border-2 border-gray-200 hover:border-blue-400 hover:shadow-lg transition-all duration-200 text-left",children:[(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[r.jsx("span",{className:"text-4xl",children:"\uD83D\uDCA1"}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[r.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Preisempfehlung"}),(0,r.jsxs)("button",{onClick:e=>{e.stopPropagation(),N(e=>({...e,price:!e.price}))},className:"relative info-tooltip-button",children:[r.jsx(L.Z,{className:"w-5 h-5 text-gray-400 hover:text-blue-600 transition-colors"}),y.price&&(0,r.jsxs)("div",{className:"absolute left-0 bottom-full mb-2 w-80 p-4 bg-gray-900 text-white text-sm rounded-lg shadow-xl z-50",children:[r.jsx("div",{className:"font-semibold mb-2",children:"Was passiert hier?"}),r.jsx("p",{className:"mb-2",children:"Unsere KI analysiert verschiedene Faktoren wie Nachfrage, Lagerbestand, Wettbewerbspreise und deine Kosten, um dir eine optimale Preisempfehlung zu geben."}),r.jsx("p",{className:"mb-2",children:r.jsx("strong",{children:"Die Empfehlung ber\xfccksichtigt:"})}),(0,r.jsxs)("ul",{className:"list-disc list-inside mb-2 space-y-1",children:[r.jsx("li",{children:"Verkaufsdaten der letzten 30 Tage"}),r.jsx("li",{children:"Aktuelle Preise deiner Konkurrenten"}),r.jsx("li",{children:"Deine Lagerbest\xe4nde"}),r.jsx("li",{children:"Deine Kosten und Margen"})]}),r.jsx("p",{children:"Du kannst die Empfehlung direkt anwenden oder erst die Details ansehen."}),r.jsx("div",{className:"absolute bottom-0 left-4 transform translate-y-full",children:r.jsx("div",{className:"w-0 h-0 border-l-8 border-r-8 border-t-8 border-transparent border-t-gray-900"})})]})]})]}),r.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"KI-basierte Preisempfehlung basierend auf Marktdaten"})]})]}),f.price?r.jsx(U,{className:"w-6 h-6 text-gray-500"}):r.jsx(W,{className:"w-6 h-6 text-gray-500"})]})}),f.price&&r.jsx("div",{className:"mt-4 bg-white rounded-lg border border-gray-200 p-6 transition-all duration-300 ease-in-out",children:r.jsx(C,{productId:s})})]}),o>0&&(0,r.jsxs)("section",{className:"mb-6",children:[r.jsx("div",{className:"relative",children:(0,r.jsxs)("button",{onClick:()=>_("competitor"),className:"w-full flex items-center justify-between p-6 bg-white rounded-lg border-2 border-gray-200 hover:border-blue-400 hover:shadow-lg transition-all duration-200 text-left",children:[(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[r.jsx("span",{className:"text-4xl",children:"\uD83C\uDFEA"}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[r.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Wettbewerbsanalyse"}),(0,r.jsxs)("button",{onClick:e=>{e.stopPropagation(),N(e=>({...e,competitor:!e.competitor}))},className:"relative info-tooltip-button",children:[r.jsx(L.Z,{className:"w-5 h-5 text-gray-400 hover:text-blue-600 transition-colors"}),y.competitor&&(0,r.jsxs)("div",{className:"absolute left-0 bottom-full mb-2 w-80 p-4 bg-gray-900 text-white text-sm rounded-lg shadow-xl z-50",children:[r.jsx("div",{className:"font-semibold mb-2",children:"Was passiert hier?"}),r.jsx("p",{className:"mb-2",children:"Die Wettbewerbsanalyse zeigt dir, wie dein Preis im Vergleich zu anderen Anbietern steht."}),r.jsx("p",{className:"mb-2",children:r.jsx("strong",{children:"Du siehst:"})}),(0,r.jsxs)("ul",{className:"list-disc list-inside mb-2 space-y-1",children:[r.jsx("li",{children:"Preise deiner Konkurrenten (Neuware, Gebraucht, etc.)"}),r.jsx("li",{children:"Deine Marktposition (g\xfcnstigster, teuerster, Durchschnitt)"}),r.jsx("li",{children:"Durchschnittspreis und Preisspanne"}),r.jsx("li",{children:"Datenqualit\xe4t der Analyse"})]}),r.jsx("p",{children:"Nutze diese Informationen, um deine Preise strategisch anzupassen."}),r.jsx("div",{className:"absolute bottom-0 left-4 transform translate-y-full",children:r.jsx("div",{className:"w-0 h-0 border-l-8 border-r-8 border-t-8 border-transparent border-t-gray-900"})})]})]})]}),r.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Vergleiche deine Preise mit der Konkurrenz"})]})]}),f.competitor?r.jsx(U,{className:"w-6 h-6 text-gray-500"}):r.jsx(W,{className:"w-6 h-6 text-gray-500"})]})}),f.competitor&&r.jsx("div",{className:"mt-4 bg-white rounded-lg border border-gray-200 p-6 transition-all duration-300 ease-in-out",children:r.jsx(K,{productId:s,currentPrice:o})})]})]})}),r.jsx(V,{isOpen:h,onClose:()=>g(!1),productId:s.toString(),productTitle:p||`Product ${s}`,currentPrice:o,shopId:w?.id?.toString()||"demo",onSave:async e=>{try{if(await (0,d.QJ)(s.toString(),e),g(!1),o>0){let e=await (0,d.ku)(s.toString(),o);u(e)}}catch(e){throw console.error("Fehler beim Speichern der Kosten:",e),e}}})]})}function O(){return r.jsx(a.Suspense,{fallback:r.jsx("div",{className:"min-h-screen p-8",children:"Lade..."}),children:r.jsx(q,{})})}},5137:(e,s,t)=>{"use strict";function r(e,s="EUR"){return new Intl.NumberFormat("de-DE",{style:"currency",currency:s,minimumFractionDigits:2,maximumFractionDigits:2}).format(e)}t.d(s,{xG:()=>r})},5269:(e,s,t)=>{"use strict";t.d(s,{Z:()=>r});let r=(0,t(7075).Z)("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},6262:(e,s,t)=>{"use strict";t.d(s,{Z:()=>r});let r=(0,t(7075).Z)("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},8411:(e,s,t)=>{"use strict";t.d(s,{Z:()=>r});let r=(0,t(7075).Z)("dollar-sign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]])},1991:(e,s,t)=>{"use strict";t.d(s,{Z:()=>r});let r=(0,t(7075).Z)("info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]])},4513:(e,s,t)=>{"use strict";t.d(s,{Z:()=>r});let r=(0,t(7075).Z)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},6222:(e,s,t)=>{"use strict";t.r(s),t.d(s,{$$typeof:()=>n,__esModule:()=>a,default:()=>i});let r=(0,t(6843).createProxy)(String.raw`C:\Users\Kujti\Desktop\Trading Tools\MVP PRICE\frontend\app\[locale]\recommendations\page.tsx`),{__esModule:a,$$typeof:n}=r,i=r.default}};var s=require("../../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),r=s.X(0,[638,312,690,242],()=>t(3956));module.exports=r})();